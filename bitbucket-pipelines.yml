# https://www.notion.so/vivipic/repo-variables-f30a0f1dfba746ff97f8f94f6f257da2?pvs=4

image: node:16.19.1

definitions:
  caches:
    pnpm: $BITBUCKET_CLONE_DIR/.pnpm-store

pipelines:
  default: #for feature
    - parallel:
        - step:
            name: "Verify build environment"
            script: #show node and pnpm version
              - corepack enable
              - corepack prepare pnpm@latest-8 --activate
              - node -v
              - pnpm -v
        - step:
            name: "Start build with node module cache"
            size: 2x
            caches: #set caches for node modules to speed up building
              - node
            image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
            script:
              - corepack enable
              - corepack prepare pnpm@latest-8 --activate
              - pnpm install
              - pnpm run build-skip-cache # Replace with your build/testâ€¦etc. commands
            artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
              - projects/*/dist/**
    - parallel:
        - step:
            name: "Run E2E Tests"
            size: 2x
            caches: #set caches for node modules to speed up building
              - node
            image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
            script:
              - corepack enable
              - corepack prepare pnpm@latest-8 --activate
              - npx cypress install
              - npx cypress -v
              - cp -r projects/pic/dist projects/pic/dist-cy
              - rm projects/pic/dist-cy/index.html
              - mv projects/pic/dist-cy/app.html projects/pic/dist-cy/index.html
              - (pnpm run --filter @nu/pic preview-cy &)
              - npx cypress run --record --browser chrome
            artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
              - cypress-visual-report/**
              - cypress-visual-screenshots/**
        - step:
            name: "vivipic to dev5 (Alan)"
            deployment: dev5
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev5.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev5.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev5.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "vivipic to dev4 (Gary)"
            deployment: dev4
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev4.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev4.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev4.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "vivipic to dev3 (HsingChi)"
            deployment: dev3
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev3.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev3.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev3.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "vivipic to dev2 (TingAn)"
            deployment: dev2
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev2.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev2.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev2.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "vivipic to dev1 (Nathan)"
            deployment: dev1
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev1.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev1.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev1.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "vivipic to dev0 (ZhengYan)"
            deployment: dev0
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev0.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev0.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev0.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "vivipic to dev5s (Alan)"
            deployment: dev5s
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev5s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev5s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev5s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "vivipic to dev4s (Gary)"
            deployment: dev4s
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev4s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev4s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev4s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "vivipic to dev3s (HsingChi)"
            deployment: dev3s
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev3s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev3s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev3s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "vivipic to dev2s (TingAn)"
            deployment: dev2s
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev2s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev2s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev2s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "vivipic to dev1s (Nathan)"
            deployment: dev1s
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev1s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev1s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev1s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "vivipic to dev0s (ZhengYan)"
            deployment: dev0s
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev0s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev0s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev0s.vivipic.com"
                  LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "sticker to dev5 (Alan)"
            deployment: stkdev5
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev5.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev5.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev5.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "sticker to dev4 (Gary)"
            deployment: stkdev4
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev4.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev4.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev4.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "sticker to dev3 (HsingChi)"
            deployment: stkdev3
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev3.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev3.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev3.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "sticker to dev2 (TingAn)"
            deployment: stkdev2
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev2.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev2.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev2.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "sticker to dev1 (Nathan)"
            deployment: stkdev1
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev1.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev1.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev1.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "sticker to dev0 (ZhengYan)"
            deployment: stkdev0
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev0.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev0.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev0.vivipic.com"
                  LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "deploy charmix to cmrd"
            deployment: cmrd
            trigger: manual
            condition:
              changesets:
                includePaths:
                  - "*"
                  - "tools/**"
                  - "projects/cm/**"
                  - "packages/**"
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_CHARMIX
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_CHARMIX
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_CHARMIX
                  S3_BUCKET: "nuphoto.co"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_CHARMIX
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_CHARMIX
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_CHARMIX
                  S3_BUCKET: "nuphoto.co"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_CHARMIX
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_CHARMIX
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_CHARMIX
                  S3_BUCKET: "nuphoto.co"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "charmix to dev5 (Alan)"
            deployment: cmdev5
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev5.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev5.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev5.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "charmix to dev4 (Gary)"
            deployment: cmdev4
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev4.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev4.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev4.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "charmix to dev3 (HsingChi)"
            deployment: cmdev3
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev3.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev3.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev3.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "charmix to dev2 (TingAn)"
            deployment: cmdev2
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev2.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev2.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev2.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "charmix to dev1 (Nathan)"
            deployment: cmdev1
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev1.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev1.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev1.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "charmix to dev0 (ZhengYan)"
            deployment: cmdev0
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev0.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev0.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                  S3_BUCKET: "stkdev0.vivipic.com"
                  LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
        - step:
            name: "create pr to develop"
            trigger: manual
            script:
              - ./tools/bash/pr_others.sh
  branches:
    main/vivipic:
      - parallel:
          - step:
              name: "Verify build environment"
              script: #show node and pnpm version
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - node -v
                - pnpm -v
          - step:
              name: "Start build with node module cache"
              size: 2x
              caches: #set caches for node modules to speed up building
                - node
              image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
              script:
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - pnpm install
                - pnpm run build-skip-cache # Replace with your build/testâ€¦etc. commands
              artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
                - projects/pic/dist/**
      - step:
          name: "deploy vivipic to test"
          deployment: test
          trigger: manual
          script:
            - pipe: atlassian/aws-s3-deploy:1.1.0
              variables:
                AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                S3_BUCKET: "test.vivipic.com"
                LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
            - pipe: atlassian/aws-s3-deploy:1.1.0
              variables:
                AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                S3_BUCKET: "test.vivipic.com"
                LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                EXTRA_ARGS: "--exclude=* --include=app.html"
            - pipe: atlassian/aws-s3-deploy:1.1.0
              variables:
                AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                S3_BUCKET: "test.vivipic.com"
                LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                EXTRA_ARGS: "--exclude=*.js.map"
                DELETE_FLAG: "true"
      - step:
          name: "deploy vivipic to prod"
          deployment: vivipicprod
          trigger: manual
          script:
            - pipe: atlassian/aws-s3-deploy:1.1.0
              variables:
                AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_PROD
                AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_PROD
                AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_PROD
                S3_BUCKET: "vivipic.com"
                LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
            - pipe: atlassian/aws-s3-deploy:1.1.0
              variables:
                AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_PROD
                AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_PROD
                AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_PROD
                S3_BUCKET: "vivipic.com"
                LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                EXTRA_ARGS: "--exclude=* --include=app.html"
            - pipe: atlassian/aws-s3-deploy:1.1.0
              variables:
                AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_PROD
                AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_PROD
                AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_PROD
                S3_BUCKET: "vivipic.com"
                LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                EXTRA_ARGS: "--exclude=*.js.map"
                DELETE_FLAG: "true"
            - curl -k -X POST "https://api.cloudflare.com/client/v4/zones/$CF_ZONE_ID_VIVIPIC/purge_cache" -H "X-Auth-Email:$CF_MAIL" -H "X-Auth-Key:$CF_KEY" -H "Content-Type:application/json" --data '{"purge_everything":true}'
    main/stk:
      - parallel:
          - step:
              name: "Verify build environment"
              script: #show node and pnpm version
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - node -v
                - pnpm -v
          - step:
              name: "Start build with node module cache"
              size: 2x
              caches: #set caches for node modules to speed up building
                - node
              image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
              script:
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - pnpm install
                - pnpm run build-skip-cache # Replace with your build/testâ€¦etc. commands
              artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
                - projects/stk/dist/**
      - step:
          name: "deploy vivisticker to prod"
          deployment: stkprod
          trigger: manual
          script:
            - pipe: atlassian/aws-s3-deploy:1.1.0
              variables:
                AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                S3_BUCKET: "sticker.vivipic.com"
                LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
            - pipe: atlassian/aws-s3-deploy:1.1.0
              variables:
                AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                S3_BUCKET: "sticker.vivipic.com"
                LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                EXTRA_ARGS: "--exclude=* --include=app.html"
            - pipe: atlassian/aws-s3-deploy:1.1.0
              variables:
                AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                S3_BUCKET: "sticker.vivipic.com"
                LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                EXTRA_ARGS: "--exclude=*.js.map"
                DELETE_FLAG: "true"
            - curl -k -X POST "https://api.cloudflare.com/client/v4/zones/$CF_ZONE_ID_VIVIPIC/purge_cache" -H "X-Auth-Email:$CF_MAIL" -H "X-Auth-Key:$CF_KEY" -H "Content-Type:application/json" --data '{"purge_everything":true}'
    develop:
      - parallel:
          - step:
              name: "Verify build environment"
              script: #show node and pnpm version
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - node -v
                - pnpm -v
          - step:
              name: "Start build with node module cache"
              size: 2x
              caches: #set caches for node modules to speed up building
                - node
              image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
              script:
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - pnpm install
                - pnpm run build-skip-cache # Replace with your build/testâ€¦etc. commands
              artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
                - projects/*/dist/**
      - parallel:
          - step:
              name: "Run E2E Tests"
              size: 2x
              caches: #set caches for node modules to speed up building
                - node
              image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
              script:
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - npx cypress install
                - npx cypress -v
                - cp -r projects/pic/dist projects/pic/dist-cy
                - rm projects/pic/dist-cy/index.html
                - mv projects/pic/dist-cy/app.html projects/pic/dist-cy/index.html
                - (pnpm run --filter @nu/pic preview-cy &)
                - npx cypress run --record --browser chrome
              artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
                - cypress-visual-report/**
                - cypress-visual-screenshots/**
          - step:
              name: "deploy vivipic to rd"
              deployment: vivipicrd
              trigger: manual
              script:
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                    S3_BUCKET: "rd.vivipic.com"
                    LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                    S3_BUCKET: "rd.vivipic.com"
                    LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=* --include=app.html"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                    S3_BUCKET: "rd.vivipic.com"
                    LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*.js.map"
                    DELETE_FLAG: "true"
          - step:
              name: "deploy vivisticker to stkrd"
              deployment: stkrd
              trigger: manual
              script:
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                    S3_BUCKET: "stkrd.vivipic.com"
                    LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*.js.map"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                    S3_BUCKET: "stkrd.vivipic.com"
                    LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                    S3_BUCKET: "stkrd.vivipic.com"
                    LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*.js.map"
                    DELETE_FLAG: "true"
          - step:
              name: "deploy charmix to cmrd"
              deployment: cmrd
              trigger: manual
              script:
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_CHARMIX
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_CHARMIX
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_CHARMIX
                    S3_BUCKET: "nuphoto.co"
                    LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*.js.map"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_CHARMIX
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_CHARMIX
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_CHARMIX
                    S3_BUCKET: "nuphoto.co"
                    LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_CHARMIX
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_CHARMIX
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_CHARMIX
                    S3_BUCKET: "nuphoto.co"
                    LOCAL_PATH: "projects/cm/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*.js.map"
                    DELETE_FLAG: "true"
          - step:
              name: "pr to qa (Vivipic)"
              trigger: manual
              script:
                - ./tools/bash/pr_develop_to_qa.sh
          # - step:
          #     name: "pr to main/stk (Vivisticker)"
          #     trigger: manual
          #     script:
          #       - ./tools/bash/pr_develop_to_stk.sh
          - step:
              name: "pr to qa-stk (Vivisticker)"
              trigger: manual
              script:
                - ./tools/bash/pr_develop_to_qa-stk.sh
          - step:
              name: "pr to main/cm (Charmix)"
              trigger: manual
              script:
                - ./tools/bash/pr_develop_to_cm.sh
    hotfix:
      - parallel:
          - step:
              name: "Verify build environment"
              script: #show node and pnpm version
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - node -v
                - pnpm -v
          - step:
              name: "Start build with node module cache"
              size: 2x
              caches: #set caches for node modules to speed up building
                - node
              image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
              script:
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - pnpm install
                - pnpm run build-skip-cache # Replace with your build/testâ€¦etc. commands
              artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
                - projects/*/dist/**
      - parallel:
          - step:
              name: "Run E2E Tests"
              size: 2x
              caches: #set caches for node modules to speed up building
                - node
              image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
              script:
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - npx cypress install
                - npx cypress -v
                - cp -r projects/pic/dist projects/pic/dist-cy
                - rm projects/pic/dist-cy/index.html
                - mv projects/pic/dist-cy/app.html projects/pic/dist-cy/index.html
                - (pnpm run --filter @nu/pic preview-cy &)
                - npx cypress run --record --browser chrome
              artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
                - cypress-visual-report/**
                - cypress-visual-screenshots/**
          - step:
              name: "pr to all project"
              trigger: manual
              script:
                - ./tools/bash/pr_hotfix_to_all.sh
          - step:
              name: "pr to main/vivipic (Vivipic)"
              trigger: manual
              script:
                - ./tools/bash/pr_hotfix_to_vivipic.sh
          - step:
              name: "pr to main/stk (Vivisticker)"
              trigger: manual
              script:
                - ./tools/bash/pr_hotfix_to_stk.sh
          - step:
              name: "pr to main/cm (Charmix)"
              trigger: manual
              script:
                - ./tools/bash/pr_hotfix_to_cm.sh
    qa:
      - parallel:
          - step:
              name: "Verify build environment"
              script: #show node and pnpm version
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - node -v
                - pnpm -v
          - step:
              name: "Start build with node module cache"
              size: 2x
              caches: #set caches for node modules to speed up building
                - node
              image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
              script:
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - pnpm install
                - pnpm run build-skip-cache # Replace with your build/testâ€¦etc. commands
              artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
                - projects/pic/dist/**
      - parallel:
          - step:
              name: "Run E2E Tests"
              size: 2x
              caches: #set caches for node modules to speed up building
                - node
              image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
              script:
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - npx cypress install
                - npx cypress -v
                - cp -r projects/pic/dist projects/pic/dist-cy
                - rm projects/pic/dist-cy/index.html
                - mv projects/pic/dist-cy/app.html projects/pic/dist-cy/index.html
                - (pnpm run --filter @nu/pic preview-cy &)
                - npx cypress run --record --browser chrome
              artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
                - cypress-visual-report/**
                - cypress-visual-screenshots/**
          - step:
              name: "deploy to qa"
              deployment: qa
              trigger: manual
              script:
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                    S3_BUCKET: "qa.vivipic.com"
                    LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                    S3_BUCKET: "qa.vivipic.com"
                    LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=* --include=app.html"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                    S3_BUCKET: "qa.vivipic.com"
                    LOCAL_PATH: "projects/pic/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*.js.map"
                    DELETE_FLAG: "true"
          - step:
              name: "create pull request"
              trigger: manual
              script:
                - ./tools/bash/pr_others.sh
    qa-stk:
      - parallel:
          - step:
              name: "Verify build environment"
              script: #show node and pnpm version
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - node -v
                - pnpm -v
          - step:
              name: "Start build with node module cache"
              size: 2x
              caches: #set caches for node modules to speed up building
                - node
              image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
              script:
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - pnpm install
                - pnpm run build-skip-cache # Replace with your build/testâ€¦etc. commands
              artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
                - projects/pic/dist/**
      - parallel:
          - step:
              name: "deploy to qa-stk"
              deployment: qastk
              trigger: manual
              script:
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                    S3_BUCKET: "stktest.vivipic.com"
                    LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                    S3_BUCKET: "stktest.vivipic.com"
                    LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=* --include=app.html"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_STICKER
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_STICKER
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_STICKER
                    S3_BUCKET: "stktest.vivipic.com"
                    LOCAL_PATH: "projects/stk/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*.js.map"
                    DELETE_FLAG: "true"
          - step:
              name: "create pull request"
              trigger: manual
              script:
                - ./tools/bash/pr_others.sh
