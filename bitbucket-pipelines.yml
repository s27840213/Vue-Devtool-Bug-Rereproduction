# https://www.notion.so/vivipic/repo-variables-f30a0f1dfba746ff97f8f94f6f257da2?pvs=4

image: node:16.19.1

definitions:
  caches:
    pnpm: $BITBUCKET_CLONE_DIR/.pnpm-store

pipelines:
  default: #for feature
    - parallel:
        - step:
            name: "Verify build environment"
            script: #show node and pnpm version
              - corepack enable
              - corepack prepare pnpm@latest-8 --activate
              - node -v
              - pnpm -v
        - step:
            name: "Start build with node module cache"
            size: 2x
            caches: #set caches for node modules to speed up building
              - node
            image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
            script:
              - corepack enable
              - corepack prepare pnpm@latest-8 --activate
              - pnpm install
              - pnpm run build-all # Replace with your build/test…etc. commands
            artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
              - projects/*/dist/**
              - projects/*/node_modules/**
    # - parallel:
    #     # - step:
    #     #     name: "Run E2E Tests"
    #     #     size: 2x
    #     #     image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
    #     #     script:
    #     #       - npx cypress install
    #     #       - yarn serve & npx wait-on http://localhost:8080
    #     #       - npx cypress run --record --browser chrome
    #     #     artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
    #     #       - cypress-visual-report/**
    #     #       - cypress-visual-screenshots/**
        - step:
            name: "vivipic to dev5 (Alan)"
            deployment: dev5
            trigger: manual
            script:
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev5.vivipic.com"
                  LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev5.vivipic.com"
                  LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=* --include=app.html"
              - pipe: atlassian/aws-s3-deploy:1.1.0
                variables:
                  AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                  AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                  AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                  S3_BUCKET: "dev5.vivipic.com"
                  LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
                  EXTRA_ARGS: "--exclude=*.js.map"
                  DELETE_FLAG: "true"
    #     - step:
    #         name: "vivipic to dev4 (Gary)"
    #         deployment: dev4
    #         trigger: manual
    #         script:
    #           - pipe: atlassian/aws-s3-deploy:1.1.0
    #             variables:
    #               AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
    #               AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
    #               AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
    #               S3_BUCKET: "dev4.vivipic.com"
    #               LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
    #               EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
    #           - pipe: atlassian/aws-s3-deploy:1.1.0
    #             variables:
    #               AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
    #               AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
    #               AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
    #               S3_BUCKET: "dev4.vivipic.com"
    #               LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
    #               EXTRA_ARGS: "--exclude=* --include=app.html"
    #           - pipe: atlassian/aws-s3-deploy:1.1.0
    #             variables:
    #               AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
    #               AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
    #               AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
    #               S3_BUCKET: "dev4.vivipic.com"
    #               LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
    #               EXTRA_ARGS: "--exclude=*.js.map"
    #               DELETE_FLAG: "true"
        # - step:
        #     name: "vivipic to dev3 (HsingChi)"
        #     deployment: dev3
        #     trigger: manual
        #     script:
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev3.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev3.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=* --include=app.html"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev3.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=*.js.map"
        #           DELETE_FLAG: "true"
        # - step:
        #     name: "vivipic to dev2 (TingAn)"
        #     deployment: dev2
        #     trigger: manual
        #     script:
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev2.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev2.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=* --include=app.html"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev2.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=*.js.map"
        #           DELETE_FLAG: "true"
        # - step:
        #     name: "vivipic to dev1 (Nathan)"
        #     deployment: dev1
        #     trigger: manual
        #     script:
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev1.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev1.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=* --include=app.html"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev1.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=*.js.map"
        #           DELETE_FLAG: "true"
        # - step:
        #     name: "vivipic to dev0 (ZhengYan)"
        #     deployment: dev0
        #     trigger: manual
        #     script:
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev0.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev0.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=* --include=app.html"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev0.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=*.js.map"
        #           DELETE_FLAG: "true"
        # - step:
        #     name: "vivipic to dev5s (Alan)"
        #     deployment: dev5s
        #     trigger: manual
        #     script:
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev5s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev5s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=* --include=app.html"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev5s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=*.js.map"
        #           DELETE_FLAG: "true"
        # - step:
        #     name: "vivipic to dev4s (Gary)"
        #     deployment: dev4s
        #     trigger: manual
        #     script:
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev4s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev4s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=* --include=app.html"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev4s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=*.js.map"
        #           DELETE_FLAG: "true"
        # - step:
        #     name: "vivipic to dev3s (HsingChi)"
        #     deployment: dev3s
        #     trigger: manual
        #     script:
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev3s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev3s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=* --include=app.html"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev3s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=*.js.map"
        #           DELETE_FLAG: "true"
        # - step:
        #     name: "vivipic to dev2s (TingAn)"
        #     deployment: dev2s
        #     trigger: manual
        #     script:
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev2s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev2s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=* --include=app.html"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev2s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=*.js.map"
        #           DELETE_FLAG: "true"
        # - step:
        #     name: "vivipic to dev1s (Nathan)"
        #     deployment: dev1s
        #     trigger: manual
        #     script:
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev1s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev1s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=* --include=app.html"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev1s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=*.js.map"
        #           DELETE_FLAG: "true"
        # - step:
        #     name: "vivipic to dev0s (ZhengYan)"
        #     deployment: dev0s
        #     trigger: manual
        #     script:
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev0s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev0s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=* --include=app.html"
        #       - pipe: atlassian/aws-s3-deploy:1.1.0
        #         variables:
        #           AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
        #           AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
        #           AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
        #           S3_BUCKET: "dev0s.vivipic.com"
        #           LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
        #           EXTRA_ARGS: "--exclude=*.js.map"
        #           DELETE_FLAG: "true"
        # - step:
        #     name: "create pull request"
        #     trigger: manual
        #     script:
        #       - ./tools/bash/create_pull_request.sh
  branches:
    develop:
      - parallel:
          - step:
              name: "Verify build environment"
              script: #show node and pnpm version
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - node -v
                - pnpm -v
          - step:
              name: "Start build with node module cache"
              size: 2x
              caches: #set caches for node modules to speed up building
                - pnpm
              image: cypress/browsers:node-16.18.1-chrome-109.0.5414.74-1-ff-109.0-edge-109.0.1518.52-1
              script:
                - corepack enable
                - corepack prepare pnpm@latest-8 --activate
                - pnpm install
                - pnpm run build-all # Replace with your build/test…etc. commands
              artifacts: #single asterisk (*) to match files in folder, double asterisk (**) to match files and folders in folder
                - projects/*/dist/**
                - projects/*/node_modules/**
      - parallel:
          - step:
              name: "deploy charmix to cmrd"
              deployment: cmrd
              trigger: manual
              condition:
                changesets:
                  includePaths:
                    - '*'
                    - "projects/charmix/**"
                    - "packages/**"
              script:
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_CHARMIX
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_CHARMIX
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_CHARMIX
                    S3_BUCKET: "nuphoto.co"
                    LOCAL_PATH: "projects/charmix/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*.js.map"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_CHARMIX
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_CHARMIX
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_CHARMIX
                    S3_BUCKET: "nuphoto.co"
                    LOCAL_PATH: "projects/charmix/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_CHARMIX
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_CHARMIX
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_CHARMIX
                    S3_BUCKET: "nuphoto.co"
                    LOCAL_PATH: "projects/charmix/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*.js.map"
                    DELETE_FLAG: "true"
          - step:
              name: "deploy vivipic to rd"
              deployment: rd
              trigger: manual
              condition:
                changesets:
                  includePaths:
                    - '*'
                    - "projects/vivipic/**"
                    - "packages/**"
              script:
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                    S3_BUCKET: "dev5.vivipic.com"
                    LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=app.html --exclude=*.js.map"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                    S3_BUCKET: "dev5.vivipic.com"
                    LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=* --include=app.html"
                - pipe: atlassian/aws-s3-deploy:1.1.0
                  variables:
                    AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID_VIVIPIC_TEST
                    AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY_VIVIPIC_TEST
                    AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION_VIVIPIC_TEST
                    S3_BUCKET: "dev5.vivipic.com"
                    LOCAL_PATH: "projects/vivipic/dist" #should be the same as the output folder (artifacts)
                    EXTRA_ARGS: "--exclude=*.js.map"
                    DELETE_FLAG: "true"
          # - step:
          #     name: "create pull request"
          #     trigger: manual
          #     script:
          #       - ./tools/bash/create_pull_request.sh
