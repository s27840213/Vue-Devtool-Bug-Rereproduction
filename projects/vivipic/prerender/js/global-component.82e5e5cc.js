"use strict";(self["webpackChunknueditor"]=self["webpackChunknueditor"]||[]).push([[368],{89194:function(e,t,i){e.exports=i(47393)},90324:function(e){var t=2*Math.PI;function i(e,t,i,s){var r=e*s-t*i<0?-1:1,n=e*i+t*s;return n>1&&(n=1),n<-1&&(n=-1),r*Math.acos(n)}function s(e,s,r,n,a,o,h,c,l,d){var g=d*(e-r)/2+l*(s-n)/2,p=-l*(e-r)/2+d*(s-n)/2,y=h*h,u=c*c,f=g*g,m=p*p,x=y*u-y*m-u*f;x<0&&(x=0),x/=y*m+u*f,x=Math.sqrt(x)*(a===o?-1:1);var I=x*h/c*p,v=x*-c/h*g,S=d*I-l*v+(e+r)/2,w=l*I+d*v+(s+n)/2,b=(g-I)/h,L=(p-v)/c,P=(-g-I)/h,Z=(-p-v)/c,$=i(1,0,b,L),T=i(b,L,P,Z);return 0===o&&T>0&&(T-=t),1===o&&T<0&&(T+=t),[S,w,$,T]}function r(e,t){var i=4/3*Math.tan(t/4),s=Math.cos(e),r=Math.sin(e),n=Math.cos(e+t),a=Math.sin(e+t);return[s,r,s-r*i,r+s*i,n+a*i,a-n*i,n,a]}e.exports=function(e,i,n,a,o,h,c,l,d){var g=Math.sin(d*t/360),p=Math.cos(d*t/360),y=p*(e-n)/2+g*(i-a)/2,u=-g*(e-n)/2+p*(i-a)/2;if(0===y&&0===u)return[];if(0===c||0===l)return[];c=Math.abs(c),l=Math.abs(l);var f=y*y/(c*c)+u*u/(l*l);f>1&&(c*=Math.sqrt(f),l*=Math.sqrt(f));var m=s(e,i,n,a,o,h,c,l,g,p),x=[],I=m[2],v=m[3],S=Math.max(Math.ceil(Math.abs(v)/(t/4)),1);v/=S;for(var w=0;w<S;w++)x.push(r(I,v)),I+=v;return x.map((function(e){for(var t=0;t<e.length;t+=2){var i=e[t+0],s=e[t+1];i*=c,s*=l;var r=p*i-g*s,n=g*i+p*s;e[t+0]=r+m[0],e[t+1]=n+m[1]}return e}))}},50186:function(e){var t=1e-10,i=Math.PI/180;function s(e,t,i){if(!(this instanceof s))return new s(e,t,i);this.rx=e,this.ry=t,this.ax=i}s.prototype.transform=function(e){var s=Math.cos(this.ax*i),r=Math.sin(this.ax*i),n=[this.rx*(e[0]*s+e[2]*r),this.rx*(e[1]*s+e[3]*r),this.ry*(-e[0]*r+e[2]*s),this.ry*(-e[1]*r+e[3]*s)],a=n[0]*n[0]+n[2]*n[2],o=n[1]*n[1]+n[3]*n[3],h=((n[0]-n[3])*(n[0]-n[3])+(n[2]+n[1])*(n[2]+n[1]))*((n[0]+n[3])*(n[0]+n[3])+(n[2]-n[1])*(n[2]-n[1])),c=(a+o)/2;if(h<t*c)return this.rx=this.ry=Math.sqrt(c),this.ax=0,this;var l=n[0]*n[1]+n[2]*n[3];h=Math.sqrt(h);var d=c+h/2,g=c-h/2;return this.ax=Math.abs(l)<t&&Math.abs(d-o)<t?90:180*Math.atan(Math.abs(l)>Math.abs(d-o)?(d-a)/l:l/(d-o))/Math.PI,this.ax>=0?(this.rx=Math.sqrt(d),this.ry=Math.sqrt(g)):(this.ax+=90,this.rx=Math.sqrt(g),this.ry=Math.sqrt(d)),this},s.prototype.isDegenerate=function(){return this.rx<t*this.ry||this.ry<t*this.rx},e.exports=s},4926:function(e){function t(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}function i(){if(!(this instanceof i))return new i;this.queue=[],this.cache=null}i.prototype.matrix=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&0===e[4]&&0===e[5]||(this.cache=null,this.queue.push(e)),this},i.prototype.translate=function(e,t){return 0===e&&0===t||(this.cache=null,this.queue.push([1,0,0,1,e,t])),this},i.prototype.scale=function(e,t){return 1===e&&1===t||(this.cache=null,this.queue.push([e,0,0,t,0,0])),this},i.prototype.rotate=function(e,t,i){var s,r,n;return 0!==e&&(this.translate(t,i),s=e*Math.PI/180,r=Math.cos(s),n=Math.sin(s),this.queue.push([r,n,-n,r,0,0]),this.cache=null,this.translate(-t,-i)),this},i.prototype.skewX=function(e){return 0!==e&&(this.cache=null,this.queue.push([1,0,Math.tan(e*Math.PI/180),1,0,0])),this},i.prototype.skewY=function(e){return 0!==e&&(this.cache=null,this.queue.push([1,Math.tan(e*Math.PI/180),0,1,0,0])),this},i.prototype.toArray=function(){if(this.cache)return this.cache;if(!this.queue.length)return this.cache=[1,0,0,1,0,0],this.cache;if(this.cache=this.queue[0],1===this.queue.length)return this.cache;for(var e=1;e<this.queue.length;e++)this.cache=t(this.cache,this.queue[e]);return this.cache},i.prototype.calc=function(e,t,i){var s;return this.queue.length?(this.cache||(this.cache=this.toArray()),s=this.cache,[e*s[0]+t*s[2]+(i?0:s[4]),e*s[1]+t*s[3]+(i?0:s[5])]):[e,t]},e.exports=i},96715:function(e){var t={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},i=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function s(e){return 10===e||13===e||8232===e||8233===e||32===e||9===e||11===e||12===e||160===e||e>=5760&&i.indexOf(e)>=0}function r(e){switch(32|e){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return!0}return!1}function n(e){return 97===(32|e)}function a(e){return e>=48&&e<=57}function o(e){return e>=48&&e<=57||43===e||45===e||46===e}function h(e){this.index=0,this.path=e,this.max=e.length,this.result=[],this.param=0,this.err="",this.segmentStart=0,this.data=[]}function c(e){while(e.index<e.max&&s(e.path.charCodeAt(e.index)))e.index++}function l(e){var t=e.path.charCodeAt(e.index);return 48===t?(e.param=0,void e.index++):49===t?(e.param=1,void e.index++):void(e.err="SvgPath: arc flag can be 0 or 1 only (at pos "+e.index+")")}function d(e){var t,i=e.index,s=i,r=e.max,n=!1,o=!1,h=!1,c=!1;if(s>=r)e.err="SvgPath: missed param (at pos "+s+")";else if(t=e.path.charCodeAt(s),43!==t&&45!==t||(s++,t=s<r?e.path.charCodeAt(s):0),a(t)||46===t){if(46!==t){if(n=48===t,s++,t=s<r?e.path.charCodeAt(s):0,n&&s<r&&t&&a(t))return void(e.err="SvgPath: numbers started with `0` such as `09` are illegal (at pos "+i+")");while(s<r&&a(e.path.charCodeAt(s)))s++,o=!0;t=s<r?e.path.charCodeAt(s):0}if(46===t){c=!0,s++;while(a(e.path.charCodeAt(s)))s++,h=!0;t=s<r?e.path.charCodeAt(s):0}if(101===t||69===t){if(c&&!o&&!h)return void(e.err="SvgPath: invalid float exponent (at pos "+s+")");if(s++,t=s<r?e.path.charCodeAt(s):0,43!==t&&45!==t||s++,!(s<r&&a(e.path.charCodeAt(s))))return void(e.err="SvgPath: invalid float exponent (at pos "+s+")");while(s<r&&a(e.path.charCodeAt(s)))s++}e.index=s,e.param=parseFloat(e.path.slice(i,s))+0}else e.err="SvgPath: param should start with 0..9 or `.` (at pos "+s+")"}function g(e){var i,s;i=e.path[e.segmentStart],s=i.toLowerCase();var r=e.data;if("m"===s&&r.length>2&&(e.result.push([i,r[0],r[1]]),r=r.slice(2),s="l",i="m"===i?"l":"L"),"r"===s)e.result.push([i].concat(r));else while(r.length>=t[s])if(e.result.push([i].concat(r.splice(0,t[s]))),!t[s])break}function p(e){var i,s,a,h,p,y=e.max;if(e.segmentStart=e.index,i=e.path.charCodeAt(e.index),s=n(i),r(i))if(h=t[e.path[e.index].toLowerCase()],e.index++,c(e),e.data=[],h){for(a=!1;;){for(p=h;p>0;p--){if(!s||3!==p&&4!==p?d(e):l(e),e.err.length)return void g(e);e.data.push(e.param),c(e),a=!1,e.index<y&&44===e.path.charCodeAt(e.index)&&(e.index++,c(e),a=!0)}if(!a){if(e.index>=e.max)break;if(!o(e.path.charCodeAt(e.index)))break}}g(e)}else g(e);else e.err="SvgPath: bad command "+e.path[e.index]+" (at pos "+e.index+")"}e.exports=function(e){var t=new h(e),i=t.max;c(t);while(t.index<i&&!t.err.length)p(t);return t.result.length&&("mM".indexOf(t.result[0][0])<0?(t.err="SvgPath: string should start with `M` or `m`",t.result=[]):t.result[0][0]="M"),{err:t.err,segments:t.result}}},47393:function(e,t,i){var s=i(96715),r=i(64041),n=i(4926),a=i(90324),o=i(50186);function h(e){if(!(this instanceof h))return new h(e);var t=s(e);this.segments=t.segments,this.err=t.err,this.__stack=[]}h.from=function(e){if("string"===typeof e)return new h(e);if(e instanceof h){var t=new h("");return t.err=e.err,t.segments=e.segments.map((function(e){return e.slice()})),t.__stack=e.__stack.map((function(e){return n().matrix(e.toArray())})),t}throw new Error("SvgPath.from: invalid param type "+e)},h.prototype.__matrix=function(e){var t,i=this;e.queue.length&&this.iterate((function(s,r,n,a){var h,c,l,d;switch(s[0]){case"v":h=e.calc(0,s[1],!0),c=0===h[0]?["v",h[1]]:["l",h[0],h[1]];break;case"V":h=e.calc(n,s[1],!1),c=h[0]===e.calc(n,a,!1)[0]?["V",h[1]]:["L",h[0],h[1]];break;case"h":h=e.calc(s[1],0,!0),c=0===h[1]?["h",h[0]]:["l",h[0],h[1]];break;case"H":h=e.calc(s[1],a,!1),c=h[1]===e.calc(n,a,!1)[1]?["H",h[0]]:["L",h[0],h[1]];break;case"a":case"A":var g=e.toArray(),p=o(s[1],s[2],s[3]).transform(g);if(g[0]*g[3]-g[1]*g[2]<0&&(s[5]=s[5]?"0":"1"),h=e.calc(s[6],s[7],"a"===s[0]),"A"===s[0]&&s[6]===n&&s[7]===a||"a"===s[0]&&0===s[6]&&0===s[7]){c=["a"===s[0]?"l":"L",h[0],h[1]];break}c=p.isDegenerate()?["a"===s[0]?"l":"L",h[0],h[1]]:[s[0],p.rx,p.ry,p.ax,s[4],s[5],h[0],h[1]];break;case"m":d=r>0,h=e.calc(s[1],s[2],d),c=["m",h[0],h[1]];break;default:for(l=s[0],c=[l],d=l.toLowerCase()===l,t=1;t<s.length;t+=2)h=e.calc(s[t],s[t+1],d),c.push(h[0],h[1])}i.segments[r]=c}),!0)},h.prototype.__evaluateStack=function(){var e,t;if(this.__stack.length){if(1===this.__stack.length)return this.__matrix(this.__stack[0]),void(this.__stack=[]);e=n(),t=this.__stack.length;while(--t>=0)e.matrix(this.__stack[t].toArray());this.__matrix(e),this.__stack=[]}},h.prototype.toString=function(){var e="",t="",i=!1;this.__evaluateStack();for(var s=0,r=this.segments.length;s<r;s++){var n=this.segments[s],a=n[0];a!==t||"m"===a||"M"===a?("m"===a&&"z"===t&&(e+=" "),e+=a,i=!1):i=!0;for(var o=1;o<n.length;o++){var h=n[o];1===o?i&&h>=0&&(e+=" "):h>=0&&(e+=" "),e+=h}t=a}return e},h.prototype.translate=function(e,t){return this.__stack.push(n().translate(e,t||0)),this},h.prototype.scale=function(e,t){return this.__stack.push(n().scale(e,t||0===t?t:e)),this},h.prototype.rotate=function(e,t,i){return this.__stack.push(n().rotate(e,t||0,i||0)),this},h.prototype.skewX=function(e){return this.__stack.push(n().skewX(e)),this},h.prototype.skewY=function(e){return this.__stack.push(n().skewY(e)),this},h.prototype.matrix=function(e){return this.__stack.push(n().matrix(e)),this},h.prototype.transform=function(e){return e.trim()?(this.__stack.push(r(e)),this):this},h.prototype.round=function(e){var t,i=0,s=0,r=0,n=0;return e=e||0,this.__evaluateStack(),this.segments.forEach((function(a){var o=a[0].toLowerCase()===a[0];switch(a[0]){case"H":case"h":return o&&(a[1]+=r),r=a[1]-a[1].toFixed(e),void(a[1]=+a[1].toFixed(e));case"V":case"v":return o&&(a[1]+=n),n=a[1]-a[1].toFixed(e),void(a[1]=+a[1].toFixed(e));case"Z":case"z":return r=i,void(n=s);case"M":case"m":return o&&(a[1]+=r,a[2]+=n),r=a[1]-a[1].toFixed(e),n=a[2]-a[2].toFixed(e),i=r,s=n,a[1]=+a[1].toFixed(e),void(a[2]=+a[2].toFixed(e));case"A":case"a":return o&&(a[6]+=r,a[7]+=n),r=a[6]-a[6].toFixed(e),n=a[7]-a[7].toFixed(e),a[1]=+a[1].toFixed(e),a[2]=+a[2].toFixed(e),a[3]=+a[3].toFixed(e+2),a[6]=+a[6].toFixed(e),void(a[7]=+a[7].toFixed(e));default:return t=a.length,o&&(a[t-2]+=r,a[t-1]+=n),r=a[t-2]-a[t-2].toFixed(e),n=a[t-1]-a[t-1].toFixed(e),void a.forEach((function(t,i){i&&(a[i]=+a[i].toFixed(e))}))}})),this},h.prototype.iterate=function(e,t){var i,s,r,n=this.segments,a={},o=!1,h=0,c=0,l=0,d=0;if(t||this.__evaluateStack(),n.forEach((function(t,i){var s=e(t,i,h,c);Array.isArray(s)&&(a[i]=s,o=!0);var r=t[0]===t[0].toLowerCase();switch(t[0]){case"m":case"M":return h=t[1]+(r?h:0),c=t[2]+(r?c:0),l=h,void(d=c);case"h":case"H":return void(h=t[1]+(r?h:0));case"v":case"V":return void(c=t[1]+(r?c:0));case"z":case"Z":return h=l,void(c=d);default:h=t[t.length-2]+(r?h:0),c=t[t.length-1]+(r?c:0)}})),!o)return this;for(r=[],i=0;i<n.length;i++)if("undefined"!==typeof a[i])for(s=0;s<a[i].length;s++)r.push(a[i][s]);else r.push(n[i]);return this.segments=r,this},h.prototype.abs=function(){return this.iterate((function(e,t,i,s){var r,n=e[0],a=n.toUpperCase();if(n!==a)switch(e[0]=a,n){case"v":return void(e[1]+=s);case"a":return e[6]+=i,void(e[7]+=s);default:for(r=1;r<e.length;r++)e[r]+=r%2?i:s}}),!0),this},h.prototype.rel=function(){return this.iterate((function(e,t,i,s){var r,n=e[0],a=n.toLowerCase();if(n!==a&&(0!==t||"M"!==n))switch(e[0]=a,n){case"V":return void(e[1]-=s);case"A":return e[6]-=i,void(e[7]-=s);default:for(r=1;r<e.length;r++)e[r]-=r%2?i:s}}),!0),this},h.prototype.unarc=function(){return this.iterate((function(e,t,i,s){var r,n,o,h=[],c=e[0];return"A"!==c&&"a"!==c?null:("a"===c?(n=i+e[6],o=s+e[7]):(n=e[6],o=e[7]),r=a(i,s,n,o,e[4],e[5],e[1],e[2],e[3]),0===r.length?[["a"===e[0]?"l":"L",e[6],e[7]]]:(r.forEach((function(e){h.push(["C",e[2],e[3],e[4],e[5],e[6],e[7]])})),h))})),this},h.prototype.unshort=function(){var e,t,i,s,r,n=this.segments;return this.iterate((function(a,o,h,c){var l,d=a[0],g=d.toUpperCase();o&&("T"===g?(l="t"===d,i=n[o-1],"Q"===i[0]?(e=i[1]-h,t=i[2]-c):"q"===i[0]?(e=i[1]-i[3],t=i[2]-i[4]):(e=0,t=0),s=-e,r=-t,l||(s+=h,r+=c),n[o]=[l?"q":"Q",s,r,a[1],a[2]]):"S"===g&&(l="s"===d,i=n[o-1],"C"===i[0]?(e=i[3]-h,t=i[4]-c):"c"===i[0]?(e=i[3]-i[5],t=i[4]-i[6]):(e=0,t=0),s=-e,r=-t,l||(s+=h,r+=c),n[o]=[l?"c":"C",s,r,a[1],a[2],a[3],a[4]]))})),this},e.exports=h},64041:function(e,t,i){var s=i(4926),r={matrix:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},n=/\s*(matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(.+?)\s*\)[\s,]*/,a=/[\s,]+/;e.exports=function(e){var t,i,o=new s;return e.split(n).forEach((function(e){if(e.length)if("undefined"===typeof r[e])switch(i=e.split(a).map((function(e){return+e||0})),t){case"matrix":return void(6===i.length&&o.matrix(i));case"scale":return void(1===i.length?o.scale(i[0],i[0]):2===i.length&&o.scale(i[0],i[1]));case"rotate":return void(1===i.length?o.rotate(i[0],0,0):3===i.length&&o.rotate(i[0],i[1],i[2]));case"translate":return void(1===i.length?o.translate(i[0],0):2===i.length&&o.translate(i[0],i[1]));case"skewX":return void(1===i.length&&o.skewX(i[0]));case"skewY":return void(1===i.length&&o.skewY(i[0]))}else t=e})),o}},45320:function(e,t,i){var s=i(29651),r=Object.defineProperty,n=(e,t,i)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,a=(e,t,i)=>(n(e,"symbol"!==typeof t?t+"":t,i),i);class o{constructor(){a(this,"showHint"),a(this,"timerId"),a(this,"currHint"),this.showHint=!1,this.timerId=-1,this.currHint="default hint"}openHint(e,t){this.showHint=!0,this.currHint=t,this.showHintUnderTarget(e)}closeHint(){this.showHint=!1}bind(e,t,i=300){e.addEventListener("mouseenter",(()=>{this.timerId=window.setTimeout((()=>{this.openHint(e,t)}),i)})),e.addEventListener("mouseleave",(()=>{this.closeHint(),clearTimeout(this.timerId)}))}unbind(e,t,i=300){e.removeEventListener("mouseenter",(()=>{this.timerId=window.setTimeout((()=>{this.openHint(e,t)}),i)})),e.removeEventListener("mouseleave",(()=>{clearTimeout(this.timerId)})),clearTimeout(this.timerId),this.closeHint()}showHintUnderTarget(e){(0,s.Y3)((()=>{const t=document.querySelector(".hint"),[i,s]=[t.offsetWidth,t.offsetHeight],[r,n]=[window.innerWidth||document.documentElement.clientWidth,window.innerHeight||document.documentElement.clientHeight],{left:a,bottom:o,width:h,height:c}=null==e?void 0:e.getBoundingClientRect();let l=0,d=0;const g=a,p=o;a+i>r&&(l=a+i-r),o+s>n&&(d=o+s-n),t.style.transform=`translate3d(${g-(i-h)/2-l}px, ${p-d+5}px,0)`}))}}t["Z"]=new o},15789:function(e,t,i){i.d(t,{Z:function(){return m}});var s=i(89497),r=i(6400),n=i(89995),a=i(2531),o=i(7230),h=i(62013),c=i(78871),l=i(70118),d=i(3162),g=i(75231),p=i(16290),y=Object.defineProperty,u=(e,t,i)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,f=(e,t,i)=>(u(e,"symbol"!==typeof t?t+"":t,i),i);class m{constructor({_config:e,body:t,layerInfo:i}){f(this,"component"),f(this,"body"),f(this,"_config",{config:null,primaryLayer:null}),f(this,"layerInfo",{pageIndex:g.ZP.pageIndex,layerIndex:g.ZP.layerIndex,subLayerIdx:g.ZP.subLayerIdx}),f(this,"dblTapFlag",!1),f(this,"touches",new Set),f(this,"posDiff",{x:0,y:0}),f(this,"_onMouseup",null),f(this,"_cursorDragEnd",null),this._config=e,this.body=t,i&&(this.layerInfo=i)}get config(){return this._config.config}get primaryLayer(){return this._config.primaryLayer}get pageIndex(){return this.layerInfo.pageIndex}get layerIndex(){return this.layerInfo.layerIndex}get subLayerIdx(){var e;return null!=(e=this.layerInfo.subLayerIdx)?e:-1}get primaryActive(){return this.primaryLayer.active}onPointerdown(e){var t,i;if("tmp"===this.primaryLayer.type)return c.Z.exact([e.shiftKey,e.ctrlKey,e.metaKey])&&l.Z.deselectTargetLayer(this.subLayerIdx),void(l.Z.inMultiSelecitonMode&&(this._onMouseup=this.onMouseup.bind(this),a.ZP.addPointerEvent("pointerup",this._onMouseup)));if(!s.Z.getters["mobileEditor/getIsPinchingEditor"]&&(l.Z.inMultiSelecitonMode&&["tmp","frame"].includes(this.primaryLayer.type)&&(this._onMouseup=this.onMouseup.bind(this),a.ZP.addPointerEvent("pointerup",this._onMouseup)),0===e.button)){if(this.touches.has(e.pointerId)||this.touches.add(e.pointerId),d.Z.isImgControl()&&d.Z.setImgControlDefault(),c.Z.isTouchDevice()&&!this.dblTapFlag&&this.config.active&&"image"===this.config.type){const e=Date.now(),t=500,i=i=>{if(i.preventDefault(),Date.now()-e<t&&!this.dblTapFlag&&1===this.touches.size){if(this.config.type===r.F5.image){switch(this.primaryLayer.type){case r.F5.group:g.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{imgControl:!0},this.subLayerIdx);break;case r.F5.frame:"frame"!==this.config.srcObj.type&&h.Z.updateFrameLayerProps(this.pageIndex,this.layerIndex,this.subLayerIdx,{imgControl:!0});break}a.ZP.emit(a.rZ.switchTab,"crop")}this.dblTapFlag=!0}};this.body.addEventListener("pointerdown",i),setTimeout((()=>{this.body.removeEventListener("pointerdown",i),this.dblTapFlag=!1}),t)}if(s.Z.getters.getCurrFunctionPanelType===r.UJ.photoShadow&&(l.Z.deselect(),l.Z.select(this.pageIndex,[this.layerIndex]),g.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{active:!0},this.subLayerIdx),a.ZP.emit(a.rZ.showPhotoShadow)),o.Z.applyFormatIfCopied(this.pageIndex,this.layerIndex,this.subLayerIdx),o.Z.clearCopiedFormat(),"text"===this.config.type){if(this.posDiff.x=this.primaryLayer.styles.x,this.posDiff.y=this.primaryLayer.styles.y,(null==(t=this.config)?void 0:t.active)&&this.config.contentEditable)return g.ZP.updateSubLayerProps(this.pageIndex,this.layerIndex,this.subLayerIdx,{isDraggingCursor:!0}),this._cursorDragEnd=this.onCursorDragEnd.bind(this),void a.ZP.addPointerEvent("pointerup",this._cursorDragEnd);if(!(null==(i=this.config)?void 0:i.active))return g.ZP.updateSubLayerProps(this.pageIndex,this.layerIndex,this.subLayerIdx,{contentEditable:!1}),this._onMouseup=this.onMouseup.bind(this),void a.ZP.addPointerEvent("pointerup",this._onMouseup);g.ZP.updateSubLayerProps(this.pageIndex,this.layerIndex,this.subLayerIdx,{contentEditable:!0})}this._onMouseup=this.onMouseup.bind(this),a.ZP.addPointerEvent("pointerup",this._onMouseup)}}onCursorDragEnd(e){g.ZP.updateSubLayerProps(this.pageIndex,this.layerIndex,this.subLayerIdx,{isDraggingCursor:!1}),a.ZP.removePointerEvent("pointerup",this._cursorDragEnd)}onMouseup(e){if(this.touches.delete(e.pointerId),a.ZP.removePointerEvent("pointerup",this._onMouseup),e.stopPropagation(),!this.primaryLayer.active)return;"text"===this.config.type&&(this.posDiff.x=this.primaryLayer.styles.x-this.posDiff.x,this.posDiff.y=this.primaryLayer.styles.y-this.posDiff.y,0!==this.posDiff.x||0!==this.posDiff.y?g.ZP.updateSubLayerProps(this.pageIndex,this.layerIndex,this.subLayerIdx,{contentEditable:!1}):this.config.contentEditable&&(g.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{isTyping:!0},this.subLayerIdx),c.Z.isTouchDevice()?p.Z.focus({scrollIntoView:!1},"end"):p.Z.focus({scrollIntoView:!1}))),n.ZP.event.emit("closeColorPanel",!1);let t=null,i=null;switch(this.primaryLayer.type){case"group":t=g.ZP.updateSubLayerProps,i=g.ZP.getCurrLayer.layers;break;case"frame":if("group"===g.ZP.getCurrLayer.type)return;t=h.Z.updateFrameLayerProps,i=g.ZP.getCurrLayer.clips}if(!s.Z.getters["shadow/isHandling"]&&this.primaryActive&&!s.Z.state.isMoving){if(l.Z.inMultiSelecitonMode&&"frame"!==this.primaryLayer.type)return void l.Z.deselectTargetLayer(this.subLayerIdx);if(-1!==g.ZP.layerIndex)for(let e=0;e<i.length;e++)e!==this.subLayerIdx&&t(this.pageIndex,this.layerIndex,e,{active:!1});(this.primaryLayer.type===r.F5.frame&&!this.primaryLayer.clips[this.subLayerIdx].active||this.primaryLayer.type===r.F5.group&&!this.primaryLayer.layers[this.subLayerIdx].active)&&t(this.pageIndex,this.layerIndex,this.subLayerIdx,{active:!0}),g.ZP.setCurrSubSelectedInfo(this.subLayerIdx,this.config.type)}}}},9708:function(e,t,i){i.r(t),i.d(t,{default:function(){return me}});var s=i(29651),r=i(819),n=i(41463);const a=["layer-index"],o={class:"nu-controller__object-hint__icon"},h={class:"nu-controller__object-hint__text"},c=["onPointerdown"],l=["marker-index"],d=["marker-index"],g=["onPointerdown"],p=["onPointerdown"],y=["onPointerdown"],u=["onPointerdown"],f={key:4,class:"control-point__resize-bar-wrapper"},m={class:"control-point__controller-wrapper"},x={class:"control-point__action-icon"},I={key:0,class:"control-point__touch-area control-point__mover",ref:"moveStart-moverArea"},v={class:"control-point__action-icon"},S={key:0,class:"control-point__touch-area control-point__mover",ref:"moveStart-moverArea"},w={key:1};function b(e,t,i,b,L,P){const Z=(0,s.up)("svg-icon"),$=(0,s.up)("nu-sub-controller"),T=(0,s.up)("nu-text-editor"),C=(0,s.up)("action-icon");return(0,s.wg)(),(0,s.iD)("div",{class:"nu-controller","layer-index":`${e.layerIndex}`,ref:"self"},[e.isLineEndMoving?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"nu-controller__line-hint",style:(0,r.j5)(e.hintStyles())},(0,r.zw)(Math.round(e.hintLength)+" | "+Math.round(e.hintAngle)%360+"Â°"),5)):(0,s.kq)("",!0),e.isRotating&&!e.$isTouchDevice()?((0,s.wg)(),(0,s.iD)("div",{key:1,class:"nu-controller__object-hint",style:(0,r.j5)(e.hintStyles())},[(0,s._)("div",o,[(0,s.Wm)(Z,{iconName:"angle",iconWidth:"12px",iconColor:"gray-2"})]),(0,s._)("div",h,[(0,s._)("span",null,(0,r.zw)(Math.round(e.hintAngle)%360),1)])],4)):(0,s.kq)("",!0),e.subLayer&&e.subLayer.config?((0,s.wg)(),(0,s.iD)("div",{key:2,class:"nu-controller__sublayer-container",style:(0,r.j5)(e.sizeStyles)},["image"===e.subLayer.config.type&&e.subLayer.config.imgControl||e.FrameUtils.isImageFrame(e.config)?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)($,{class:"relative nu-controller__subCtrlContent",style:(0,r.j5)(e.subContentStyles),"data-identifier":"controller",key:`group-controller-${e.subLayer.config.id}`,pageIndex:e.pageIndex,page:e.page,layerIndex:e.subLayer.subLayerIdx,primaryLayerIndex:e.layerIndex,primaryLayer:e.config,config:"frame"!==e.getLayerType||e.FrameUtils.isImageFrame(e.subLayer.config)?e.subLayer.config:e.frameLayerMapper(e.subLayer.config),type:e.config.type,primaryLayerZindex:e.primaryLayerZindex(),isMoved:e.isMoved,contentScaleRatio:e.contentScaleRatio},null,8,["style","pageIndex","page","layerIndex","primaryLayerIndex","primaryLayer","config","type","primaryLayerZindex","isMoved","contentScaleRatio"]))],4)):(0,s.kq)("",!0),(0,s.wy)((0,s._)("div",{class:"nu-controller__content",style:(0,r.j5)(e.contentStyles)},[(0,s.wy)((0,s._)("div",{class:"nu-controller__ctrl-points",style:(0,r.j5)(e.ctrlPtrStyles),ref:"body",onContextmenu:[t[31]||(t[31]=(0,n.iM)((()=>{}),["prevent"])),t[32]||(t[32]=(0,n.iM)(((...t)=>e.onRightClick&&e.onRightClick(...t)),["right","stop"]))]},["text"===e.config.type&&e.config.active?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"text text__wrapper",style:(0,r.j5)(e.textWrapperStyle()),draggable:"false"},[(0,s.Wm)(T,{class:"text__body",initText:e.textHtml,id:`text-${e.layerIndex}`,style:(0,r.j5)(e.textBodyStyle()),pageIndex:e.pageIndex,page:e.page,layerIndex:e.layerIndex,config:e.config,subLayerIndex:-1,pageId:e.page.id,layerId:e.config.id,subLayerId:"",onKeydown:[t[0]||(t[0]=(0,n.D2)((0,n.iM)((()=>{}),["stop"]),["left"])),t[1]||(t[1]=(0,n.D2)((0,n.iM)((()=>{}),["stop"]),["up"])),t[2]||(t[2]=(0,n.D2)((0,n.iM)((()=>{}),["stop"]),["right"])),t[3]||(t[3]=(0,n.D2)((0,n.iM)((()=>{}),["stop"]),["down"])),t[4]||(t[4]=(0,n.D2)((0,n.iM)((()=>{}),["ctrl","exact","stop","self"]),["c"])),t[5]||(t[5]=(0,n.D2)((0,n.iM)((()=>{}),["meta","exact","stop","self"]),["c"])),t[6]||(t[6]=(0,n.D2)((0,n.iM)((()=>{}),["ctrl","exact","stop","self"]),["v"])),t[7]||(t[7]=(0,n.D2)((0,n.iM)((()=>{}),["meta","exact","stop","self"]),["v"])),t[8]||(t[8]=(0,n.D2)((0,n.iM)((()=>{}),["ctrl","exact","stop","self"]),["x"])),t[9]||(t[9]=(0,n.D2)((0,n.iM)((()=>{}),["meta","exact","stop","self"]),["x"])),t[10]||(t[10]=(0,n.D2)((0,n.iM)((()=>{}),["ctrl","exact","stop","self"]),["a"])),t[11]||(t[11]=(0,n.D2)((0,n.iM)((()=>{}),["meta","exact","stop","self"]),["a"])),t[12]||(t[12]=(0,n.D2)((0,n.iM)((()=>{}),["ctrl","exact","stop","self"]),["z"])),t[13]||(t[13]=(0,n.D2)((0,n.iM)((()=>{}),["meta","exact","stop","self"]),["z"])),t[14]||(t[14]=(0,n.D2)((0,n.iM)((()=>{}),["ctrl","shift","exact","stop","self"]),["z"])),t[15]||(t[15]=(0,n.D2)((0,n.iM)((()=>{}),["meta","shift","exact","stop","self"]),["z"]))],onUpdate:e.handleTextChange,onCompositionend:e.handleTextCompositionEnd},null,8,["initText","id","style","pageIndex","page","layerIndex","config","pageId","layerId","onUpdate","onCompositionend"])],4)):(0,s.kq)("",!0),e.$isTouchDevice()?(0,s.kq)("",!0):((0,s.wg)(!0),(0,s.iD)(s.HY,{key:1},(0,s.Ko)(e.isLine()?[]:e.getCornerRotaters(e.cornerRotaters),((i,a)=>(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",{class:"control-point__corner-rotate",ref_for:!0,ref:`corner-rotate-${a}`,key:`corner-rotate-${a}`,style:(0,r.j5)(e.ctrlPointerStyles(i.styles,e.cursorStyles(a,e.getLayerRotate(),"cornerRotaters"))),onPointerdown:(0,n.iM)((t=>e.rotateStart(t,a)),["stop"]),onTouchstart:t[16]||(t[16]=(...t)=>e.disableTouchEvent&&e.disableTouchEvent(...t))},null,44,c)),[[n.F8,!e.isMoving]]))),128)),e.isLine()?((0,s.wg)(),(0,s.iD)(s.HY,{key:2},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.controlPoints.lineEnds,((i,a)=>(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",{class:"control-point",key:a,"marker-index":a,style:(0,r.j5)(e.ctrlPointerStyles(i,{cursor:"pointer"})),onPointerdown:t[17]||(t[17]=(0,n.iM)((t=>e.$isTouchDevice()?null:e.lineEndMoveStart(t)),["stop"])),onTouchstart:t[18]||(t[18]=t=>e.$isTouchDevice()?null:e.disableTouchEvent(t))},null,44,l)),[[n.F8,!e.isMoving]]))),128)),e.$isTouchDevice()?((0,s.wg)(!0),(0,s.iD)(s.HY,{key:0},(0,s.Ko)(e.controlPoints.lineEndTouchAreas,((i,a)=>(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",{class:"control-point",key:a,"marker-index":a,style:(0,r.j5)(e.ctrlPointerStyles(i,{cursor:"pointer"})),onPointerdown:t[19]||(t[19]=(0,n.iM)(((...t)=>e.lineEndMoveStart&&e.lineEndMoveStart(...t)),["stop"])),onTouchstart:t[20]||(t[20]=(...t)=>e.disableTouchEvent&&e.disableTouchEvent(...t))},null,44,d)),[[n.F8,!e.isMoving]]))),128)):(0,s.kq)("",!0)],64)):(0,s.kq)("",!0),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.getResizer(e.controlPoints),((i,a)=>(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",{class:"control-point__resize-bar-wrapper",key:a},[((0,s.wg)(),(0,s.iD)("div",{class:"control-point",key:`resizer-${a}`,style:(0,r.j5)(Object.assign(e.resizerBarStyles(i.styles),e.cursorStyles(i.cursor,e.getLayerRotate()))),onPointerdown:(0,n.iM)((t=>e.$isTouchDevice()?null:e.resizeStart(t,i.type)),["prevent","stop"]),onTouchstart:t[21]||(t[21]=t=>e.$isTouchDevice()?null:e.disableTouchEvent(t))},null,44,g)),(0,s._)("div",{class:"control-point",style:(0,r.j5)(Object.assign(e.resizerStyles(i.styles),e.cursorStyles(i.cursor,e.getLayerRotate()))),onPointerdown:(0,n.iM)((t=>e.$isTouchDevice()?null:e.resizeStart(t,i.type)),["prevent","stop"]),onTouchstart:t[22]||(t[22]=t=>e.$isTouchDevice()?null:e.disableTouchEvent(t))},null,44,p)])),[[n.F8,!e.isMoving]]))),128)),e.$isTouchDevice()?((0,s.wg)(!0),(0,s.iD)(s.HY,{key:3},(0,s.Ko)(e.getResizer(e.controlPoints,!1,!0),((i,a)=>(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",{class:"control-point__resize-bar-wrapper",key:a},[((0,s.wg)(),(0,s.iD)("div",{class:"control-point",key:`resizer-touch-${a}`,style:(0,r.j5)(Object.assign(e.resizerBarStyles(i.styles),e.cursorStyles(i.cursor,e.getLayerRotate()))),onPointerdown:(0,n.iM)((t=>e.resizeStart(t,i.type)),["prevent","stop"]),onTouchstart:t[23]||(t[23]=(...t)=>e.disableTouchEvent&&e.disableTouchEvent(...t))},null,44,y)),(0,s._)("div",{class:"control-point",style:(0,r.j5)(Object.assign(e.resizerStyles(i.styles,!0),e.cursorStyles(i.cursor,e.getLayerRotate()))),onPointerdown:(0,n.iM)((t=>e.resizeStart(t,i.type)),["prevent","stop"]),onTouchstart:t[24]||(t[24]=(...t)=>e.disableTouchEvent&&e.disableTouchEvent(...t))},null,44,u)])),[[n.F8,!e.isMoving]]))),128)):(0,s.kq)("",!0),"text"===e.config.type&&e.contentEditable&&!e.$isTouchDevice()?(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",f,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.getResizer(e.controlPoints,!0),((t,i)=>((0,s.wg)(),(0,s.iD)("div",{class:"control-point control-point__move-bar",key:`resizer-text-${i}`,ref_for:!0,ref:`moveStart-bar_${i}`,style:(0,r.j5)(e.resizerBarStyles(t.styles))},null,4)))),128))],512)),[[n.F8,!e.isMoving]]):(0,s.kq)("",!0),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.isLine()?[]:e.getScaler(e.controlPoints.scalers),((i,a)=>(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",{class:"control-point",key:`scaler-${a}`,style:(0,r.j5)(Object.assign(i.styles,e.cursorStyles(i.cursor,e.getLayerRotate()))),onPointerdown:t[25]||(t[25]=(0,n.iM)((t=>e.$isTouchDevice()?null:e.scaleStart(t)),["prevent","stop"])),onTouchstart:t[26]||(t[26]=t=>e.$isTouchDevice()?null:e.disableTouchEvent(t))},null,36)),[[n.F8,!e.isMoving]]))),128)),e.$isTouchDevice()?((0,s.wg)(!0),(0,s.iD)(s.HY,{key:5},(0,s.Ko)(e.isLine()?[]:e.getScaler(e.controlPoints.scalerTouchAreas),((i,a)=>(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",{class:"control-point",key:`scaler-touch-${a}`,style:(0,r.j5)(Object.assign(i.styles,e.cursorStyles(i.cursor,e.getLayerRotate()))),onPointerdown:t[27]||(t[27]=(0,n.iM)(((...t)=>e.scaleStart&&e.scaleStart(...t)),["prevent","stop"])),onTouchstart:t[28]||(t[28]=(...t)=>e.disableTouchEvent&&e.disableTouchEvent(...t))},null,36)),[[n.F8,!e.isMoving]]))),128)):(0,s.kq)("",!0),(0,s.wy)((0,s._)("div",m,[e.isLine()?((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[e.$isTouchDevice()?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(C,{key:0,iconName:"rotate2",iconWidth:"20px",theme:"shadow",extraStyle:e.ctrlPointerStyles(e.lineControlPointStyles(),{cursor:"move"}),onAction:e.lineRotateStart},null,8,["extraStyle","onAction"])),(0,s._)("div",x,[e.$isTouchDevice()?((0,s.wg)(),(0,s.iD)("div",I,null,512)):(0,s.kq)("",!0),(0,s._)("div",{class:"control-point__action shadow control-point__mover",ref:"moveStart-mover",style:(0,r.j5)(e.ctrlPointerStyles(e.lineControlPointStyles(),{cursor:"move"})),onTouchstart:t[29]||(t[29]=(...t)=>e.disableTouchEvent&&e.disableTouchEvent(...t))},[(0,s.Wm)(Z,{class:"control-point__action-svg",iconName:"move2",iconWidth:"24px",iconColor:"blue-2"})],36)])],64)):((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[e.$isTouchDevice()?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(C,{key:0,iconName:"rotate2",iconWidth:"20px",theme:"shadow",extraStyle:e.ctrlPointerStyles(e.controlPointStyles(),{cursor:"move"}),onAction:e.rotateStart},null,8,["extraStyle","onAction"])),(0,s._)("div",v,[e.$isTouchDevice()?((0,s.wg)(),(0,s.iD)("div",S,null,512)):(0,s.kq)("",!0),(0,s._)("div",{class:"control-point__action shadow control-point__mover",ref:"moveStart-mover",style:(0,r.j5)(e.ctrlPointerStyles(e.controlPointStyles(),{cursor:"move"})),onTouchstart:t[30]||(t[30]=(...t)=>e.disableTouchEvent&&e.disableTouchEvent(...t))},[(0,s.Wm)(Z,{class:"control-point__action-svg",iconName:"move2",iconWidth:"24px",iconColor:"blue-2"})],36)])],64))],512),[[n.F8,!e.isMoving]])],36),[[n.F8,!e.isLocked()]]),e.isActive&&e.isLocked()&&e.scaleRatio>20?((0,s.wg)(),(0,s.j4)(C,{key:0,class:"control-point__bottom-right-icon",iconName:"lock",iconSize:"16px",iconColor:"red",theme:"shadow",extraStyle:e.actionIconStyles(),onAction:t[33]||(t[33]=t=>e.MappingUtils.mappingIconAction("lock"))},null,8,["extraStyle"])):(0,s.kq)("",!0),e.$isTouchDevice()&&e.isActive&&!e.isLocked()?(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",w,[(0,s.Wm)(C,{class:"control-point__top-left-icon",iconName:"close",iconSize:"18px",theme:"border",extraStyle:e.ctrlPointerStyles(e.actionIconStyles(),{cursor:"pointer"}),onAction:t[34]||(t[34]=t=>e.MappingUtils.mappingIconAction("trash"))},null,8,["extraStyle"]),(0,s.Wm)(C,{class:"control-point__bottom-left-icon",iconName:"rotate2",theme:"border",extraStyle:e.ctrlPointerStyles(e.actionIconStyles(),{cursor:"move"}),onAction:t[35]||(t[35]=t=>e.isLine()?e.lineRotateStart(t):e.rotateStart(t))},null,8,["extraStyle"]),e.tooSmall||e.isLine()?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(C,{key:0,class:"control-point__bottom-right-icon",iconName:"scale",theme:"border",extraStyle:e.ctrlPointerStyles(e.actionIconStyles(),e.cursorStyles(4,e.getLayerRotate())),onAction:e.scaleStart},null,8,["extraStyle","onAction"]))],512)),[[n.F8,!e.isMoving]]):(0,s.kq)("",!0)],4),[[n.F8,e.isActive&&!e.isImgControl]])],8,a)}const L={class:"control-point__action-icon"},P=["onPointerdown"],Z=["onPointerdown"];function $(e,t,i,a,o,h){const c=(0,s.up)("svg-icon");return(0,s.wg)(),(0,s.iD)("div",L,[e.$isTouchDevice()?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"control-point__touch-area",onPointerdown:(0,n.iM)(a.pointerDown,["prevent","stop"])},null,40,P)):(0,s.kq)("",!0),(0,s._)("div",{class:(0,r.C_)(["control-point__action",[i.theme,...i.extraClasses]]),style:(0,r.j5)(i.extraStyle),onPointerdown:(0,n.iM)(a.pointerDown,["prevent","stop"]),onTouchstart:a.disableTouchEvent},[(0,s.Wm)(c,{class:"control-point__action-svg",iconName:i.iconName,iconWidth:i.iconSize,iconColor:i.iconColor},null,8,["iconName","iconWidth","iconColor"])],46,Z)])}var T=i(78871),C=(0,s.aZ)({__name:"ActionIcon",props:{iconName:{type:String,required:!0},iconSize:{type:String,default:()=>"24px"},iconColor:{type:String,default:()=>"blue-2"},theme:{type:String,required:!0},extraClasses:{type:Array,default:()=>[]},extraStyle:{type:Object,default:()=>({})}},emits:["action"],setup(e,{expose:t,emit:i}){t();const s=e=>{i("action",e)},r=e=>{T.Z.isTouchDevice()&&e.preventDefault()},n={emit:i,pointerDown:s,disableTouchEvent:r,get generalUtils(){return T.Z}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),M=i(53372);const D=(0,M.Z)(C,[["render",$],["__file","ActionIcon.vue"]]);var _=D,E=i(43539),O=i(28253),R=i(6400),F=i(40881),j=i(71446),k=i(2531),z=i(62013),H=i(70118),N=i(3162),A=i(75231),W=i(65144),B=i(35426),q=i(50543),Y=i(26378),U=i(32905),X=i(53556),K=i(15820),G=i(52632),V=i(74041),Q=i(23917),J=i(89456),ee=i(16290),te=i(38058),ie=Object.defineProperty,se=Object.defineProperties,re=Object.getOwnPropertyDescriptors,ne=Object.getOwnPropertySymbols,ae=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable,he=(e,t,i)=>t in e?ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ce=(e,t)=>{for(var i in t||(t={}))ae.call(t,i)&&he(e,i,t[i]);if(ne)for(var i of ne(t))oe.call(t,i)&&he(e,i,t[i]);return e},le=(e,t)=>se(e,re(t));const de=10,ge=5,pe=30,ye=4e3;var ue=(0,s.aZ)({props:{config:{type:Object,required:!0},layerIndex:{type:Number,required:!0},pageIndex:{type:Number,required:!0},page:{type:Object,required:!0},snapUtils:{type:Object,required:!0},contentScaleRatio:{default:1,type:Number}},emits:["isDragging","setFocus"],components:{NuTextEditor:E.Z,ActionIcon:_},created(){this.cornerRotaters=T.Z.deepCopy(this.controlPoints.cornerRotaters),this.cornerRotaterbaffles=T.Z.deepCopy(this.controlPoints.cornerRotaters)},data(){return{MappingUtils:W.Z,FrameUtils:z.Z,controlPoints:F.Z.getControlPoints(),isControlling:!1,isLineEndMoving:!1,isRotating:!1,hintTranslation:{x:0,y:0},hintLength:0,hintAngle:0,initialPos:{x:0,y:0},currentAbsPos:{x:0,y:0},initialRotate:0,initTranslate:{x:0,y:0},initSize:{width:0,height:0},initCoordinate:{x:0,y:0},initReferencePoint:{x:0,y:0},initMarkerIndex:0,initCorRadPercentage:-1,center:{x:0,y:0},control:{xSign:1,ySign:1,isHorizon:!1},scale:{scaleX:1,scaleY:1},widthLimitSetDuringComposition:!1,isMoved:!1,initCornerRotate:-1,cornerRotaters:void 0,cornerRotaterbaffles:void 0,eventTarget:null,movingUtils:null,moveStart:null}},mounted(){this.setLastSelectedLayerIndex(this.layerIndex),["text","group","tmp"].includes(this.getLayerType)&&V.Z.updateTextPropsState(),this.addMovingListener()},beforeUnmount(){this.movingUtils&&this.movingUtils.removeListener(),this.eventTarget&&this.eventTarget.removeEventListener("touchstart",this.disableTouchEvent)},computed:le(ce(ce(ce(ce(ce({},(0,te.rn)("text",["sel","props"])),(0,te.rn)("shadow",["processId","handleId"])),(0,te.rn)(["isMoving","currDraggedPhoto"])),(0,te.Se)("imgControl",["isBgImgCtrl"])),(0,te.Se)({lastSelectedLayerIndex:"getLastSelectedLayerIndex",scaleRatio:"getPageScaleRatio",currSelectedInfo:"getCurrSelectedInfo",currSubSelectedInfo:"getCurrSubSelectedInfo",currHoveredPageIndex:"getCurrHoveredPageIndex",isProcessImgShadow:"shadow/isProcessing",isUploadImgShadow:"shadow/isUploading",isHandleShadow:"shadow/isHandling",currFunctionPanelType:"getCurrFunctionPanelType",useMobileEditor:"getUseMobileEditor"})),{ctrlPtrStyles(){return this.$store.getters["mobileEditor/getIsPinchingEditor"]?{outline:this.outlineStyles().outline,opacity:0}:{outline:this.outlineStyles().outline}},resizerProfile(){return F.Z.getResizerProfile(this.config)},subLayer(){if([R.F5.group,R.F5.frame].includes(this.config.type)){if(this.config.type===R.F5.group){const e=this.config.layers.findIndex((e=>e.active));return{config:this.config.layers[e],subLayerIdx:e}}if(this.config.type===R.F5.frame){const e=this.config.clips.findIndex((e=>e.active));return{config:this.config.clips[e],subLayerIdx:e}}}},sizeStyles(){var e;const{x:t,y:i,width:s,height:r,rotate:n}=F.Z.getControllerStyleParameters(this.config.point,this.config.styles,this.isLine(),this.$isTouchDevice(),null==(e=this.config.size)?void 0:e[0]),a=this.page,{bleeds:o}=U.Z.getPageSizeWithBleeds(a),h=this.contentScaleRatio*this.scaleRatio*.01,c=s*h,l=r*h,d=this.$isTouchDevice()?(pe-Math.min(c,pe))/2:0,g=this.$isTouchDevice()?(pe-Math.min(l,pe))/2:0;let p=`translate(${(a.isEnableBleed?t+o.left:t)*h-d}px, ${(a.isEnableBleed?i+o.top:i)*h-g}px)`;return n&&(p+=` rotate(${n}deg)`),{transform:p,width:`${this.$isTouchDevice()?Math.max(pe,c):c}px`,height:`${this.$isTouchDevice()?Math.max(pe,l):l}px`}},subContentStyles(){if("frame"===this.config.type)return;const e=`scale(${this.config.styles.scale})`;return{transform:e}},getPointerEvents(){return this.config.locked?"none":this.config.type===R.F5.text&&this.config.active&&!this.isMoving?"initial":"none"},contentStyles(){const e=this.getPointerEvents;return le(ce(le(ce({},this.sizeStyles),{willChange:this.config.active?"transform":""}),this.outlineStyles()),{opacity:this.isImgControl?0:1,pointerEvents:e})},isImgControl(){switch(this.getLayerType){case"image":return this.config.imgControl;case"group":return this.config.layers.some((e=>"image"===e.type&&e.imgControl));case"frame":return this.config.clips.some((e=>e.imgControl))}return!1},isCurveText(){return this.checkIfCurve(this.config)},isFlipped(){return this.config.styles.horizontalFlip||this.config.styles.verticalFlip},isFlipping(){return this.config.isFlipping},contentEditable(){return this.config.contentEditable},isDraggingCursor(){return this.config.isDraggingCursor},isActive(){return this.config.active},enalble3dTransform(){return this.pageIndex===U.Z._3dEnabledPageIndex},getLayerType(){return this.config.type},textHtml(){return ee.Z.toJSON(this.config.paragraphs)},tooSmall(){const{tooShort:e,tooNarrow:t}=this.checkLimits(this.$isTouchDevice(),!this.resizerProfile.hasHorizontal&&!this.resizerProfile.hasVertical);return e||t}}),watch:{contentEditable(e){"text"===this.config.type&&(this.config.active&&(e||ee.Z.agent((e=>!e.isDestroyed&&e.commands.selectAll())),ee.Z.agent((t=>{t.setEditable(e)}))),!this.$isTouchDevice()&&G.Z.updateHead(A.ZP.pageIndex,A.ZP.layerIndex,{contentEditable:e}))}},unmounted(){"text"===this.getLayerType&&A.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{shown:!1,contentEditable:!1,isTyping:!1}),this.isControlling=!1,this.setCursorStyle("");const e=U.Z.getPages.findIndex((e=>e.layers.some((e=>e.id===this.config.id))));-1!==e&&A.ZP.updateLayerProps(e,this.layerIndex,{moving:!1}),this.setMoving(!1),X.Z.closePopup()},methods:le(ce({},(0,te.OI)({setLastSelectedLayerIndex:"SET_lastSelectedLayerIndex",setIsLayerDropdownsOpened:"SET_isLayerDropdownsOpened",setCurrSidebarPanel:"SET_currSidebarPanelType",setMoving:"SET_moving",replaceLayer:"REPLACE_layer",setImgConfig:"imgControl/SET_CONFIG",setBgConfig:"imgControl/SET_BG_CONFIG"})),{checkLimits(e=!1,t=!1){const i=24,s=12;let r;r=t?e?3e3:100*s:e?ye:ye-100*(i-s);const n=this.scaleRatio*this.contentScaleRatio;return{tooShort:this.getLayerHeight()*n<r,tooNarrow:this.getLayerWidth()*n<r}},addMovingListener(){const e=this.$refs.body[0],t=(this.$refs.lineMover,this.$props),i={};Object.defineProperty(i,"pageIndex",{get(){return t.pageIndex}}),Object.defineProperty(i,"layerIndex",{get(){return t.layerIndex}}),Object.defineProperty(i,"subLayerIdx",{get(){return-1}});const s={config:this.config};Object.defineProperty(s,"config",{get(){return t.config}});const r={_config:s,component:this,snapUtils:this.snapUtils,layerInfo:i,body:e};this.movingUtils=new Y.U(r),this.moveStart=this.movingUtils.moveStart.bind(this.movingUtils),Object.keys(this.$refs).forEach((e=>{if(e.includes("moveStart")){const t=this.$refs[e];if(t instanceof Array)t[0].$el?t[0].$el.addEventListener("pointerdown",this.moveStart):t[0].addEventListener("pointerdown",this.moveStart);else{const e=t;e.$el?e.$el.addEventListener("pointerdown",this.moveStart):e.addEventListener("pointerdown",this.moveStart)}}}))},resizerBarStyles(e){const t=ce({},e),i=parseFloat(t.width.replace("px","")),s=parseFloat(t.height.replace("px","")),r=i>s,n=this.$isTouchDevice()?36:20,a={width:r?(this.getLayerWidth()-n)*this.contentScaleRatio*this.scaleRatio*.01+"px":i*this.contentScaleRatio*this.scaleRatio*.01+"px",height:r?s*this.contentScaleRatio*this.scaleRatio*.01+"px":(this.getLayerHeight()-n)*this.contentScaleRatio*this.scaleRatio*.01+"px",opacity:0};return Object.assign(t,a)},resizerStyles(e,t=!1){const i=ce({},e),{tooShort:s,tooNarrow:r}=this.checkLimits(),n="text"===this.getLayerType&&(this.config.styles.writingMode.includes("vertical")?r:s),a=parseFloat(i.width.replace("px","")),o=parseFloat(i.height.replace("px","")),h=t?2:1,c=a>o,l=this.getLayerWidth()*this.scaleRatio/100*this.contentScaleRatio-10,d=this.getLayerHeight()*this.scaleRatio/100*this.contentScaleRatio-10,g={width:c&&n?l*h+"px":i.width,height:!c&&n?d*h+"px":i.height};return Object.assign(i,g)},getResizer(e,t=!1,i=!1){let s=i?e.resizerTouchAreas:e.resizers;s=t?s.slice(this.resizerProfile.moveBarStart,this.resizerProfile.moveBarEnd):s.slice(this.resizerProfile.start,this.resizerProfile.end);const r=this.$isTouchDevice(),{tooShort:n,tooNarrow:a}=this.checkLimits(r);return"text"===this.getLayerType?t||Q.Z.isCurvedText(this.config.styles.textShape)||(s=this.config.styles.writingMode.includes("vertical")?a?r?[]:s.slice(1,2):s:n?r?[]:s.slice(0,1):s):(n&&(s=s.filter((e=>"H"!==e.type))),a&&(s=s.filter((e=>"V"!==e.type)))),s},getScaler(e){return this.tooSmall?e.slice(2,3):this.$isTouchDevice()?e.slice(1,2):e},getCornerRotaters(e){return this.tooSmall?e.slice(2,3):e},textWrapperStyle(){return ce(ce({width:this.getLayerWidth()/this.getLayerScale()+"px",height:this.getLayerHeight()/this.getLayerScale()+"px",opacity:""+this.config.styles.opacity/100,transform:`scaleX(${this.getLayerScale()*this.contentScaleRatio*this.scaleRatio*.01}) scaleY(${this.getLayerScale()*this.contentScaleRatio*this.scaleRatio*.01}) translate(-50%, -50%)`,textAlign:this.config.styles.align},j.Z.convertVerticalStyle(this.config.styles.writingMode)),this.isDraggingCursor?{zIndex:100}:{})},textBodyStyle(){const e=(0,O.iX)(this.config.styles.textFill),t=(this.isCurveText||this.isFlipped||this.isFlipping||e)&&!this.contentEditable?1e-4:1;return{width:"100%",height:"100%",opacity:t}},primaryLayerZindex(){return this.config.styles.zindex},lineControlPointStyles(){const{angle:e}=K.Z.lineDimension(this.config.point),t=e/Math.PI*180;return{transform:`rotate(${-t}deg)`}},controlPointStyles(){return{transform:`rotate(${-this.config.styles.rotate}deg)`}},outlineStyles(){const e=(()=>"frame"===this.getLayerType&&this.config.clips[0].isFrameImg?"#F10994":this.isLocked()?"#EB5757":"#7190CC")();let t="";return t=this.isLine()&&!this.$isTouchDevice()||this.isMoving&&this.currSelectedInfo.index!==this.layerIndex?"none":this.isShown()||this.isActive?`2px solid ${e}`:"none",{outline:t,outlineOffset:"-1px"}},hintStyles(){return`transform: translate(calc(${this.hintTranslation.x}px - 100%), ${this.hintTranslation.y}px)`},scaleStart(e){if(this.ctrlMiddleware()||k.ZP.checkIsMultiTouch(e))return;this.initialPos=q.Z.getMouseAbsPoint(e),this.isControlling=!0,this.initSize={width:this.getLayerWidth(),height:this.getLayerHeight()};const t=this.$refs.body.getBoundingClientRect();if(this.center=F.Z.getRectCenter(t),this.initTranslate=this.getLayerPos(),this.tooSmall)this.control.xSign=1,this.control.ySign=1;else{const t=this.getLayerRotate()*Math.PI/180,i=q.Z.getMouseRelPoint(e,this.center),s=F.Z.getNoRotationPos(i,this.center,t);this.control.xSign=s.x-this.center.x>0?1:-1,this.control.ySign=s.y-this.center.y>0?1:-1}"E"===this.config.category&&(this.initCorRadPercentage=F.Z.getCorRadPercentage(this.config.vSize,this.config.size,this.config.shapeType));const i=this.$refs.body;i.classList.remove("hover"),this.currCursorStyling(e),k.ZP.addPointerEvent("pointermove",this.scaling),k.ZP.addPointerEvent("pointerup",this.scaleEnd),window.addEventListener("keyup",this.handleScaleOffset),window.addEventListener("keydown",this.handleScaleOffset)},scaling(e){if(this.ctrlMiddleware()||k.ZP.checkIsMultiTouch(e))return;"touch"!==T.Z.getEventType(e)&&e.preventDefault();const t=T.Z.exact([e.altKey]),i=t||this.$isTouchDevice();this.config.moved||A.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{moved:!0});let s=this.getLayerWidth(),r=this.getLayerHeight();const n=this.getLayerRotate()*Math.PI/180;this.currentAbsPos=q.Z.getMouseAbsPoint(e);const a=q.Z.getMouseRelPoint(e,this.initialPos),o=B.ZP.getActualMoveOffset(a.x,a.y,this.$isTouchDevice()?1/this.contentScaleRatio*100/this.$store.getters.getPageScaleRatio:void 0),[h,c]=[o.offsetX,o.offsetY],l=i?2:1,d=this.control.xSign*(c*Math.sin(n)+h*Math.cos(n))*l,g=this.control.ySign*(c*Math.cos(n)-h*Math.sin(n))*l;if(0===d||0===g)return;const p=this.initSize.width,y=this.initSize.height;(s+d)/p>=(r+g)/y?(s=d+p,r=s*y/p):(r=g+y,s=r*p/y),s<=de?(s=de,r=de*this.getLayerHeight()/this.getLayerWidth()):r<=de&&(s=de*this.getLayerWidth()/this.getLayerHeight(),r=de);const u={width:s-p,height:r-y},f={xSign:this.control.xSign,ySign:this.control.ySign,x:this.initTranslate.x,y:this.initTranslate.y,angle:n},m=F.Z.getTranslateCompensation(f,u),x={width:s/(this.getLayerWidth()/this.getLayerScale()),height:r/(this.getLayerHeight()/this.getLayerScale())};let I=Math.max(x.width,x.height);switch(this.getLayerType){case"image":{const{imgWidth:e,imgHeight:t,imgX:i,imgY:n}=this.config.styles,a=Math.max(s/this.getLayerWidth(),r/this.getLayerHeight());N.Z.updateImgSize(this.pageIndex,this.layerIndex,e*a,t*a),N.Z.updateImgPos(this.pageIndex,this.layerIndex,i*a,n*a);break}case"text":-1!==this.config.widthLimit&&F.Z.updateLayerProps(this.pageIndex,this.layerIndex,{widthLimit:this.config.styles.writingMode.includes("vertical")?r:s});break;case"frame":if(z.Z.isImageFrame(this.config)){let{imgWidth:e,imgHeight:t,imgX:i,imgY:n}=this.config.clips[0].styles;const a=I/this.config.styles.scale;e*=a,t*=a,n*=a,i*=a,A.ZP.updateLayerStyles(this.pageIndex,this.layerIndex,{initWidth:s,initHeight:r}),z.Z.updateFrameLayerStyles(this.pageIndex,this.layerIndex,0,{width:s,height:r,imgWidth:e,imgHeight:t,imgX:i,imgY:n})}break;case"shape":if("E"===this.config.category){I=1,F.Z.updateShapeVSize(this.pageIndex,this.layerIndex,[s,r]);const e=F.Z.getCorRadValue([s,r],this.initCorRadPercentage,this.config.shapeType);F.Z.updateShapeCorRad(this.pageIndex,this.layerIndex,this.config.size,e)}break;case"tmp":case"group":this.config.layers.forEach(((e,t)=>{var i,s,r;if("shape"===e.type){const n=I/this.getLayerScale();if("D"===e.category){const[r]=null!=(i=e.size)?i:[1];A.ZP.updateSubLayerProps(this.pageIndex,this.layerIndex,t,{size:[r/n]});const a=K.Z.getTranslateCompensationForLineWidth(null!=(s=e.point)?s:[],e.styles,r,r/n);A.ZP.updateSubLayerStyles(this.pageIndex,this.layerIndex,t,{x:a.x,y:a.y})}if("E"===e.category){const[i,s]=null!=(r=e.size)?r:[1,0];A.ZP.updateSubLayerProps(this.pageIndex,this.layerIndex,t,{size:[i/n,s]})}}}));break}if(F.Z.updateLayerSize(this.pageIndex,this.layerIndex,s,r,I),V.Z.updateTextPropState("fontSize",!0),F.Z.updateLayerPos(this.pageIndex,this.layerIndex,m.x,m.y),i){const e=B.ZP.getCenter(this.config.styles),t=B.ZP.getCenter(Object.assign({},this.initSize,this.initTranslate)),i={x:t.x-e.x,y:t.y-e.y};F.Z.updateLayerPos(this.pageIndex,this.layerIndex,m.x+i.x,m.y+i.y)}},scaleEnd(e){if(!k.ZP.checkIsMultiTouch(e)){if(this.isControlling=!1,["text","group","tmp"].includes(this.getLayerType)){const e=J.Z.resetScaleForLayer(this.config);A.ZP.replaceLayer(this.pageIndex,this.layerIndex,e),"tmp"===e.type?H.Z.set(this.pageIndex,this.layerIndex,e.layers):H.Z.set(this.pageIndex,this.layerIndex,[e]),ee.Z.updateHtml()}G.Z.asyncRecord(),this.setCursorStyle(""),k.ZP.removePointerEvent("pointermove",this.scaling),k.ZP.removePointerEvent("pointerup",this.scaleEnd),window.removeEventListener("keyup",this.handleScaleOffset),window.removeEventListener("keydown",this.handleScaleOffset),this.$emit("setFocus"),this.snapUtils.event.emit("clearSnapLines")}},lineEndMoveStart(e){if(k.ZP.checkIsMultiTouch(e))return;this.initialPos=q.Z.getMouseAbsPoint(e),this.isControlling=!0,this.isLineEndMoving=!0;const t=K.Z.getLineQuadrant(this.config.point),i=Number(e.target.getAttribute("marker-index"));this.initMarkerIndex=i,this.initCoordinate={x:this.config.point[2*i],y:this.config.point[2*i+1]};const{angle:s,yDiff:r,xDiff:n}=K.Z.lineDimension(this.config.point),a=q.Z.getMouseRelPoint(e,this.$refs.self),o=B.ZP.getActualMoveOffset(a.x,a.y,1);this.hintTranslation={x:o.offsetX-35,y:o.offsetY+35},this.hintAngle=(s/Math.PI*180+180*(1-i)+360)%360,this.hintLength=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));const h=0===i?(t-1+2)%4+1:t;this.initReferencePoint=F.Z.getAbsPointByQuadrant(this.config.point,this.config.styles,this.config.size[0],h),this.currCursorStyling(e),k.ZP.addPointerEvent("pointermove",this.lineEndMoving),k.ZP.addPointerEvent("pointerup",this.lineEndMoveEnd)},lineEndMoving(e){var t;if(k.ZP.checkIsMultiTouch(e))return;e.preventDefault(),this.config.moved||A.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{moved:!0});const i=q.Z.getMouseRelPoint(e,this.initialPos),s=B.ZP.getActualMoveOffset(i.x,i.y),[r,n]=[s.offsetX/this.contentScaleRatio,s.offsetY/this.contentScaleRatio],a=this.initMarkerIndex,o=Array.from(this.config.point);o[2*a]=this.initCoordinate.x+r,o[2*a+1]=this.initCoordinate.y+n;const{newPoint:h,lineLength:c,lineAngle:l}=this.snapUtils.calLineAngleSnap(a,o,e.shiftKey),d=q.Z.getMouseRelPoint(e,this.$refs.self),g=B.ZP.getActualMoveOffset(d.x,d.y,1);this.hintTranslation={x:g.offsetX-35,y:g.offsetY+35},this.hintLength=c,this.hintAngle=l;const p=F.Z.getTranslateCompensationForLine(a,this.initReferencePoint,this.config.styles,(null!=(t=this.config.size)?t:[1])[0],h);F.Z.updateShapeLinePoint(this.pageIndex,this.layerIndex,h),F.Z.updateLayerPos(this.pageIndex,this.layerIndex,p.x,p.y)},lineEndMoveEnd(e){k.ZP.checkIsMultiTouch(e)||(this.isControlling=!1,this.isLineEndMoving=!1,G.Z.asyncRecord(),this.setCursorStyle(""),k.ZP.removePointerEvent("pointermove",this.lineEndMoving),k.ZP.removePointerEvent("pointerup",this.lineEndMoveEnd),this.$emit("setFocus"),this.snapUtils.event.emit("clearSnapLines"))},resizeStart(e,t){if(this.ctrlMiddleware()||k.ZP.checkIsMultiTouch(e))return;if(k.ZP.checkIsMultiTouch(e))return;this.isControlling=!0;const i=this.$refs.body;i.classList.remove("hover"),this.currCursorStyling(e);const s=i.getBoundingClientRect(),r=F.Z.getRectCenter(s);this.initSize={width:this.getLayerWidth(),height:this.getLayerHeight()},this.initTranslate=this.getLayerPos(),this.initialPos={x:e.clientX,y:e.clientY};const n=q.Z.getMouseRelPoint(e,r),a=this.getLayerRotate()*Math.PI/180,o=F.Z.getNoRotationPos(n,r,a);switch(this.control.xSign=o.x-r.x>0?1:-1,this.control.ySign=o.y-r.y>0?1:-1,this.control.isHorizon="H"===t,k.ZP.addPointerEvent("pointermove",this.resizing),k.ZP.addPointerEvent("pointerup",this.resizeEnd),window.addEventListener("keyup",this.handleScaleOffset),window.addEventListener("keydown",this.handleScaleOffset),this.getLayerType){case"shape":"B"===this.config.category&&(this.scale={scaleX:this.config.styles.scaleX,scaleY:this.config.styles.scaleY});break;case"image":N.Z.initImgSize={width:this.config.styles.imgWidth,height:this.config.styles.imgHeight},N.Z.initImgPos={x:this.config.styles.imgX,y:this.config.styles.imgY},N.Z.initLayerSize=this.initSize,N.Z.xSign=o.x-r.x>0?1:-1,N.Z.ySign=o.y-r.y>0?1:-1,N.Z.isHorizon=this.control.isHorizon;break;case"frame":N.Z.initImgSize={width:this.config.clips[0].styles.imgWidth,height:this.config.clips[0].styles.imgHeight},N.Z.initImgPos={x:this.config.clips[0].styles.imgX,y:this.config.clips[0].styles.imgY},N.Z.initLayerSize=this.initSize,N.Z.xSign=o.x-r.x>0?1:-1,N.Z.ySign=o.y-r.y>0?1:-1,N.Z.isHorizon=this.control.isHorizon}},resizing(e){if(this.ctrlMiddleware()||k.ZP.checkIsMultiTouch(e))return;e.preventDefault();const t=T.Z.exact([e.altKey]),i=t||this.$isTouchDevice();this.config.moved||A.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{moved:!0});let s=this.getLayerWidth(),r=this.getLayerHeight();const n=this.initSize.width,a=this.initSize.height,o=this.getLayerRotate()*Math.PI/180,h=q.Z.getMouseRelPoint(e,this.initialPos);this.currentAbsPos=q.Z.getMouseAbsPoint(e);const c=(this.$isTouchDevice()?1/this.contentScaleRatio:1)/(.01*this.scaleRatio),[l,d]=[h.x*c,h.y*c],g=i?2:1;let p=this.control.isHorizon?this.control.xSign*(d*Math.sin(o)+l*Math.cos(o))*g:0,y=this.control.isHorizon?0:this.control.ySign*(d*Math.cos(o)-l*Math.sin(o))*g;if(0===p&&0===y)return;s=Math.max(ge,p+n),r=Math.max(ge,y+a);const u={width:s-n,height:r-a};let f=this.getLayerScale();switch(this.getLayerType){case"image":s===ge&&(p=ge-n),r===ge&&(y=ge-a),N.Z.imgResizeHandler(s,r,p,y),f=1;break;case"shape":[s,r]=F.Z.resizeShapeHandler(this.config,this.scale,this.initSize,s,r),"E"===this.config.category&&(s===ge&&(s=4*ge),r===ge&&(r=4*ge),F.Z.updateShapeVSize(this.pageIndex,this.layerIndex,[s,r]));break;case"text":{if(this.config.styles.writingMode.includes("vertical")){const e=J.Z.getTextHW(this.config,r);s=e.width,F.Z.updateLayerProps(A.ZP.pageIndex,A.ZP.layerIndex,{widthLimit:r,spanDataList:e.spanDataList})}else{const e=J.Z.getTextHW(this.config,s);r=e.height,F.Z.updateLayerProps(A.ZP.pageIndex,A.ZP.layerIndex,{widthLimit:s,spanDataList:e.spanDataList})}const e=s/this.config.styles.scale,t=r/this.config.styles.scale;F.Z.updateLayerInitSize(this.pageIndex,this.layerIndex,e,t),this.config.styles.writingMode.includes("vertical")?this.control.xSign=-1:this.control.ySign=1;break}case"frame":z.Z.frameResizeHandler(s,r,p,y)}const m={xSign:this.control.xSign,ySign:this.control.ySign,x:this.initTranslate.x,y:this.initTranslate.y,angle:o};u.height=r-a,u.width=s-n;const x=F.Z.getTranslateCompensation(m,u);if(F.Z.updateLayerSize(this.pageIndex,this.layerIndex,s,r,f),F.Z.updateLayerPos(this.pageIndex,this.layerIndex,x.x,x.y),i){const e=B.ZP.getCenter(this.config.styles),t=B.ZP.getCenter(Object.assign({},this.initSize,this.initTranslate)),i={x:t.x-e.x,y:t.y-e.y};F.Z.updateLayerPos(this.pageIndex,this.layerIndex,x.x+i.x,x.y+i.y)}},resizeEnd(e){k.ZP.checkIsMultiTouch(e)||(N.Z.imgBuffer={width:0,height:0,x:0,y:0},"shape"===this.config.type&&"E"===this.config.category&&F.Z.updateShapeCorRad(this.pageIndex,this.layerIndex,this.config.size,K.Z.clipCorRad(this.config.shapeType,this.config.vSize,this.config.size)),this.isControlling=!1,G.Z.asyncRecord(),this.setCursorStyle(""),k.ZP.removePointerEvent("pointermove",this.resizing),k.ZP.removePointerEvent("pointerup",this.resizeEnd),window.removeEventListener("keyup",this.handleScaleOffset),window.removeEventListener("keydown",this.handleScaleOffset),this.$emit("setFocus"))},rotateStart(e,t=-1){if(this.ctrlMiddleware()||k.ZP.checkIsMultiTouch(e))return;this.setCursorStyle(e.target.style.cursor||"move"),this.tooSmall&&(t=2),this.initCornerRotate=2*t,this.isRotating=!0,this.isControlling=!0;const i=this.$refs.body,s=i.getBoundingClientRect();this.center={x:s.left+s.width/2-window.pageXOffset,y:s.top+s.height/2-window.pageYOffset},this.initialPos=q.Z.getMouseAbsPoint(e),this.initialRotate=this.getLayerRotate();const r=q.Z.getMouseRelPoint(e,this.$refs.self),n=B.ZP.getActualMoveOffset(r.x,r.y,1);this.hintTranslation={x:n.offsetX-35,y:n.offsetY+35},this.hintAngle=(this.initialRotate+360)%360,k.ZP.addPointerEvent("pointermove",this.rotating),k.ZP.addPointerEvent("pointerup",this.rotateEnd)},rotating(e){if(this.ctrlMiddleware()||k.ZP.checkIsMultiTouch(e))return;this.config.moved||A.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{moved:!0});const t={x:this.initialPos.x-this.center.x,y:this.initialPos.y-this.center.y},i={x:e.clientX-this.center.x,y:e.clientY-this.center.y},s=F.Z.getLength(t),r=F.Z.getLength(i),n=t.x*i.x+t.y*i.y;let a=Math.round(180*Math.acos(n/(s*r))/Math.PI);if(a){const s=i.y*t.x-i.x*t.y;s<0&&(a*=-1),a+=this.initialRotate%360,a=this.snapUtils.calAngleSnap((a+360)%360,e.shiftKey);let r=a;r>180&&(r-=360);const n=q.Z.getMouseRelPoint(e,this.$refs.self),o=B.ZP.getActualMoveOffset(n.x,n.y,1);this.hintTranslation={x:o.offsetX-35,y:o.offsetY+35},this.hintAngle=r,F.Z.updateLayerRotate(this.pageIndex,this.layerIndex,a);const h=a>0?a:360+a;let c=this.initCornerRotate;h>22.5&&(c+=Math.floor((h-22.5)/45)+1),this.setCursorStyle(F.Z.getCornerRataterMap[(c+8)%8])}},rotateEnd(e){k.ZP.checkIsMultiTouch(e)||(this.isRotating=!1,this.isControlling=!1,this.initCornerRotate=-1,G.Z.asyncRecord(),this.setCursorStyle(""),k.ZP.removePointerEvent("pointermove",this.rotating),k.ZP.removePointerEvent("pointerup",this.rotateEnd),this.$emit("setFocus"))},lineRotateStart(e){this.setCursorStyle("move"),this.isRotating=!0,this.isControlling=!0;const t=this.$refs.body,i=t.getBoundingClientRect();this.center={x:i.left+i.width/2-window.pageXOffset,y:i.top+i.height/2-window.pageYOffset},this.initialPos=q.Z.getMouseAbsPoint(e);const{angle:s}=K.Z.lineDimension(this.config.point);this.initialRotate=s/Math.PI*180;const r=q.Z.getMouseRelPoint(e,this.$refs.self),n=B.ZP.getActualMoveOffset(r.x,r.y,1);this.hintTranslation={x:n.offsetX-35,y:n.offsetY+35},this.hintAngle=(this.initialRotate+360)%360,k.ZP.addPointerEvent("pointermove",this.lineRotating),k.ZP.addPointerEvent("pointerup",this.lineRotateEnd)},lineRotating(e){var t,i;this.config.moved||A.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{moved:!0});const s={x:this.initialPos.x-this.center.x,y:this.initialPos.y-this.center.y},r={x:e.clientX-this.center.x,y:e.clientY-this.center.y},n=F.Z.getLength(s),a=F.Z.getLength(r),o=s.x*r.x+s.y*r.y;let h=Math.round(180*Math.acos(o/(n*a))/Math.PI);if(h){s.y*r.x-s.x*r.y>0&&(h*=-1),h+=this.initialRotate%360,h=this.snapUtils.calAngleSnap((h+360)%360,e.shiftKey);const{point:n,dx:a,dy:o}=K.Z.lineCenterRotate(this.config.point,h,null!=(i=null==(t=this.config.size)?void 0:t[0])?i:1,!1),c=q.Z.getMouseRelPoint(e,this.$refs.self),l=B.ZP.getActualMoveOffset(c.x,c.y,1);this.hintTranslation={x:l.offsetX-35,y:l.offsetY+35},this.hintAngle=h,F.Z.updateShapeLinePoint(this.pageIndex,this.layerIndex,n),F.Z.updateLayerPos(this.pageIndex,this.layerIndex,this.config.styles.x+a,this.config.styles.y+o)}},lineRotateEnd(){this.isRotating=!1,this.isControlling=!1,G.Z.asyncRecord(),this.setCursorStyle(""),k.ZP.removePointerEvent("pointermove",this.lineRotating),k.ZP.removePointerEvent("pointerup",this.lineRotateEnd),this.$emit("setFocus")},ctrlPointerStyles(e,t){return ce(ce({},e),t)},cursorStyles(e,t,i="cursors"){if(this.isControlling)return{cursor:"initial"};if("number"===typeof e){if("cornerRotaters"===i){this.tooSmall&&(e=2),e*=2,t>180&&(t-=360);let i=e;return t>=22.5?(i++,i+=Math.floor((t-22.5)/45),i>7&&(i-=8)):t<=-22.5&&(i--,i-=Math.floor((-t-22.5)/45),i<0&&(i=8+i)),{cursor:F.Z.getCornerRataterMap[i]}}{switch(this.getLayerType){case"text":this.config.styles.writingMode.includes("vertical")&&(e+=4);break;case"shape":3===this.config.scaleType&&(e+=4)}const i=t>=0?(e+Math.floor(t/45))%8:(e+Math.ceil(t/45)+8)%8;return{cursor:this.controlPoints.cursors[i]}}}return{cursor:e}},setCursorStyle(e){this.$store.commit("SET_cursor",e)},currCursorStyling(e){const t=e.target;this.setCursorStyle(t.style.cursor)},waitFontLoadingAndRecord(){const e=this.page.id,t=this.config.id;J.Z.waitFontLoadingAndRecord(this.config.paragraphs,(()=>{const{pageIndex:i,layerIndex:s,subLayerIdx:r}=A.ZP.getLayerInfoById(e,t);if(-1===s)return console.log("the layer to update size doesn't exist anymore.");J.Z.updateTextLayerSizeByShape(i,s,r)}))},waitFontLoadingAndResize(){const e=this.page.id,t=this.config.id;J.Z.untilFontLoaded(this.config.paragraphs).then((()=>{setTimeout((()=>{const{pageIndex:i,layerIndex:s,subLayerIdx:r}=A.ZP.getLayerInfoById(e,t);if(-1===s)return console.log("the layer to update size doesn't exist anymore.");J.Z.updateTextLayerSizeByShape(i,s,r)}),100)}))},checkIfCurve(e){return Q.Z.isCurvedText(e.styles.textShape)},calcSize(e,t){this.checkIfCurve(e)?this.curveTextSizeRefresh(e):this.textSizeRefresh(e,t)},handleTextChange(e){var t,i,s,r;const n=T.Z.deepCopy(this.config);n.paragraphs=e.paragraphs,this.calcSize(n,!!(null==(i=null==(t=ee.Z.editor)?void 0:t.view)?void 0:i.composing)),A.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{paragraphs:e.paragraphs}),e.toRecord?this.waitFontLoadingAndRecord():this.waitFontLoadingAndResize(),e.isSetContentRequired&&!(null==(r=null==(s=ee.Z.editor)?void 0:s.view)?void 0:r.composing)&&this.$nextTick((()=>{ee.Z.agent((t=>{t.chain().setContent(ee.Z.toJSON(e.paragraphs)).selectPrevious().run()}))}))},handleTextCompositionEnd(e){this.widthLimitSetDuringComposition&&(this.widthLimitSetDuringComposition=!1,A.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{widthLimit:-1}),this.textSizeRefresh(this.config,!1)),e&&this.waitFontLoadingAndRecord()},textSizeRefresh(e,t){var i;const s=this.config.styles.writingMode.includes("vertical"),r=()=>s?this.getLayerHeight():this.getLayerWidth();let n=this.getLayerRotate()?r():this.config.widthLimit,a=J.Z.getTextHW(e,n),o=this.getLayerPos().x,h=this.getLayerPos().y;if(-1===n){const c=U.Z.getPage(this.pageIndex)[s?"height":"width"],l=((null==(i=this.$parent)?void 0:i.$el).getBoundingClientRect()[s?"height":"width"],this.scaleRatio,a[s?"height":"width"]);let d=this.getLayerPos()[s?"y":"x"]-(l-r())/2;const g=d<=0,p=d+l>=c;g&&p?(t&&(this.widthLimitSetDuringComposition=!0),a=J.Z.getTextHW(e,c),d=0,n=c):(g||p)&&(t&&(this.widthLimitSetDuringComposition=!0),n=r(),a=J.Z.getTextHW(e,n),d=g?0:c-n),o=s?o-a.width+this.getLayerWidth():d,h=s?d:h}else{const e={xSign:s?-1:1,ySign:1,x:this.getLayerPos().x,y:this.getLayerPos().y,angle:this.getLayerRotate()*Math.PI/180},t={width:s?a.width-this.getLayerWidth():0,height:s?0:a.height-this.getLayerHeight()},i=F.Z.getTranslateCompensation(e,t);o=i.x,h=i.y}if(s&&a.width<5)a.width=this.getLayerWidth();else if(!s&&a.height<5){const t=T.Z.deepCopy(e);t.paragraphs[0].spans[0].text="|",t.paragraphs.splice(1),a.height=J.Z.getTextHW(t).height}A.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{widthLimit:n,spanDataList:a.spanDataList}),A.ZP.updateLayerStyles(this.pageIndex,this.layerIndex,{width:a.width,height:a.height,x:o,y:h})},curveTextSizeRefresh(e){A.ZP.updateLayerStyles(this.pageIndex,this.layerIndex,Q.Z.getCurveTextProps(e))},onRightClick(e){this.$isTouchDevice()?e.preventDefault():this.$nextTick((()=>{X.Z.openPopup("layer",{event:e,layerIndex:this.layerIndex})}))},frameLayerMapper(e){const t=T.Z.deepCopy(e),{x:i,y:s,width:r,height:n,scale:a}=t.styles;return Object.assign(t,{styles:ce(ce({},t.styles),B.ZP.multipy(this.getLayerScale(),{x:i,y:s,width:r,height:n,scale:a}))})},handleScaleOffset(e){if(e.preventDefault(),"Alt"===e.key){const t=new MouseEvent("mousemove",{clientX:this.currentAbsPos.x,clientY:this.currentAbsPos.y,altKey:e.altKey});window.dispatchEvent(t)}},disableTouchEvent(e){this.$isTouchDevice()&&e.preventDefault()},getLayerPos(){return{x:this.config.styles.x,y:this.config.styles.y}},isShown(){return this.config.shown},isLocked(){return this.config.locked},isLine(){return K.Z.isLine(this.config)},getLayerWidth(){return this.config.styles.width},getLayerHeight(){return this.config.styles.height},getLayerRotate(){return this.config.styles.rotate},getLayerScale(){return this.config.styles.scale},actionIconStyles(){const e=100*(this.layerIndex+1);return{transform:this.enalble3dTransform?`translate3d(0px, 0px, ${e}px)`:"translate(0px, 0px)"}},ctrlMiddleware(){return!(!this.$isTouchDevice()||!this.$store.getters["mobileEditor/getIsPinchingEditor"])}})});const fe=(0,M.Z)(ue,[["render",b],["__scopeId","data-v-4af6b3b2"],["__file","NuController.vue"]]);var me=fe},21423:function(e,t,i){i.r(t),i.d(t,{default:function(){return $}});var s=i(29651),r=i(819);const n=["src"];function a(e,t,i,a,o,h){var c,l;const d=(0,s.up)("nu-layer");return(0,s.wg)(),(0,s.iD)("div",{class:(0,r.C_)([e.isFrameImg?"flex-center full-size":"nu-frame__custom"])},[e.shadowSrc()?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"shadow__wrapper",style:(0,r.j5)(e.shadowWrapperStyles)},[(0,s._)("img",{class:"shadow__img",draggable:"false",src:e.shadowSrc()},null,8,n)],4)):(0,s.kq)("",!0),e.hasDecor?((0,s.wg)(),(0,s.j4)(d,{class:"click-disabled",key:`layer-${null==(c=e.config.decoration)?void 0:c.id}`,pageIndex:e.pageIndex,page:e.page,layerIndex:-1!==e.subLayerIndex?e.subLayerIndex:e.layerIndex,inFrame:!0,contentScaleRatio:e.contentScaleRatio,priPrimaryLayerIndex:-1!==e.subLayerIndex?e.layerIndex:-1,primaryLayer:e.config,config:e.config.decoration,isSubLayer:!0},null,8,["pageIndex","page","layerIndex","contentScaleRatio","priPrimaryLayerIndex","primaryLayer","config"])):(0,s.kq)("",!0),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.layers,((t,i)=>((0,s.wg)(),(0,s.j4)(d,{key:`layer-${t.id}`,pageIndex:e.pageIndex,page:e.page,layerIndex:e.layerIndex,inFrame:!0,inImageFrame:e.inImageFrame(),subLayerIndex:i,contentScaleRatio:e.contentScaleRatio,primaryLayer:e.config,config:t,isSubLayer:!0},null,8,["pageIndex","page","layerIndex","inImageFrame","subLayerIndex","contentScaleRatio","primaryLayer","config"])))),128)),e.hasDecorTop?((0,s.wg)(),(0,s.j4)(d,{class:"click-disabled",key:`layer-${null==(l=e.config.decorationTop)?void 0:l.id}`,pageIndex:e.pageIndex,page:e.page,layerIndex:-1!==e.subLayerIndex?e.subLayerIndex:e.layerIndex,inFrame:!0,contentScaleRatio:e.contentScaleRatio,priPrimaryLayerIndex:-1!==e.subLayerIndex?e.layerIndex:-1,primaryLayer:e.config,config:e.config.decorationTop,isSubLayer:!0},null,8,["pageIndex","page","layerIndex","contentScaleRatio","priPrimaryLayerIndex","primaryLayer","config"])):(0,s.kq)("",!0),e.hasBlendLayers?((0,s.wg)(!0),(0,s.iD)(s.HY,{key:3},(0,s.Ko)(e.config.blendLayers,((t,i)=>((0,s.wg)(),(0,s.j4)(d,{class:"click-disabled",key:`layer-${t.id}`,pageIndex:e.pageIndex,page:e.page,layerIndex:-1!==e.subLayerIndex?e.subLayerIndex:e.layerIndex,inFrame:!0,subLayerIndex:i,contentScaleRatio:e.contentScaleRatio,priPrimaryLayerIndex:-1!==e.subLayerIndex?e.layerIndex:-1,primaryLayer:e.config,config:t,isSubLayer:!0},null,8,["pageIndex","page","layerIndex","subLayerIndex","contentScaleRatio","priPrimaryLayerIndex","primaryLayer","config"])))),128)):(0,s.kq)("",!0)],2)}var o=i(86052),h=i(62013),c=i(78871),l=i(3162),d=i(13637),g=i(75231),p=i(38058),y=Object.defineProperty,u=Object.defineProperties,f=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,v=(e,t,i)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,S=(e,t)=>{for(var i in t||(t={}))x.call(t,i)&&v(e,i,t[i]);if(m)for(var i of m(t))I.call(t,i)&&v(e,i,t[i]);return e},w=(e,t)=>u(e,f(t)),b=(e,t,i)=>new Promise(((s,r)=>{var n=e=>{try{o(i.next(e))}catch(t){r(t)}},a=e=>{try{o(i.throw(e))}catch(t){r(t)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,a);o((i=i.apply(e,t)).next())})),L=(0,s.aZ)({emits:[],props:{config:{type:Object,required:!0},pageIndex:{type:Number,required:!0},page:{type:Object,required:!0},layerIndex:{type:Number,required:!0},subLayerIndex:{type:Number,default:-1},contentScaleRatio:{default:1,type:Number},primaryLayer:{default:void 0,type:Object}},created(){return b(this,null,(function*(){if(this.config.needFetch&&this.config.designId){const e=this.config,t={type:8,id:e.designId,ver:this.getVerUni},i=(yield o.ZP.get(t)).jsonData;if(g.ZP.updateLayerStyles(this.pageIndex,this.layerIndex,{initWidth:i.width,initHeight:i.height},this.subLayerIndex),e.clips.forEach(((e,t)=>{i.clips[t]&&(-1!==this.subLayerIndex?h.Z.updateFrameLayerProps(this.pageIndex,this.subLayerIndex,t,{clipPath:i.clips[t].clipPath},this.layerIndex):h.Z.updateFrameLayerProps(this.pageIndex,this.layerIndex,t,{clipPath:i.clips[t].clipPath}))})),i.decoration)if(e.decoration){e.decoration.color.length&&(i.decoration.color=[...e.decoration.color]);const t={};Object.entries(e.decoration).forEach((([e,i])=>{t[e]=i instanceof Object||i instanceof Array?c.Z.unproxify(i):i})),Object.assign(t,i.decoration),g.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{decoration:t},this.subLayerIndex)}else g.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{decoration:i.decoration},this.subLayerIndex);else!i.decoration&&e.decoration&&g.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{decoration:void 0},this.subLayerIndex);if(i.decorationTop)if(e.decorationTop){e.decorationTop.color.length&&(i.decorationTop.color=[...e.decorationTop.color]);const t={};Object.entries(e.decorationTop).forEach((([e,i])=>{t[e]=i instanceof Object||i instanceof Array?c.Z.unproxify(i):i})),Object.assign(t,i.decorationTop),g.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{decorationTop:t},this.subLayerIndex)}else g.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{decorationTop:i.decorationTop},this.subLayerIndex);else!i.decorationTop&&e.decorationTop&&g.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{decorationTop:void 0},this.subLayerIndex);i.blendLayers&&(this.config.blendLayers||g.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{blendLayers:[]},this.subLayerIndex),i.blendLayers.forEach(((e,t)=>{if(!this.config.blendLayers[t]){const e={width:this.config.styles.width/this.config.styles.scale,height:this.config.styles.height/this.config.styles.scale,initWidth:this.config.styles.width/this.config.styles.scale,initHeight:this.config.styles.height/this.config.styles.scale,vSize:[this.config.styles.width/this.config.styles.scale,this.config.styles.height/this.config.styles.scale]};this.primaryLayer?this.updateFrameBlendLayer({pageIndex:this.pageIndex,preprimaryLayerIndex:this.layerIndex,layerIndex:this.subLayerIndex,subLayerIdx:-1,shape:d.Z.newShape({styles:e})}):this.updateFrameBlendLayer({pageIndex:this.pageIndex,layerIndex:this.layerIndex,subLayerIdx:-1,shape:d.Z.newShape({styles:e})})}e.color=this.config.blendLayers[t].color;const s=w(S({},this.config.blendLayers[t].styles),{blendMode:i.blendLayers[t].blendMode}),r=i.blendLayers[t];r.styles=s,this.primaryLayer?this.updateFrameBlendLayer({pageIndex:this.pageIndex,preprimaryLayerIndex:this.layerIndex,layerIndex:this.subLayerIndex,subLayerIdx:t,shape:r}):this.updateFrameBlendLayer({pageIndex:this.pageIndex,layerIndex:this.layerIndex,subLayerIdx:t,shape:r})}))),g.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{needFetch:!1})}}))},watch:{"config.needFetch":function(e){if(e&&this.config.designId){const e={type:8,id:this.config.designId,ver:this.getVerUni};o.ZP.get(e).then((e=>{const t=e.jsonData;this.config.clips=c.Z.deepCopy(this.config.clips),this.config.decoration&&t.decoration&&(t.decoration.color=[...this.config.decoration.color],this.config.decoration=d.Z.newShape(w(S({},t.decoration),{vSize:[this.config.styles.initWidth,this.config.styles.initHeight],styles:{width:this.config.styles.initWidth,height:this.config.styles.initHeight,initWidth:this.config.styles.initWidth,initHeight:this.config.styles.initHeight}}))),this.config.decorationTop&&t.decorationTop&&(t.decorationTop.color=[...this.config.decorationTop.color],this.config.decorationTop=d.Z.newShape(w(S({},t.decorationTop),{vSize:[this.config.styles.initWidth,this.config.styles.initHeight],styles:{width:this.config.styles.initWidth,height:this.config.styles.initHeight,initWidth:this.config.styles.initWidth,initHeight:this.config.styles.initHeight}}))),this.config.needFetch=!1}))}}},computed:w(S(S({},(0,p.Se)("user",["getVerUni"])),(0,p.Se)({scaleRatio:"getPageScaleRatio",isShowPagePreview:"page/getIsShowPagePreview"})),{hasDecor(){const e=this.config;return!!e.decoration&&!!e.decoration.svg&&!e.clips[0].isFrameImg},hasDecorTop(){const e=this.config;return!!e.decorationTop&&!!e.decorationTop.svg},hasBlendLayers(){return!!this.config.blendLayers},layers(){const e=this.config;let t=[];return t=t.concat(...e.clips),t},shadowWrapperStyles(){var e;const t=this.config.styles.shadow;if(t&&(null==(e=t.srcObj)?void 0:e.type)){const{imgWidth:e,imgHeight:i,imgX:s,imgY:r}=t.styles,{horizontalFlip:n,verticalFlip:a,scale:o}=this.config.styles,h=o*this.contentScaleRatio*this.$store.state.pageScaleRatio*.01,c=(n?-s:s)*h,l=(a?-r:r)*h;return{width:(e*h).toString()+"px",height:(i*h).toString()+"px",transform:`translate(${c}px, ${l}px)`}}return{}},isFrameImg(){return 1===this.config.clips.length&&!!this.config.clips[0].isFrameImg}}),methods:w(S({},(0,p.OI)({updateFrameBlendLayer:"UPDATE_frameBlendLayer"})),{shadowSrc(){const e=this.config.styles.shadow;if(e&&e.srcObj&&e.srcObj.type){const{width:t,height:i}=this.config.styles,s=l.Z.getSrcSize(e.srcObj,l.Z.getSignificantDimension(t,i)*(this.scaleRatio/100));return l.Z.getSrc(e.srcObj,l.Z.getSrcSize(e.srcObj,s))}return""},inImageFrame(){return 1===this.config.clips.length&&this.config.clips[0].isFrameImg}})}),P=i(53372);const Z=(0,P.Z)(L,[["render",a],["__scopeId","data-v-325de443"],["__file","NuFrame.vue"]]);var $=Z},93663:function(e,t,i){i.r(t),i.d(t,{default:function(){return c}});var s=i(29651);const r={class:"nu-group"};function n(e,t,i,n,a,o){const h=(0,s.up)("nu-layer");return(0,s.wg)(),(0,s.iD)("div",r,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.config.layers,((t,i)=>((0,s.wg)(),(0,s.j4)(h,{key:`layer-${t.id}`,pageIndex:e.pageIndex,page:e.page,primaryLayer:e.config,layerIndex:e.layerIndex,subLayerIndex:i,contentScaleRatio:e.contentScaleRatio,config:t,isSubLayer:!0,inPreview:e.inPreview},null,8,["pageIndex","page","primaryLayer","layerIndex","subLayerIndex","contentScaleRatio","config","inPreview"])))),128))])}var a=(0,s.aZ)({emits:[],props:{config:{type:Object,required:!0},pageIndex:{type:Number,required:!0},page:{type:Object,required:!0},layerIndex:{type:Number,required:!0},contentScaleRatio:{default:1,type:Number},inPreview:{default:!1,type:Boolean}}}),o=i(53372);const h=(0,o.Z)(a,[["render",n],["__scopeId","data-v-2c435eaa"],["__file","NuGroup.vue"]]);var c=h},78401:function(e,t,i){i.r(t),i.d(t,{default:function(){return A}});var s=i(29651),r=i(819);const n=["id","cy-ready"],a=["id"],o=["src"],h=["src"],c=["viewBox"],l=["id"],d=["filter","width","height","xlink:href"];function g(e,t,i,g,p,y){return!e.config.imgControl||e.forRender||e.isBgImgControl?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,r.C_)(["nu-image",{"nu-image__shadow-container":e.shadowSrc||e.showCanvas}]),id:`nu-image-${e.config.id}`,style:(0,r.j5)(e.containerStyles),"cy-ready":e.cyReady,draggable:"false"},[e.showCanvas?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"shadow__canvas-wrapper",style:(0,r.j5)(e.canvasWrapperStyle)},[(0,s._)("canvas",{ref:"canvas",class:(0,r.C_)(`shadow__canvas_${e.pageIndex}_${e.layerIndex}_${"undefined"===typeof e.subLayerIndex?-1:e.subLayerIndex}`)},null,2)],4)):(0,s.kq)("",!0),e.shadowSrc&&!e.config.isFrameImg?((0,s.wg)(),(0,s.iD)("div",{key:1,class:"shadow__picture",id:e.inPreview?"":`nu-image-${e.config.id}__shadow`,style:(0,r.j5)(e.imgShadowStyles)},[(0,s._)("img",{class:"nu-image__picture-shadow",ref:"shadow-img",draggable:"false",src:e.shadowSrc,onLoad:t[0]||(t[0]=t=>e.onLoadShadowImg(t)),onError:t[1]||(t[1]=(...t)=>e.onError&&e.onError(...t))},null,40,o)],12,a)):(0,s.kq)("",!0),(0,s._)("div",{class:(0,r.C_)({"nu-image__clipper":!e.imgControl})},[(0,s._)("div",{class:"nu-image__picture",style:(0,r.j5)(e.imgStyles())},[(0,s._)("img",{class:(0,r.C_)(["nu-image__img full-size",{"layer-flip":e.flippedAnimation()}]),ref:"img",style:(0,r.j5)(e.flipStyles),draggable:"false",crossorigin:"anonymous",onError:t[2]||(t[2]=(...t)=>e.onError&&e.onError(...t)),onLoad:t[3]||(t[3]=(...t)=>e.onLoad&&e.onLoad(...t)),src:e.finalSrc},null,46,h),e.isAdjustImage?((0,s.wg)(),(0,s.iD)("svg",{key:0,class:(0,r.C_)(["nu-image__svg",{"layer-flip":e.flippedAnimation()}]),style:(0,r.j5)(e.flipStyles),viewBox:`0 0 ${e.imgNaturalSize.width} ${e.imgNaturalSize.height}`,preserveAspectRatio:"none",role:"image"},[(0,s._)("defs",null,[(0,s._)("filter",{id:e.filterId,"color-interpolation-filters":"sRGB"},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.svgFilterElms(),((t,i)=>((0,s.wg)(),(0,s.j4)((0,s.LL)(t.tag),(0,s.dG)({key:`${e.filterId+i}`},t.attrs),{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(t.child,(e=>((0,s.wg)(),(0,s.j4)((0,s.LL)(e.tag),(0,s.dG)({key:e.tag},e.attrs),null,16)))),128))])),_:2},1040)))),128))],8,l)]),(0,s._)("image",{class:"nu-image__img full-size",ref:"adjust-img",filter:`url(#${e.filterId})`,width:e.imgNaturalSize.width,height:e.imgNaturalSize.height,crossorigin:"anonymous",draggable:"false",onError:t[4]||(t[4]=(...t)=>e.onError&&e.onError(...t)),onLoad:t[5]||(t[5]=(...t)=>e.onAdjustImgLoad&&e.onAdjustImgLoad(...t)),"xlink:href":e.finalSrc},null,40,d)],14,c)):(0,s.kq)("",!0)],4)],2),e.hasHalation()?((0,s.wg)(!0),(0,s.iD)(s.HY,{key:2},(0,s.Ko)(e.cssFilterElms(),((e,t)=>((0,s.wg)(),(0,s.j4)((0,s.LL)(e.tag),(0,s.dG)({class:"nu-image__adjust",key:`cssFilter${t}`},e.attrs),null,16)))),128)):(0,s.kq)("",!0)],14,n)):(0,s.kq)("",!0)}var p=i(23931),y=i(865),u=i(6400),f=i(62013),m=i(78871),x=i(70118),I=i(83122),v=i(30544),S=i(67579),w=i(3162),b=i(75231),L=i(53074),P=i(32905),Z=i(50559),$=i(38058),T=i(94621),C=Object.defineProperty,M=Object.defineProperties,D=Object.getOwnPropertyDescriptors,_=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,R=(e,t,i)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,F=(e,t)=>{for(var i in t||(t={}))E.call(t,i)&&R(e,i,t[i]);if(_)for(var i of _(t))O.call(t,i)&&R(e,i,t[i]);return e},j=(e,t)=>M(e,D(t)),k=(e,t,i)=>new Promise(((s,r)=>{var n=e=>{try{o(i.next(e))}catch(t){r(t)}},a=e=>{try{o(i.throw(e))}catch(t){r(t)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,a);o((i=i.apply(e,t)).next())})),z=(0,s.aZ)({emits:["onload"],props:{config:{type:Object,required:!0},pageIndex:{type:Number,required:!0},page:{type:Object,required:!0},layerIndex:{type:Number,required:!0},subLayerIndex:{type:Number,default:-1},isBgImgControl:{type:Boolean,default:!1},imgControl:{type:Boolean,default:!1},contentScaleRatio:{default:1,type:Number},forRender:Boolean,primaryLayer:{type:Object,default:()=>{}},inPreview:{default:!1,type:Boolean}},created(){return k(this,null,(function*(){this.handleInitLoad();const e=b.ZP.getCurrLayer.type===u.F5.frame;this.config.isFrameImg||this.isBgImgControl||this.config.isFrame||this.config.forRender||e||this.handleShadowInit()}))},beforeUnmount(){this.isBgImgControl||this.config.inProcess&&this.setIsProcessing(u.Q8.none)},unmounted(){this.hasDestroyed=!0},data(){return{hasDestroyed:!1,isOnError:!1,src:"",errorSrcIdentifier:{identifier:"",retry:0},shadowBuff:{canvasShadowImg:void 0,canvasSize:{width:0,height:0},drawCanvasW:0,drawCanvasH:0,MAXSIZE:0},imgNaturalSize:{width:0,height:0},initialized:!1,isShadowImgLoaded:!1}},watch:{getImgDimension(e,t){this.handleDimensionUpdate(e,t)},"config.srcObj":{handler:function(e,t){m.Z.isWatcherTriggerByUndoRedo(e,t)||(this.shadowBuff.canvasShadowImg=void 0,this.forRender||this.previewAsLoading().then((()=>{const e=this.config.styles.shadow.isTransparent,t=this.handleIsTransparent(),i=this.currentShadowEffect()===y.w.floating,s=!i&&(this.currentShadowEffect()===y.w.imageMatched||this.shadow().isTransparent||t||e);s&&this.redrawShadow()})))},deep:!0},"config.styles.shadow.effects":{handler:function(e,t){if(m.Z.isWatcherTriggerByUndoRedo(e,t))return;const i=this.config.styles.shadow;i.old&&i.old.currentEffect!==i.currentEffect||this.forRender||!this.$refs.canvas||this.isUploadingShadowImg||this.currentShadowEffect()===y.w.none||this.updateShadowEffect(e)},deep:!0},"config.styles.shadow.currentEffect"(){this.forRender||"upload"===this.shadow().srcObj.type||this.getCurrFunctionPanelType!==u.UJ.photoShadow||(this.$refs.canvas?this.handleNewShadowEffect():setTimeout((()=>this.handleNewShadowEffect()),0))},showCanvas(e){e&&setTimeout((()=>{this.handleNewShadowEffect(!1)}))},"config.imgControl"(e){if(e){const{subLayerIdx:e}=this.layerInfo(),t="undefined"!==typeof e&&-1!==e,i=this.primaryLayer?this.primaryLayer:this.config,s=t&&i.type===u.F5.frame&&i.clips[e||0].type===u.F5.image,r=t&&i.type===u.F5.group&&i.layers[e||0].type===u.F5.image;(!t&&i.type===u.F5.image||s||r)&&this.setImgConfig(this.layerInfo())}else this.setImgConfig(void 0),setTimeout((()=>{var e,t;if(-1===b.ZP.layerIndex){const i=-1!==this.subLayerIndex&&"undefined"!==typeof this.subLayerIndex,s=i?(null!=(t=null==(e=this.config.parentLayerStyles)?void 0:e.zindex)?t:0)-1:this.config.styles.zindex-1;if(x.Z.deselect(),x.Z.select(this.pageIndex,[s]),i){const{pageIndex:e,layerIndex:t,subLayerIdx:i}=this.layerInfo();this.primaryLayerType()===u.F5.group?b.ZP.updateLayerProps(e,t,{active:!0},i):this.primaryLayerType()===u.F5.frame&&f.Z.updateFrameLayerProps(e,t,null!=i?i:0,{active:!0})}}}),0),this.handleDimensionUpdate();this.forRender||this.config.imgControl||this.currentShadowEffect()===y.w.none||(this.shadow().isTransparent&&![y.w.floating].includes(this.currentShadowEffect())||this.currentShadowEffect()===y.w.imageMatched)&&this.redrawShadow()},"config.styles.shadow.srcObj":{handler:function(e,t){m.Z.isWatcherTriggerByUndoRedo(e,t)||(this.config.isFrameImg||""!==e.type||this.config.forRender||S.ZP.setEffect(this.shadow().currentEffect,{},this.layerInfo()),this.handleUploadShadowImg(),this.isShadowImgLoaded=!1)},deep:!0},uploadShadowImgs:{handler(e){const t=e[e.length-1],i=this.shadow();if("upload"===i.srcObj.type&&t.id===i.srcObj.assetId){const{pageIndex:e,layerIndex:i,subLayerIndex:s}=this,r=t.srcObj,n=t.styles;S.ZP.updateShadowSrc({pageIndex:e,layerIndex:i,subLayerIdx:s},r),S.ZP.updateShadowStyles({pageIndex:e,layerIndex:i,subLayerIdx:s},n)}},deep:!0},isBlurImg(e){const{imgWidth:t,imgHeight:i}=this.config.styles,s=w.Z.appendOriginQuery(w.Z.getSrc(this.config,e?w.Z.getSrcSize(this.config.srcObj,Math.max(t,i)):this.getImgDimension));w.Z.imgLoadHandler(s,(()=>{this.isBlurImg===e&&(this.src=s)}),{crossOrigin:!0})}},components:{NuAdjustImage:T.Z},computed:j(F(F(F(F({},(0,$.Se)({pageScaleRatio:"getPageScaleRatio",getCurrFunctionPanelType:"getCurrFunctionPanelType",isUploadingShadowImg:"shadow/isUploading",isHandling:"shadow/isHandling",isShowPagePanel:"page/getShowPagePanel",isProcessing:"shadow/isProcessing",isShowPagePreview:"page/getIsShowPagePreview"})),(0,$.rn)("user",["imgSizeMap","userId","verUni"])),(0,$.rn)("shadow",["uploadId","handleId","uploadShadowImgs"])),(0,$.rn)("mobileEditor",{inAllPagesMode:"mobileAllPageMode"})),{cyReady(){return!(this.src.startsWith("data:image")||!this.initialized||this.$isTouchDevice()&&this.showCanvas)},isAdjustImage(){const{styles:{adjust:e={}}}=this.config,t=Object.entries(e).filter((([,e])=>"number"===typeof e&&0!==e));return 0!==t.length&&!(1===t.length&&"halation"===t[0][0])},finalSrc(){return"Preview"===this.$route.name?w.Z.appendCompQueryForVivipic(this.src):this.src},shadowSrc(){if(!this.shadow()||!this.shadow().srcObj)return"";const e=w.Z.getSrc(this.shadow().srcObj,w.Z.getSrcSize(this.shadow().srcObj,this.getImgDimension));return"Preview"===this.$route.name?w.Z.appendCompQueryForVivipic(e):e},canvasWrapperStyle(){if(this.forRender)return{};const{scale:e,horizontalFlip:t,verticalFlip:i}=this.config.styles,{width:s,height:r}=this.shadowBuff.canvasSize,n=this.contentScaleRatio*(m.Z.isTouchDevice()?.01*this.pageScaleRatio:1);return{width:s*n+"px",height:r*n+"px",transform:`scaleX(${t?-1:1}) scaleY(${i?-1:1}) scale(${e})`}},imgShadowStyles(){if(this.forRender)return{};const{imgWidth:e,imgHeight:t,imgX:i,imgY:s}=this.shadow().styles,{scale:r,horizontalFlip:n,verticalFlip:a}=this.config.styles,o=this.contentScaleRatio*(m.Z.isTouchDevice()?.01*this.pageScaleRatio:1),h=(n?-1:1)*o,c=(a?-1:1)*o;return{width:(e*o).toString()+"px",height:(t*o).toString()+"px",transform:`translate(${h*i*r}px, ${c*s*r}px) scaleX(${n?-1:1}) scaleY(${a?-1:1}) scale(${r})`}},flipStyles(){const{horizontalFlip:e,verticalFlip:t}=this.config.styles;let i=e?-1:1,s=t?-1:1;if("undefined"!==typeof this.subLayerIndex&&-1!==this.subLayerIndex){const e=this.primaryLayer?this.primaryLayer:this.config;"frame"===e.type&&"frame"===this.config.srcObj.type&&(i=e.styles.horizontalFlip?-1:1,s=e.styles.verticalFlip?-1:1)}return 1!==i||1!==s?{transform:`scale(${i}, ${s})`}:{}},filterId(){const e=this.$store.getters["user/getBrowserInfo"],t="Safari"===e.name&&"16.3"!==e.version&&m.Z.versionCheck({greaterThan:"16.0",lessThan:"16.3"}),i="iOS"===e.os.family&&"16.3"!==e.os.version&&m.Z.versionCheck({greaterThan:"16.0",lessThan:"16.3",version:e.os.version});if(t||i){const{styles:{adjust:e},id:t}=this.config,{blur:i=0,brightness:s=0,contrast:r=0,halation:n=0,hue:a=0,saturate:o=0,warm:h=0}=e,c=t+i.toString()+s.toString()+r.toString()+n.toString()+a.toString()+o.toString()+h.toString();return`filter__${c}`}{const e=m.Z.generateRandomString(5);return`filter__${e}`}},showCanvas(){const{subLayerIndex:e,handleId:t}=this;if(void 0===this.page)return!1;const i=this.config.styles.shadow.currentEffect,s=i!==y.w.none,r=(null==t?void 0:t.pageId)===this.page.id&&(()=>{if(-1!==e&&"undefined"!==typeof e){const{primaryLayer:i={}}=this;return i.id===t.layerId&&i.layers[e].id===t.subLayerId}return this.config.id===t.layerId})(),n=!!(this.shadow().srcObj&&this.shadow().srcObj.type&&"upload"!==this.shadow().srcObj.type&&this.shadow().srcObj.assetId);return s&&r||n&&!this.isShadowImgLoaded},containerStyles(){const{width:e,height:t}=this.scaledConfig(),i=F({},this.isAdjustImage&&!this.inAllPagesMode&&{transform:"translateZ(0)"});return this.showCanvas?j(F({},i),{width:`${e}px`,height:`${t}px`}):F({},i)},getImgDimension(){const{srcObj:e}=this.config,{imgWidth:t,imgHeight:i}=this.config.styles;let s=t,r=i;const n=this.primaryLayer,a=n&&n.type===u.F5.frame&&n.clips[0].isFrameImg;if(!this.forRender&&(this.config.parentLayerStyles||n)&&!a){const{scale:e}=this.config.parentLayerStyles||(null==n?void 0:n.styles);s*=e,r*=e}const o=P.Z.getImageDpiRatio(this.page);return s*=o,r*=o,w.Z.getSrcSize(e,w.Z.getSignificantDimension(s,r)*(.01*this.pageScaleRatio))},isBlurImg(){var e;return!!(null==(e=this.config.styles.adjust)?void 0:e.blur)}}),methods:j(F(F(F({},(0,$.nv)("file",["updateImages"])),(0,$.nv)("brandkit",["updateLogos"])),(0,$.OI)({UPDATE_shadowEffect:"UPDATE_shadowEffect",setIsProcessing:"bgRemove/SET_isProcessing",setImgConfig:"imgControl/SET_CONFIG"})),{getErrorSrcIdentifier(e){const{srcObj:t,styles:i}=e;return t.type+t.assetId+t.userId+(i.adjust.blur>0?"_blur":"")},onError(){this._onError()},_onError(e=!1){if(!this.src&&!e)return;if(this.errorSrcIdentifier.identifier===this.getErrorSrcIdentifier(this.config)){if(3===this.errorSrcIdentifier.retry)return;this.errorSrcIdentifier.retry++}else this.errorSrcIdentifier.identifier=this.getErrorSrcIdentifier(this.config),this.errorSrcIdentifier.retry=1;const{srcObj:t,styles:{width:i,height:s}}=this.config;let r;if(this.isOnError=!0,"xtra"!==w.Z.getSrcSize(t,Math.max(i,s))){switch(t.type){case"private":r=()=>k(this,null,(function*(){return yield this.updateImages({assetSet:new Set([t.assetId])})}));break;case"logo-private":r=()=>k(this,null,(function*(){return yield this.updateLogos({assetSet:new Set([t.assetId])})}));break}if(void 0!==r)try{r().then((()=>{const{imgWidth:e,imgHeight:t}=this.config.styles,i=w.Z.appendOriginQuery(w.Z.getSrc(this.config,this.isBlurImg?w.Z.getSrcSize(this.config.srcObj,Math.max(e,t)):this.getImgDimension));w.Z.imgLoadHandler(i,(()=>{this.src=i}),{crossOrigin:!0})}))}catch(n){0!==this.src.indexOf("data:image/png;base64")&&fetch(this.src).then((e=>{const{status:t,statusText:i}=e;this.logImgError(n,"fetch result: "+t+i)})).catch((e=>{this.logImgError(n,"fetch result: "+e)}))}}else b.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{srcObj:j(F({},t),{maxSize:"larg"})})},onAdjustImgLoad(e){w.Z.imgLoadHandler(this.src,(e=>{this.imgNaturalSize.width===e.width&&this.imgNaturalSize.height===e.height||(this.imgNaturalSize.width=e.width,this.imgNaturalSize.height=e.height)}),{crossOrigin:!0})},onLoad(e){this.isOnError=!1;const t=e.target;this.imgNaturalSize.width===t.width&&this.imgNaturalSize.height===t.height||(this.imgNaturalSize.width=t.width,this.imgNaturalSize.height=t.height);const i=t.naturalWidth/t.naturalHeight,s=this.config.styles.imgWidth/this.config.styles.imgHeight;if(i&&s&&Math.abs(i-s)>.1&&"frame"!==this.config.srcObj.type){const e=this.config.styles.imgHeight*i,t=this.config.styles.imgWidth-e;"frame"===this.primaryLayerType()?f.Z.updateFrameLayerStyles(this.pageIndex,this.layerIndex,this.subLayerIndex,{imgWidth:e,imgX:this.config.styles.imgX+t/2}):b.ZP.updateLayerStyles(this.pageIndex,this.layerIndex,{imgWidth:e,imgX:this.config.styles.imgX+t/2},this.subLayerIndex)}this.$emit("onload")},onLoadShadowImg(e){setTimeout((()=>{this.isShadowImgLoaded=!0}),10)},logImgError(e,...t){if(0!==this.src.indexOf("data:image/png;base64"))return;const{pageIndex:i,layerIndex:s,subLayerIndex:r}=this,{srcObj:{type:n,assetId:a,userId:o}}=this.config;let h=`pageIndex: ${i}, layerIndex: ${s}, subLayerIndex: ${r}\nsrcObj: { type: ${n}, assetId: ${a}, userId: ${o} }\nError config src: ${this.src}`;t.forEach((e=>{h+=`\n${e}`})),console.warn(h),L.Z.setLog(h)},previewAsLoading(){return k(this,null,(function*(){let e=!1;const{imgWidth:t,imgHeight:i}=this.config.styles,s=w.Z.appendOriginQuery(w.Z.getSrc(this.config,this.isBlurImg?w.Z.getSrcSize(this.config.srcObj,Math.max(t,i)):this.getImgDimension)),r=w.Z.getImgIdentifier(this.config.srcObj),n=this.config.previewSrc||w.Z.appendOriginQuery(w.Z.getSrc(this.config,this.getPreviewSize()));if(yield w.Z.imgLoadHandler(n,(()=>{w.Z.getImgIdentifier(this.config.srcObj)!==r||e||(this.src=n)}),{crossOrigin:!0}).catch((()=>{s===n&&this._onError(!0),console.warn("img preview cannot be loaded!")})),s&&s!==n)return new Promise(((t,i)=>{w.Z.imgLoadHandler(s,(()=>{w.Z.getImgIdentifier(this.config.srcObj)===r&&(e=!0,this.src=s,""===this.config.previewSrc&&b.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{previewSrc:s},this.subLayerIndex),this.isBlurImg||(this.preLoadImg("pre",this.getImgDimension),this.preLoadImg("next",this.getImgDimension)),t())}),{error:()=>{i(new Error(`cannot load the current image, src: ${this.src}`)),this._onError(!0)},crossOrigin:!0})}))}))},handleDimensionUpdate(e=0,t=0){if(this.isBlurImg)return;const i=w.Z.appendOriginQuery(w.Z.getSrc(this.config,this.getImgDimension));if(!this.isOnError&&i){const{type:s}=this.config.srcObj;if("background"===s)return;const r=w.Z.getImgIdentifier(this.config.srcObj);w.Z.imgLoadHandler(i,(()=>k(this,null,(function*(){w.Z.getImgIdentifier(this.config.srcObj)===r&&(this.src=i,b.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{previewSrc:i},this.subLayerIndex),e>t?(yield this.preLoadImg("next",this.getImgDimension),this.preLoadImg("pre",this.getImgDimension)):(yield this.preLoadImg("pre",this.getImgDimension),this.preLoadImg("next",this.getImgDimension)))}))),{crossOrigin:!0})}},preLoadImg(e,t){return k(this,null,(function*(){return new Promise(((i,s)=>{var r,n,a;const o=w.Z.getSrcSize((null==(n=null==(r=this.config.adjustSrcObj)?void 0:r.srcObj)?void 0:n.type)?null==(a=this.config.adjustSrcObj)?void 0:a.srcObj:this.config.srcObj,t,e),h=w.Z.appendOriginQuery(w.Z.getSrc(this.config,o));w.Z.imgLoadHandler(h,(()=>i()),{error:()=>{s(new Error(`cannot preLoad the ${e}-image, src: ${h}`)),fetch(h).then((e=>{const{status:t,statusText:i}=e;this.logImgError("img src:",h,"fetch result: "+t+i)})).catch((e=>{this.logImgError("img src:",h,"fetch result: "+e)}))},crossOrigin:!0})}))}))},handleIsTransparent(e){if(this.forRender||["frame","tmp","group"].includes(this.primaryLayerType()))return;if(!this.$refs.img)return;const t=null!=e?e:this.$refs.img,i=S.ZP.isTransparentBg(t);return S.ZP.updateEffectProps(this.layerInfo(),{isTransparent:i}),i},handleInitLoad(){return k(this,null,(function*(){if("backendRendering"!==this.userId)yield this.previewAsLoading().then((()=>this.handleIsTransparent()));else{const{imgWidth:e,imgHeight:t}=this.config.styles;this.src=w.Z.appendOriginQuery(w.Z.getSrc(this.config,this.isBlurImg?w.Z.getSrcSize(this.config.srcObj,Math.max(e,t)):this.getImgDimension)),this.isAdjustImage&&w.Z.imgLoadHandler(this.src,(e=>{this.handleIsTransparent(e)}))}this.initialized=!0}))},handleShadowInit(){if(this.forRender)return;const e=this.shadow();switch(e.srcObj.type){case"shadow-private":this.fetchShadowImg();break;case"upload":e.srcObj.assetId?(console.log("handle shadowInit: upload"),this.handleUploadShadowImg()):(console.log("handle shadowInit: upload"),this.isHandling||this.isProcessing||S.ZP.updateEffectState(this.layerInfo(),y.w.none));break}},handleUploadShadowImg(){const{srcObj:e}=this.shadow();if("upload"===e.type&&e.assetId){const t=this.uploadShadowImgs.find((t=>t.id===e.assetId));t&&(S.ZP.updateShadowSrc(this.layerInfo(),t.srcObj),S.ZP.updateShadowStyles(this.layerInfo(),t.styles))}},handleNewShadowEffect(e=!0){return k(this,null,(function*(){const{layerInfo:t,shadowBuff:i}=this,s=this.$refs.canvas;if(!s||this.isUploadingShadowImg)return void(s||(S.ZP.setIsProcess(this.layerInfo(),!1),S.ZP.setProcessId(),S.ZP.setHandleId(),console.warn("the canvas is undefined")));e&&this.clearShadowSrc();const{currentEffect:r}=this.shadow(),n=this.shadow().srcObj.type&&"upload"!==this.shadow().srcObj.type&&this.shadow().srcObj.assetId;r!==y.w.none&&(S.ZP.setProcessId(this.id()),!n&&S.ZP.setIsProcess(t(),!0));let a=new Image;if(["unsplash","pixels"].includes(this.config.srcObj.type)||this.shadowBuff.MAXSIZE)["unsplash","pixels"].includes(this.config.srcObj.type)&&(this.shadowBuff.MAXSIZE=S.M6);else{const e=yield w.Z.getImgSize(this.config.srcObj,!1);e&&(this.shadowBuff.MAXSIZE=Math.min(Math.max(e.data.height,e.data.width),S.M6))}switch(r){case y.w.imageMatched:case y.w.floating:case y.w.shadow:case y.w.frame:case y.w.blur:i.canvasShadowImg?a=i.canvasShadowImg:(this.config.previewSrc&&this.config.previewSrc.includes("data:image/png;base64")&&b.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{previewSrc:""}),a.crossOrigin="anonymous",a.src=w.Z.getSrc(this.config,["unsplash","pexels"].includes(this.config.srcObj.type)?S.hI:"smal"),yield new Promise((e=>{a.onerror=()=>{console.log("img load error"),(0,Z.h4)({group:"copy",text:`${p.Z.global.t("NN0351")}`}),e()},a.onload=()=>k(this,null,(function*(){this.shadowBuff.canvasShadowImg=a;const t=yield v.Z.isSVG(a.src,this.config);t?v.Z.svgImageSizeFormatter(a,510,(()=>{a.onload=()=>{this.shadowBuff.MAXSIZE=S.M6,e()}})):e()}))})));break;case y.w.none:return S.ZP.updateShadowSrc(this.layerInfo(),{type:"",assetId:"",userId:""}),S.ZP.setProcessId(),void S.ZP.clearLayerData()}if(S.ZP.updateEffectProps(this.layerInfo(),{maxsize:i.MAXSIZE,middsize:Math.max(a.naturalWidth,a.naturalHeight)}),"undefined"===typeof this.config.styles.shadow.isTransparent){s.setAttribute("width",`${a.naturalWidth}`),s.setAttribute("height",`${a.naturalHeight}`);const e=s.getContext("2d");e.drawImage(a,0,0,a.naturalWidth,a.naturalHeight,0,0,s.width,s.height),S.ZP.updateEffectProps(t(),{isTransparent:S.ZP.isTransparentBg(s)})}const{width:o,height:h,imgWidth:c,imgHeight:l,shadow:d}=this.config.styles,g=d.middsize/d.maxsize;let u=0,f=0,m=0,x=0;const I=r===y.w.floating||!d.isTransparent&&[y.w.shadow,y.w.frame,y.w.blur].includes(d.currentEffect);if(I){const e=r===y.w.floating?a.naturalWidth/a.naturalHeight:o/h;u=Math.round(e>1?1600:1600*e),f=Math.round(e>1?1600/e:1600),m=u+S.j_,x=f+S.j_}else m=a.naturalWidth+S.j_*g,x=a.naturalHeight+S.j_*g,u=Math.round(a.naturalWidth*o/c),f=Math.round(a.naturalHeight*h/l);this.shadowBuff.canvasSize.width=m*o/u,this.shadowBuff.canvasSize.height=x*h/f,this.shadowBuff.drawCanvasW=u,this.shadowBuff.drawCanvasH=f,s.setAttribute("width",`${m}`),s.setAttribute("height",`${x}`);let L=[s];if(this.isShowPagePanel){const{pageIndex:e,layerIndex:t,subLayerIndex:i}=this;L=[...document.querySelectorAll(`.shadow__canvas_${e}_${t}_${"undefined"===typeof i?-1:i}`)]}const P={pageId:this.page.id,drawCanvasW:u,drawCanvasH:f,layerInfo:t(),cb:()=>{this.clearShadowSrc()}};switch(S.ZP.drawingInit(s,a,this.config,P),r){case y.w.shadow:case y.w.frame:case y.w.blur:S.ZP.drawShadow(L,a,this.config,P);break;case y.w.imageMatched:S.ZP.drawImageMatchedShadow(L,a,this.config,P);break;case y.w.floating:S.ZP.drawFloatingShadow(L,a,this.config,P);break}}))},updateShadowEffect(e){const{shadowBuff:t}=this,i=this.$refs.canvas,s=this.layerInfo(),{drawCanvasW:r,drawCanvasH:n}=t;if(!i||this.isUploadingShadowImg)return void console.log("can not get canvas");let a=[i];if(this.isShowPagePanel){const{pageIndex:e,layerIndex:t,subLayerIndex:i}=this;a=[...document.querySelectorAll(`.shadow__canvas_${e}_${t}_${"undefined"===typeof i?-1:i}`)]}window.requestAnimationFrame((()=>{switch(this.UPDATE_shadowEffect({layerInfo:s,payload:F({},e)}),this.currentShadowEffect()){case y.w.shadow:case y.w.blur:case y.w.frame:t.canvasShadowImg&&S.ZP.drawShadow(a,t.canvasShadowImg,this.config,{layerInfo:s,drawCanvasW:r,drawCanvasH:n,cb:()=>this.shadow().srcObj.type&&this.clearShadowSrc()});break;case y.w.imageMatched:t.canvasShadowImg&&S.ZP.drawImageMatchedShadow(a,t.canvasShadowImg,this.config,{layerInfo:s,drawCanvasW:r,drawCanvasH:n,cb:()=>this.shadow().srcObj.type&&this.clearShadowSrc()});break;case y.w.floating:t.canvasShadowImg&&S.ZP.drawFloatingShadow(a,t.canvasShadowImg,this.config,{layerInfo:s,drawCanvasW:r,drawCanvasH:n,cb:()=>this.shadow().srcObj.type&&this.clearShadowSrc()});break;case y.w.none:break;default:m.Z.assertUnreachable(this.currentShadowEffect())}}))},clearShadowSrc(){this.handleId.pageId&&this.handleId.layerId&&S.ZP.updateShadowSrc(this.layerInfo(),{type:"",assetId:"",userId:""})},redrawShadow(){const e={pageId:this.page.id,layerId:"undefined"!==typeof this.layerIndex&&-1!==this.layerIndex?b.ZP.getLayer(this.pageIndex,this.layerIndex).id:this.config.id,subLayerId:this.config.id};S.ZP.setHandleId(e),S.ZP.updateShadowSrc(this.layerInfo(),{type:"",assetId:"",userId:""}),b.ZP.updateLayerStyles(this.pageIndex,this.layerIndex,{scale:1},this.subLayerIndex),x.Z.deselect(),this.isShowPagePreview||x.Z.select(this.pageIndex,[this.layerIndex]),this.subLayerIndex,-1!==this.subLayerIndex&&b.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{active:!0},this.subLayerIndex),this.$nextTick((()=>{const e=b.ZP.getLayer(this.layerInfo().pageIndex,this.layerInfo().layerIndex).id,t={primarylayerId:e,config:this.config,layerInfo:this.layerInfo};v.Z.handleShadowUpload(t)}))},fetchShadowImg(){const{assetId:e}=this.config.styles.shadow.srcObj,t=this.$store.getters["shadow/shadowImgs"];"number"===typeof e&&(t.has(e)||this.$store.dispatch("shadow/ADD_SHADOW_IMG",[e]).then((()=>{S.ZP.updateShadowSrc(this.layerInfo(),j(F({},this.config.styles.shadow.srcObj),{userId:"ver="+m.Z.generateRandomString(8)}))})))},layerInfo(){const e={pageIndex:this.pageIndex,layerIndex:this.layerIndex,subLayerIdx:this.subLayerIndex};return e},scaledConfig(){var e;const{width:t,height:i,imgWidth:s,imgHeight:r,imgX:n,imgY:a}=this.config.styles,o=this.contentScaleRatio*("frame"!==(null==(e=this.primaryLayer)?void 0:e.type)&&this.$isTouchDevice()?.01*this.pageScaleRatio:1);return{width:t*o,height:i*o,imgWidth:s*o,imgHeight:r*o,imgX:n*o,imgY:a*o}},cssFilterElms(){const{adjust:e,width:t,height:i}=this.adjustImgStyles();if(Number.isNaN(e.halation)||!e.halation)return[];const s=this.contentScaleRatio*(this.$isTouchDevice()?.01*this.pageScaleRatio:1),r={width:t/2*s,x:t/2*s,y:i/2*s};return I.Z.getHalation(e.halation,r)},svgFilterElms(){const{adjust:e}=this.adjustImgStyles();return I.Z.convertAdjustToSvgFilter(e||{},this.config)},imgStyles(){let{imgX:e,imgY:t,imgHeight:i,imgWidth:s}=this.scaledConfig();return this.isBgImgControl&&(e=0,t=0),{transform:`translate(${e}px, ${t}px)`,width:`${s}px`,height:`${i}px`}},getPreviewSize(){const e=this.imgSizeMap;return w.Z.getSrcSize(this.config.srcObj,(null==e?void 0:e.flatMap((e=>"tiny"===e.key?[e.size]:[]))[0])||320)},hasHalation(){var e;return null==(e=this.config.styles.adjust)?void 0:e.halation},adjustImgStyles(){let e=this.config.styles;return this.isBgImgControl&&(e=m.Z.deepCopy(this.config.styles),Object.assign(e.adjust,{halation:0})),e},flippedAnimation(){const e=b.ZP.getLayer(this.pageIndex,this.layerIndex);return"undefined"===typeof this.subLayerIndex||-1===this.subLayerIndex||"frame"!==e.type},shadow(){return this.config.styles.shadow},currentShadowEffect(){return this.shadow().currentEffect},primaryLayerType(){const e=b.ZP.getLayer(this.pageIndex,this.layerIndex);return e.type},id(){return{pageId:this.page.id,layerId:"undefined"!==typeof this.layerIndex&&-1!==this.layerIndex?b.ZP.getLayer(this.pageIndex,this.layerIndex).id:this.config.id,subLayerId:this.config.id}}})}),H=i(53372);const N=(0,H.Z)(z,[["render",g],["__scopeId","data-v-0abad9d4"],["__file","NuImage.vue"]]);var A=N},55839:function(e,t,i){i.r(t),i.d(t,{default:function(){return C}});var s=i(29651),r=i(819),n=i(41463);const a={class:"nu-img-controller"};function o(e,t,i,o,h,c){return(0,s.wg)(),(0,s.iD)("div",a,[(0,s._)("div",{class:"nu-controller",style:(0,r.j5)(e.controllerStyles())},null,4),(0,s._)("div",{class:"nu-controller__body",ref:"body",style:(0,r.j5)(e.styles),onPointerdown:t[4]||(t[4]=(0,n.iM)(((...t)=>e.moveStart&&e.moveStart(...t)),["stop"])),onTouchstart:t[5]||(t[5]=(...t)=>e.disableTouchEvent&&e.disableTouchEvent(...t))},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.controlPoints.scalers,((i,a)=>((0,s.wg)(),(0,s.iD)("div",{class:"control-point",key:`scaler-${a}`,style:(0,r.j5)(Object.assign(e.scalerStyles(i.styles),e.cursorStyles(i.cursor,e.getLayerRotate),{pointerEvents:e.forRender?"none":"initial"})),onPointerdown:t[0]||(t[0]=(0,n.iM)((t=>e.$isTouchDevice()?null:e.scaleStart(t)),["prevent","stop"])),onTouchstart:t[1]||(t[1]=t=>e.$isTouchDevice()?null:e.disableTouchEvent(t))},null,36)))),128)),e.$isTouchDevice()?((0,s.wg)(!0),(0,s.iD)(s.HY,{key:0},(0,s.Ko)(e.controlPoints.scalerTouchAreas,((i,a)=>((0,s.wg)(),(0,s.iD)("div",{class:"control-point",key:`scaler-touch-${a}`,style:(0,r.j5)(Object.assign(e.scalerStyles(i.styles),e.cursorStyles(i.cursor,e.getLayerRotate),{pointerEvents:e.forRender?"none":"initial"})),onPointerdown:t[2]||(t[2]=(0,n.iM)(((...t)=>e.scaleStart&&e.scaleStart(...t)),["prevent","stop"])),onTouchstart:t[3]||(t[3]=(...t)=>e.disableTouchEvent&&e.disableTouchEvent(...t))},null,36)))),128)):(0,s.kq)("",!0)],36)])}var h=i(865),c=i(40881),l=i(2531),d=i(67579),g=i(75231),p=i(35426),y=i(50543),u=i(32905),f=i(38058),m=Object.defineProperty,x=Object.defineProperties,I=Object.getOwnPropertyDescriptors,v=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable,b=(e,t,i)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,L=(e,t)=>{for(var i in t||(t={}))S.call(t,i)&&b(e,i,t[i]);if(v)for(var i of v(t))w.call(t,i)&&b(e,i,t[i]);return e},P=(e,t)=>x(e,I(t)),Z=(0,s.aZ)({emits:[],props:{config:{type:Object,required:!0},layerIndex:{type:Number,required:!0},pageIndex:{type:Number,required:!0},page:{type:Object,required:!0},primaryLayerIndex:{type:Number,required:!0},primaryLayer:{type:Object,required:!0},forRender:{type:Boolean,default:!1},contentScaleRatio:{default:1,type:Number}},data(){return{controlPoints:c.Z.getControlPoints(),initialPos:{x:0,y:0},initImgPos:{imgX:0,imgY:0},initialWH:{width:0,height:0},center:{x:0,y:0},control:{xSign:1,ySign:1},pointerId:-1}},mounted(){if(this.forRender)return;const e=this.config.styles.shadow;if(e&&![h.w.none,h.w.floating].includes(e.currentEffect)&&(e.currentEffect===h.w.imageMatched||e.isTransparent)){d.ZP.setProcessId({pageId:u.Z.currFocusPage.id,layerId:this.primaryLayer?this.primaryLayer.id:this.config.id,subLayerId:this.primaryLayer?this.config.id:void 0});const e=-1!==this.primaryLayerIndex;d.ZP.updateShadowSrc({pageIndex:this.pageIndex,layerIndex:e?this.primaryLayerIndex:this.layerIndex,subLayerIdx:e?this.layerIndex:void 0},{type:"",userId:"",assetId:""})}},unmounted(){for(let e=0;e<this.page.layers.length;e++)"image"===this.page.layers[e].type&&c.Z.updateLayerProps(this.pageIndex,e,{imgControl:!1})},computed:P(L({},(0,f.Se)({scaleRatio:"getPageScaleRatio",getPage:"getPage"})),{styles(){var e;const t=this.imgControllerPosHandler(),i=this.$isTouchDevice()?.01*this.scaleRatio*this.contentScaleRatio:1;return{transform:`translate(${t.x*i}px, ${t.y*i}px) rotate(${this.config.styles.rotate}deg)`,width:this.config.styles.imgWidth*i+"px",height:this.config.styles.imgHeight*i+"px",outline:2*(this.$isTouchDevice()?1:100/this.scaleRatio)+"px solid #7190CC","pointer-events":null!=(e=this.pointerEvents)?e:"initial"}},pointerEvents(){return this.forRender?"none":"initial"},getImgX(){return this.config.styles.imgX},getImgY(){return this.config.styles.imgY},getImgWidth(){return this.config.styles.imgWidth},getImgHeight(){return this.config.styles.imgHeight},primaryLayerType(){return this.primaryLayer.type},getLayerScale(){return this.primaryLayer&&"frame"===this.primaryLayerType&&!this.config.isFrameImg?this.config.styles.scale:1},getLayerRotate(){return this.config.styles.rotate},angleInRad(){const{type:e,styles:t}=g.ZP.getCurrLayer,{rotate:i}=this.config.styles;return-1!==this.primaryLayerIndex?(t.rotate+("group"===e?i:0))*Math.PI/180:this.getLayerRotate*Math.PI/180}}),methods:P(L(L({},(0,f.OI)({setLastSelectedLayerIndex:"SET_lastSelectedLayerIndex"})),(0,f.OI)({updateConfig:"imgControl/UPDATE_CONFIG"})),{controllerStyles(){const e=this.$isTouchDevice()?.01*this.scaleRatio*this.contentScaleRatio:1;return{transform:`translate(${this.config.styles.x*e}px, ${this.config.styles.y*e}px) rotate(${this.config.styles.rotate}deg)`,width:this.config.styles.width*e+"px",height:this.config.styles.height*e+"px",outline:100/this.scaleRatio*2+"px solid #7190CC"}},scalerStyles(e){const t=L({},e);return t.transform+=` scale(${100/this.scaleRatio})`,t},imgControllerPosHandler(){const e=this.getLayerRotate*Math.PI/180,t={x:this.config.styles.x+this.config.styles.width/2,y:this.config.styles.y+this.config.styles.height/2},i={x:this.config.styles.x-t.x,y:this.config.styles.y-t.y},s=this.getLayerScale,r=c.Z.getNoRotationPos(i,t,-e),n={x:Math.cos(e)*this.getImgX*s-Math.sin(e)*this.getImgY*s+r.x,y:Math.sin(e)*this.getImgX*s+Math.cos(e)*this.getImgY*s+r.y},[a,o]=[this.config.styles.imgWidth*s,this.config.styles.imgHeight*s],h={x:n.x+(a*Math.cos(e)-o*Math.sin(e))/2,y:n.y+(a*Math.sin(e)+o*Math.cos(e))/2},l={x:n.x-h.x,y:n.y-h.y},d=c.Z.getNoRotationPos(l,h,e);return d},moveStart(e){var t;this.pointerId=null!=(t=e.pointerId)?t:-1,this.initialPos=y.Z.getMouseAbsPoint(e),Object.assign(this.initImgPos,{imgX:this.getImgX,imgY:this.getImgY}),l.ZP.addPointerEvent("pointerup",this.moveEnd),l.ZP.addPointerEvent("pointermove",this.moving),this.setCursorStyle("move"),this.setLastSelectedLayerIndex(this.layerIndex)},moving(e){if(this.pointerId!==e.pointerId)return;this.setCursorStyle("move"),e.preventDefault();const t=1/this.getLayerScale,i={x:.5*-this.getImgWidth+this.config.styles.width*t*.5,y:.5*-this.getImgHeight+this.config.styles.height*t*.5},s={width:.5*(this.getImgWidth-this.config.styles.width*t),height:.5*(this.getImgHeight-this.config.styles.height*t)},r=this.$isTouchDevice()?100/this.scaleRatio/this.contentScaleRatio:100/this.scaleRatio,n=y.Z.getMouseRelPoint(e,this.initialPos);n.x=n.x*t*r,n.y=n.y*t*r;const a=g.ZP.getCurrLayer;if(-1!==this.primaryLayerIndex&&"group"===a.type){const e=g.ZP.getCurrLayer.styles.scale;n.x/=e,n.y/=e}const o=this.imgPosMapper(n);Math.abs(o.x-i.x)>s.width&&(o.x=o.x-i.x>0?0:this.config.styles.width*t-this.getImgWidth),Math.abs(o.y-i.y)>s.height&&(o.y=o.y-i.y>0?0:this.config.styles.height*t-this.getImgHeight),this.updateConfig({imgX:o.x,imgY:o.y})},imgPosMapper(e){const t=this.angleInRad;return{x:e.x*Math.cos(t)+e.y*Math.sin(t)+this.initImgPos.imgX,y:-e.x*Math.sin(t)+e.y*Math.cos(t)+this.initImgPos.imgY}},moveEnd(e){this.setCursorStyle("default"),l.ZP.removePointerEvent("pointerup",this.moveEnd),l.ZP.removePointerEvent("pointermove",this.moving)},scaleStart(e){this.initialPos=y.Z.getMouseAbsPoint(e),this.initialWH={width:this.getImgWidth,height:this.getImgHeight};const t=this.$refs.body.getBoundingClientRect();this.center=c.Z.getRectCenter(t),Object.assign(this.initImgPos,{imgX:this.getImgX,imgY:this.getImgY});const i=this.angleInRad,s=y.Z.getMouseRelPoint(e,this.center),r=c.Z.getNoRotationPos(s,this.center,i);this.control.xSign=r.x-this.center.x>0?1:-1,this.control.ySign=r.y-this.center.y>0?1:-1,this.currCursorStyling(e),l.ZP.addPointerEvent("pointerup",this.scaleEnd),l.ZP.addPointerEvent("pointermove",this.scaling)},scaling(e){e.preventDefault();let t=this.getImgWidth,i=this.getImgHeight;const s=g.ZP.getCurrLayer,r=this.angleInRad,n=y.Z.getMouseRelPoint(e,this.initialPos),a=p.ZP.getActualMoveOffset(n.x,n.y,this.$isTouchDevice()?100/this.scaleRatio/this.contentScaleRatio:void 0);if(-1!==this.primaryLayerIndex&&"group"===s.type){const e=s.styles.scale;a.offsetX/=e,a.offsetY/=e}const[o,h]=[a.offsetX/this.getLayerScale,a.offsetY/this.getLayerScale],c=this.control.xSign*(h*Math.sin(r)+o*Math.cos(r)),l=this.control.ySign*(h*Math.cos(r)-o*Math.sin(r));if(0===c||0===l)return;const d=this.initialWH.width,u=this.initialWH.height;(t+c)/d>=(i+l)/u?(t=c+d,i=t*u/d):(i=l+u,t=i*d/u);const f={width:t-d,height:i-u},m={x:this.control.xSign<0?-f.width+this.initImgPos.imgX:this.initImgPos.imgX,y:this.control.ySign<0?-f.height+this.initImgPos.imgY:this.initImgPos.imgY},x={x:-t/2+this.config.styles.width/this.getLayerScale/2,y:-i/2+this.config.styles.height/this.getLayerScale/2},I={width:(t-this.config.styles.width/this.getLayerScale)/2,height:(i-this.config.styles.height/this.getLayerScale)/2},v=t/i;f.width<0&&Math.abs(m.x-x.x)>I.width&&(this.control.xSign<0?(m.x=0,f.width=this.initImgPos.imgX):(s.type,f.width=this.config.styles.width-this.initImgPos.imgX-d),f.height=f.width/v,m.y=this.control.ySign<0?-f.height+this.initImgPos.imgY:this.initImgPos.imgY,i=f.height+u,t=f.width+d,x.x=-t/2+this.config.styles.width/this.getLayerScale/2,x.y=-i/2+this.config.styles.height/this.getLayerScale/2,I.width=(t-this.config.styles.width/this.getLayerScale)/2,I.height=(i-this.config.styles.height/this.getLayerScale)/2),f.height<0&&Math.abs(m.y-x.y)>I.height&&(this.control.ySign<0?(m.y=0,f.height=this.initImgPos.imgY):(s.type,f.height=this.config.styles.height-this.initImgPos.imgY-u),f.width=f.height*v,m.x=this.control.xSign<0?-f.width+this.initImgPos.imgX:this.initImgPos.imgX,i=f.height+u,t=f.width+d),this.updateConfig({imgWidth:t,imgHeight:i,imgX:m.x,imgY:m.y})},scaleEnd(e){this.setCursorStyle("default"),l.ZP.removePointerEvent("pointerup",this.scaleEnd),l.ZP.removePointerEvent("pointermove",this.scaling)},cursorStyles(e,t){const i=t>=0?(e+Math.floor(t/45))%8:(e+Math.ceil(t/45)+8)%8;return{cursor:this.controlPoints.cursors[i]}},setCursorStyle(e){const t=this.$el;t.style.cursor=e,document.body.style.cursor=e},currCursorStyling(e){const t=e.target;this.setCursorStyle(t.style.cursor)},disableTouchEvent(e){this.$isTouchDevice()&&(e.preventDefault(),e.stopPropagation())}})}),$=i(53372);const T=(0,$.Z)(Z,[["render",o],["__scopeId","data-v-7f19aa61"],["__file","NuImgController.vue"]]);var C=T},93293:function(e,t,i){i.r(t),i.d(t,{default:function(){return de}});var s=i(29651),r=i(819),n=i(41463);const a=["data-index","data-p-index","id"],o=["viewBox"],h=["innerHTML"],c={key:0,class:"nu-layer__inProcess"},l=["id"];function d(e,t,i,d,g,p){var y;const u=(0,s.up)("square-loading");return(0,s.wg)(),(0,s.iD)("div",{class:(0,r.C_)(["nu-layer flex-center",[e.inAllPagesMode||e.isLine?"click-disabled":"clickable",e.config.locked||-1!==e.subLayerIndex||e.isSubLayer?"":`nu-layer--p${e.pageIndex}`,"frame"===(null==(y=e.primaryLayer)?void 0:y.type)?"transform-origin-0":""]]),"data-index":"-1"===e.dataIndex?`${e.subLayerIndex}`:e.dataIndex,"data-p-index":e.pageIndex,style:(0,r.j5)(e.layerWrapperStyles),id:`nu-layer_${e.pageIndex}_${e.layerIndex}_${e.subLayerIndex}`,ref:"body"},[(0,s._)("div",{class:(0,r.C_)(["full-size pos-left",{preserve3D:!e.isTouchDevice&&e.isMultipleSelect}]),style:(0,r.j5)(e.layerStyles()),onPointerdown:t[0]||(t[0]=t=>e.onPointerDown(t)),onTap:t[1]||(t[1]=(...t)=>e.dblTap&&e.dblTap(...t)),onContextmenu:[t[2]||(t[2]=(0,n.iM)((()=>{}),["prevent"])),t[3]||(t[3]=(0,n.iM)((t=>e.onRightClick(t)),["right","stop"]))],onDragenter:t[4]||(t[4]=t=>e.dragEnter(t)),onDblclick:t[5]||(t[5]=t=>e.dblClick(t))},[(0,s._)("div",{class:(0,r.C_)(["nu-layer__scale full-size pos-left",{preserve3D:!e.isTouchDevice&&e.isMultipleSelect}]),ref:"scale",style:(0,r.j5)(e.scaleStyles())},[(0,s._)("div",{class:(0,r.C_)(["nu-layer__flip full-size",{preserve3D:!e.isTouchDevice&&e.isMultipleSelect}]),style:(0,r.j5)(e.flipStyles)},[((0,s.wg)(),(0,s.j4)((0,s.LL)(`nu-${e.config.type}`),{class:(0,r.C_)(["transition-none",{preserve3D:!e.isTouchDevice&&e.isMultipleSelect}]),config:e.config,imgControl:e.imgControl,contentScaleRatio:e.contentScaleRatio,pageIndex:e.pageIndex,layerIndex:e.layerIndex,subLayerIndex:e.subLayerIndex,page:e.page,primaryLayer:e.primaryLayer,forRender:e.forRender,inPreview:e.inPreview},null,8,["class","config","imgControl","contentScaleRatio","pageIndex","layerIndex","subLayerIndex","page","primaryLayer","forRender","inPreview"])),e.showSvgContour?((0,s.wg)(),(0,s.iD)("svg",{key:0,class:"clip-contour full-size",viewBox:`0 0 ${e.config.styles.initWidth} ${e.config.styles.initHeight}`},[(0,s._)("g",{innerHTML:e.frameClipFormatter(e.config.clipPath),style:(0,r.j5)(e.frameClipStyles)},null,12,h)],8,o)):(0,s.kq)("",!0)],6)],6),e.showSpinner?((0,s.wg)(),(0,s.iD)("div",c,[(0,s.Wm)(u)])):(0,s.kq)("",!0)],38),e.isLine?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,r.C_)(["nu-layer__line-mover",[e.inAllPagesMode?"click-disabled":"clickable"]]),style:(0,r.j5)(e.lineMoverStyles()),ref:"lineMover",id:e.inPreview?"":`nu-layer__line-mover_${e.pageIndex}_${e.layerIndex}_${e.subLayerIndex}`,onContextmenu:[t[6]||(t[6]=(0,n.iM)((()=>{}),["prevent"])),t[7]||(t[7]=(0,n.iM)((t=>e.onRightClick(t)),["right","stop"]))]},null,46,l)):(0,s.kq)("",!0)],14,a)}const g=e=>((0,s.dD)("data-v-187a9a7c"),e=e(),(0,s.Cn)(),e),p=g((()=>(0,s._)("div",null,null,-1))),y=g((()=>(0,s._)("div",null,null,-1))),u=g((()=>(0,s._)("div",null,null,-1))),f=g((()=>(0,s._)("div",null,null,-1))),m=g((()=>(0,s._)("div",null,null,-1))),x=g((()=>(0,s._)("div",null,null,-1))),I=g((()=>(0,s._)("div",null,null,-1))),v=g((()=>(0,s._)("div",null,null,-1))),S=g((()=>(0,s._)("div",null,null,-1))),w=[p,y,u,f,m,x,I,v,S];function b(e,t,i,n,a,o){return(0,s.wg)(),(0,s.iD)("div",{class:"flip-to-square-random",style:(0,r.j5)(e.styles)},w,4)}var L=(0,s.aZ)({emits:[],props:{size:{type:Number,default:120}},computed:{styles(){return{width:`${this.size}px`,height:`${this.size}px`}}}}),P=i(53372);const Z=(0,P.Z)(L,[["render",b],["__scopeId","data-v-187a9a7c"],["__file","SqureLoading.vue"]]);var $=Z,T=i(37934),C=i(23931),M=i(865),D=i(6400),_=i(40881),E=i(71446),O=i(3716),R=i(49901),F=i(2531),j=i(62013),k=i(78871),z=i(70118),H=i(3162),N=i(75231),A=i(50543),W=i(26378),B=i(32905),q=i(53556),Y=i(15820),U=i(52632),X=i(15789),K=i(44306),G=i(50559),V=i(89194),Q=i.n(V),J=i(38058),ee=Object.defineProperty,te=Object.defineProperties,ie=Object.getOwnPropertyDescriptors,se=Object.getOwnPropertySymbols,re=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable,ae=(e,t,i)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,oe=(e,t)=>{for(var i in t||(t={}))re.call(t,i)&&ae(e,i,t[i]);if(se)for(var i of se(t))ne.call(t,i)&&ae(e,i,t[i]);return e},he=(e,t)=>te(e,ie(t)),ce=(0,s.aZ)({emits:["onSubDrop"],components:{SquareLoading:$,LazyLoad:T.Z},props:{config:{type:Object,required:!0},pageIndex:{type:Number,required:!0},page:{type:Object,required:!0},layerIndex:{type:Number,required:!0},subLayerIndex:{type:Number,default:-1},imgControl:{type:Boolean},snapUtils:Object,primaryLayer:{type:Object,default:void 0},isSubLayer:{type:Boolean,default:!1},inFrame:{type:Boolean,default:!1},contentScaleRatio:{default:1,type:Number},dataIndex:{default:"-1",type:String},forRender:{default:!1,type:Boolean},inPreview:{default:!1,type:Boolean}},data(){return{initPos:{x:0,y:0},dragUtils:this.isSubLayer?new R.Z(N.ZP.getLayer(this.pageIndex,this.layerIndex).id,this.config.id):new R.Z(this.config.id),movingUtils:null,imgBuff:{},hasHandledFrameMouseEnter:!1}},mounted(){const e=this.$refs.body,t=this.$refs.lineMover,i=this.$props,s={};Object.defineProperties(s,{pageIndex:{get(){return i.pageIndex}},layerIndex:{get(){return i.layerIndex}},subLayerIdx:{get(){return i.subLayerIndex}}});const r={config:this.config};Object.defineProperty(r,"config",{get(){return i.config}});const n={_config:r,component:this,snapUtils:this.snapUtils,layerInfo:s,body:e};if(-1===this.subLayerIndex){this.movingUtils=new W.U(n);const i=this.movingUtils.moveStart.bind(this.movingUtils);this.isLine?t.addEventListener("pointerdown",i):e.addEventListener("pointerdown",i)}else{Object.defineProperty(r,"primaryLayer",{get(){return i.primaryLayer}});const s=new X.Z(n),a=s.onPointerdown.bind(s);this.isLine?t.addEventListener("pointerdown",a):e.addEventListener("pointerdown",a)}this.primaryLayer&&this.primaryLayer.type===D.F5.frame&&this.config.type===D.F5.image&&e.addEventListener(this.$isTouchDevice()?"pointermove":"mousemove",this.onFrameMouseMove)},unmounted(){this.movingUtils&&this.movingUtils.removeListener()},computed:he(oe(oe(oe(oe(oe(oe(oe(oe({},(0,J.rn)("text",["sel","props"])),(0,J.rn)("shadow",["processId","handleId","uploadId"])),(0,J.rn)(["isMoving","currDraggedPhoto"])),(0,J.rn)("mobileEditor",{mobilePagePreview:"mobileAllPageMode",isPinchingEditor:"isPinchingEditor"})),(0,J.rn)("imgControl",{imgCtrlConfig:"image"})),(0,J.Se)("imgControl",["isBgImgCtrl","isImgCtrl"])),(0,J.Se)("text",["getDefaultFonts"])),(0,J.Se)({lastSelectedLayerIndex:"getLastSelectedLayerIndex",currSubSelectedInfo:"getCurrSubSelectedInfo",currHoveredPageIndex:"getCurrHoveredPageIndex",isProcessImgShadow:"shadow/isProcessing",currSelectedInfo:"getCurrSelectedInfo",scaleRatio:"getPageScaleRatio",currFunctionPanelType:"getCurrFunctionPanelType",isUploadingShadowImg:"shadow/isUploading",isHandling:"shadow/isHandling",isShowPagePanel:"page/getShowPagePanel",isHandleShadow:"shadow/isHandling",renderForPDF:"user/getRenderForPDF",useMobileEditor:"getUseMobileEditor",showPcPagePreivew:"page/getIsShowPagePreview"})),{inAllPagesMode(){return this.mobilePagePreview||this.showPcPagePreivew},flipStyles(){if(this.config.type===D.F5.image)return{};const{horizontalFlip:e,verticalFlip:t}=this.config.styles;let i="";return e&&(i+="scaleX(-1)"),t&&(i+="scaleY(-1)"),i?{transform:i}:{}},layerWrapperStyles(){var e,t;const i=this.forRender||!this.config.clipPath||this.config.isFrameImg||"frame"!==(null==(e=this.primaryLayer)?void 0:e.type)?"":`path('${new(Q())(this.config.clipPath).scale(this.contentScaleRatio).toString()}')`,s=this.getPointerEvents,r=this.outlineStyles(),n=this.contentScaleRatio*(this.$isTouchDevice()?.01*this.scaleRatio:1),a=Object.assign(E.Z.convertDefaultStyle(this.config.styles,B.Z._3dEnabledPageIndex!==this.pageIndex,n),oe({outline:r,outlineOffset:`-${100/this.scaleRatio*1*this.contentScaleRatio}px`,willChange:this.config.active&&!this.isSubLayer?"transform":"",pointerEvents:s,clipPath:i,"mix-blend-mode":this.config.styles.blendMode},this.transformStyle));return"frame"===(null==(t=this.primaryLayer)?void 0:t.type)&&"image"===this.config.type&&(this.$isTouchDevice()&&(a.transform+=`scale(${this.$store.state.pageScaleRatio/100})`),a.width=this.config.styles.width*n+"px",a.height=this.config.styles.height*n+"px"),this.isImgCtrl||this.inFrame||this.$isTouchDevice()||this.useMobileEditor||(a.transform+=`translateZ(${this.config.styles.zindex}px)`),a},showSpinner(){const{config:e}=this,t=this.config.styles.shadow,i=t&&t.srcObj&&t.srcObj.type&&"upload"!==t.srcObj.type,s="imgShadow"===e.inProcess&&!i,r="bgRemove"===e.inProcess;return r||s},transformStyle(){return{transformStyle:this.enalble3dTransform?"preserve-3d":"initial"}},enalble3dTransform(){return this.pageIndex===B.Z._3dEnabledPageIndex},getLayerType(){return this.config.type},isLine(){return Y.Z.isLine(this.config)},frameClipStyles(){var e,t;"image"===this.config.type&&j.Z.checkIsRect(this.config.clipPath);return he(oe({},"frame"===(null==(e=this.primaryLayer)?void 0:e.type)&&"image"===this.config.type&&this.$isTouchDevice()&&{transform:`scale(${100/this.scaleRatio})`}),{fill:"#00000000",stroke:(null==(t=this.config)?void 0:t.active)?this.config.isFrameImg?"#F10994":"#7190CC":"none",strokeWidth:7/this.primaryLayer.styles.scale*(100/this.scaleRatio)+"px"})},getPointerEvents(){var e;const{isControlling:t}=null!=(e=this.movingUtils)?e:{};switch(this.config.type){case D.F5.image:return t?"none":"";case D.F5.shape:if(this.primaryLayer&&this.primaryLayer.type===D.F5.frame)return"none"}return""},isOk2HandleFrameMouseEnter(){var e;return this.config.type===D.F5.image&&(null==(e=this.primaryLayer)?void 0:e.type)===D.F5.frame&&(!(this.primaryLayer?this.primaryLayer:this.config).locked&&((N.ZP.layerIndex===this.layerIndex||!H.Z.isImgControl())&&(N.ZP.getCurrLayer.id!==this.uploadId.layerId&&(N.ZP.getCurrLayer.type===D.F5.image&&this.isMoving))))},isTouchDevice(){return k.Z.isTouchDevice()},isMultipleSelect(){return this.currSelectedInfo.layers.length>1},showSvgContour(){const{config:e}=this;return e.active&&e.isFrame&&!e.isFrameImg&&"image"===e.type&&!this.forRender&&!j.Z.checkIsRect(this.config.clipPath)}}),methods:he(oe({},(0,J.OI)({setLastSelectedLayerIndex:"SET_lastSelectedLayerIndex",setIsLayerDropdownsOpened:"SET_isLayerDropdownsOpened",setCurrSidebarPanel:"SET_currSidebarPanelType",setMoving:"SET_moving",setImgConfig:"imgControl/SET_CONFIG",setBgConfig:"imgControl/SET_BG_CONFIG",setCurrDraggedPhoto:"SET_currDraggedPhoto"})),{frameClipFormatter(e){return j.Z.frameClipFormatter(e)},layerStyles(){switch(this.config.type){case D.F5.shape:return oe({},Y.Z.isLine(this.config)?{pointerEvents:"none"}:{})}},lineMoverStyles(){var e;if(!this.isLine)return{};const{x:t,y:i,width:s,height:r,rotate:n}=_.Z.getControllerStyleParameters(this.config.point,this.config.styles,this.isLine,this.$isTouchDevice(),null==(e=this.config.size)?void 0:e[0]),{x:a,y:o}=this.config.styles,h=this.page,{bleeds:c}=B.Z.getPageSizeWithBleeds(h);let l=`translate(${((h.isEnableBleed?t+c.left:t)-a)*this.contentScaleRatio}px, ${((h.isEnableBleed?i+c.top:i)-o)*this.contentScaleRatio}px)`;return n&&(l+=` rotate(${n}deg)`),{transform:l,width:s*this.contentScaleRatio+"px",height:r*this.contentScaleRatio+"px"}},outlineStyles(){return this.primaryLayer&&"tmp"===this.primaryLayer.type?100/this.scaleRatio*2*this.contentScaleRatio+"px solid #7190CC":""},scaleStyles(){const{scale:e,scaleX:t,scaleY:i,zindex:s}=this.config.styles,{type:r}=this.config,n=r===D.F5.image||r===D.F5.frame&&j.Z.isImageFrame(this.config),a=oe({},B.Z._3dEnabledPageIndex===this.pageIndex&&{transformStyle:"group"===r||this.config.isFrame||"tmp"===r&&s>0?"flat":"preserve-3d"});if(!n){const s=this.contentScaleRatio*(this.$isTouchDevice()?.01*this.scaleRatio:1),n=`scale(${e*("text"===r?s:1)}) ${1!==t?`scaleX(${t})`:""} ${1!==i?`scaleY(${i})`:""}`;"scale(1)"!==n&&(this.config.type===D.F5.text?(a.width=this.config.styles.width/this.config.styles.scale+"px",a.height=this.config.styles.height/this.config.styles.scale+"px"):(a.width=this.config.styles.initWidth*s+"px",a.height=this.config.styles.initHeight*s+"px"),a.transform=n)}return a},isLocked(){return this.config.locked},onRightClick(e){if(this.$isTouchDevice())return void e.preventDefault();const t=N.ZP.layerIndex===this.layerIndex?N.ZP.subLayerIdx:-1;this.currSelectedInfo.pageIndex===this.pageIndex&&this.currSelectedInfo.index===this.layerIndex||(z.Z.deselect(),z.Z.select(this.pageIndex,[this.layerIndex])),"frame"===this.getLayerType&&j.Z.updateFrameLayerProps(this.pageIndex,this.layerIndex,t,{active:!0}),this.$nextTick((()=>{q.Z.openPopup("layer",{event:e,layerIndex:this.layerIndex})}))},dblTap(e){O.Z.click(e,{doubleClickCallback:()=>{this.getLayerType===D.F5.image&&(N.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{imgControl:!0}),F.ZP.emit(F.rZ.switchTab,"crop"))}})},onPointerDown(e){if(this.isPinchingEditor)return;const t=e.target;this.isImgCtrl&&!["IMG","path","image"].includes(t.tagName)&&H.Z.setImgControlDefault(),this.initPos.x=this.config.styles.x,this.initPos.y=this.config.styles.y},dblClick(e){if(e.stopPropagation(),this.isPinchingEditor)return;const t=-1!==this.subLayerIndex;if(t){if(!this.primaryLayer||this.isHandleShadow)return;let e,t=null;switch(this.primaryLayer.type){case D.F5.group:if(e=this.primaryLayer.layers[this.subLayerIndex],t=N.ZP.updateSubLayerProps,!e.active)return;break;case D.F5.frame:if(e=this.primaryLayer.clips[this.subLayerIndex],t=j.Z.updateFrameLayerProps,!e.active||"frame"===e.srcObj.type)return;break;default:return}e.type!==D.F5.image||e.inProcess||t(this.pageIndex,this.layerIndex,this.subLayerIndex,{imgControl:!0})}else{if("image"!==this.getLayerType||this.isLocked())return;switch(this.currSelectedInfo.index<0&&z.Z.select(this.pageIndex,[this.layerIndex]),this.getLayerType){case D.F5.image:{const{shadow:e}=this.config.styles,t=e.currentEffect===M.w.imageMatched||e.isTransparent;this.isHandleShadow&&t||_.Z.updateLayerProps(this.pageIndex,this.layerIndex,{imgControl:!0})}}}},onFrameMouseMove(e){!this.hasHandledFrameMouseEnter&&this.isOk2HandleFrameMouseEnter&&(this.hasHandledFrameMouseEnter=!0,this.handleFrameMouseEnter(e))},handleFrameMouseEnter(e){var t;e.stopPropagation();const i=N.ZP.getCurrLayer;if(i&&i.type===D.F5.image&&this.isMoving){const{srcObj:e,previewSrc:s}=this.config,r=k.Z.deepCopy(null==(t=this.primaryLayer)?void 0:t.clips),n=r[this.subLayerIndex];Object.assign(this.imgBuff,{srcObj:oe({},e),previewSrc:s,styles:{imgX:n.styles.imgX,imgY:n.styles.imgY,imgWidth:n.styles.imgWidth,imgHeight:n.styles.imgHeight,adjust:n.styles.adjust}}),j.Z.updateFrameLayerProps(this.pageIndex,this.layerIndex,this.subLayerIndex,oe({srcObj:oe({},i.srcObj)},i.previewSrc&&{previewSrc:i.previewSrc})),N.ZP.updateLayerStyles(N.ZP.pageIndex,N.ZP.layerIndex,{opacity:35}),N.ZP.updateLayerProps(N.ZP.pageIndex,N.ZP.layerIndex,{isHoveringFrame:!0});const{imgWidth:a,imgHeight:o,imgX:h,imgY:c}=A.Z.clipperHandler(N.ZP.getCurrLayer,n.clipPath,n.styles).styles;j.Z.updateFrameLayerStyles(this.pageIndex,this.layerIndex,this.subLayerIndex,{adjust:oe({},i.styles.adjust),imgWidth:a,imgHeight:o,imgX:h,imgY:c});const l=this.$refs.body;l.addEventListener(this.$isTouchDevice()?"pointerleave":"mouseleave",this.onFrameMouseLeave),l.addEventListener(this.$isTouchDevice()?"pointerup":"mouseup",this.onFrameMouseUp)}},onFrameMouseLeave(e){var t;if(this.hasHandledFrameMouseEnter=!1,""!==this.currDraggedPhoto.srcObj.type)return;if(this.config.type!==D.F5.image||(null==(t=this.primaryLayer)?void 0:t.type)!==D.F5.frame)return;e.stopPropagation();const i=N.ZP.getCurrLayer;i&&i.type===D.F5.image&&this.isMoving&&(N.ZP.updateLayerStyles(N.ZP.pageIndex,N.ZP.layerIndex,{opacity:100}),N.ZP.updateLayerProps(N.ZP.pageIndex,N.ZP.layerIndex,{isHoveringFrame:!1}),j.Z.updateFrameLayerProps(this.pageIndex,this.layerIndex,this.subLayerIndex,{srcObj:oe({},this.imgBuff.srcObj)}),j.Z.updateFrameLayerStyles(this.pageIndex,this.layerIndex,this.subLayerIndex,oe({},this.imgBuff.styles)));const s=this.$refs.body;s.removeEventListener(this.$isTouchDevice()?"pointerleave":"mouseleave",this.onFrameMouseLeave),s.removeEventListener(this.$isTouchDevice()?"pointerup":"mouseup",this.onFrameMouseUp)},onFrameMouseUp(e){if(this.hasHandledFrameMouseEnter=!1,""!==this.currDraggedPhoto.srcObj.type)return;const t=N.ZP.getCurrLayer;if(t&&t.type===D.F5.image){N.ZP.deleteLayer(N.ZP.pageIndex,N.ZP.layerIndex);const e=this.layerIndex>N.ZP.layerIndex?this.layerIndex-1:this.layerIndex;z.Z.set(this.pageIndex,e,[this.primaryLayer]),j.Z.updateFrameLayerProps(this.pageIndex,e,this.subLayerIndex,{active:!0}),U.Z.record()}const i=this.$refs.body;i.removeEventListener(this.$isTouchDevice()?"pointerup":"mouseup",this.onFrameMouseUp),i.removeEventListener(this.$isTouchDevice()?"pointerleave":"mouseleave",this.onFrameMouseLeave)},dragEnter(e){if(this.primaryLayer&&this.primaryLayer.type)return this.onFrameDragEnter(e);this.onLayerDragEnter(e)},onFrameDragEnter(e){var t;if(!e.target||!["IMG","image"].includes(e.target.tagName))return;if(this.config.type!==D.F5.image||(null==(t=N.ZP.getLayer(this.pageIndex,this.layerIndex))?void 0:t.type)!==D.F5.frame)return;const{primaryLayer:i}=this;if(i&&!i.locked){const t=this.$refs.body;if(t.addEventListener("dragleave",this.onFrameDragLeave),t.addEventListener("drop",this.onFrameDrop),e.stopPropagation(),""!==this.currDraggedPhoto.srcObj.type&&!this.currDraggedPhoto.isPreview){const e=k.Z.deepCopy(i.clips),t=e[this.subLayerIndex];Object.assign(this.imgBuff,{srcObj:oe({},e[this.subLayerIndex].srcObj),previewSrc:e[this.subLayerIndex].previewSrc,styles:{imgX:t.styles.imgX,imgY:t.styles.imgY,imgWidth:t.styles.imgWidth,imgHeight:t.styles.imgHeight,adjust:t.styles.adjust}}),j.Z.updateFrameClipSrc(this.pageIndex,this.layerIndex,this.subLayerIndex,this.currDraggedPhoto.srcObj),j.Z.updateFrameLayerProps(this.pageIndex,this.layerIndex,this.subLayerIndex,{previewSrc:this.currDraggedPhoto.previewSrc}),Object.assign(t.srcObj,this.currDraggedPhoto.srcObj);const{imgWidth:s,imgHeight:r,imgX:n,imgY:a}=A.Z.clipperHandler(this.currDraggedPhoto,t.clipPath,t.styles).styles;j.Z.updateFrameLayerStyles(this.pageIndex,this.layerIndex,this.subLayerIndex,{imgWidth:s,imgHeight:r,imgX:n,imgY:a})}}},onFrameDragLeave(e){if(!e.target||!["IMG","image"].includes(e.target.tagName))return;e.stopPropagation();const t=this.$refs.body;t.removeEventListener("dragleave",this.onFrameDragLeave),t.removeEventListener("drop",this.onFrameDrop);const i=this.primaryLayer;""===this.currDraggedPhoto.srcObj.type||i.locked||(j.Z.updateFrameClipSrc(this.pageIndex,this.layerIndex,this.subLayerIndex,this.imgBuff.srcObj),j.Z.updateFrameLayerStyles(this.pageIndex,this.layerIndex,this.subLayerIndex,this.imgBuff.styles),j.Z.updateFrameLayerProps(this.pageIndex,this.layerIndex,this.subLayerIndex,{previewSrc:this.imgBuff.previewSrc}))},onFrameDrop(e){var t;e.stopPropagation();const i=this.$refs.body;i.removeEventListener("dragleave",this.onFrameDragLeave),i.removeEventListener("drop",this.onFrameDrop),U.Z.record(),this.setCurrDraggedPhoto({srcObj:{type:"",assetId:"",userId:""}}),(null==(t=this.primaryLayer)?void 0:t.locked)&&this.$emit("onSubDrop",{e:e})},onLayerDragEnter(e){var t,i;if(!e.target||!["IMG","image"].includes(e.target.tagName))return;const s=this.$refs.body,r=this.$store.state.currDraggedPhoto.srcObj;if("image"===this.getLayerType&&r.assetId!==this.config.srcObj.assetId){s.addEventListener("dragleave",this.layerDragLeave),s.addEventListener("drop",this.layerOnDrop);const r=this.config.styles.shadow,n=r.isTransparent||r.currentEffect===M.w.imageMatched,a=r&&r.srcObj&&(null==(t=r.srcObj)?void 0:t.type)&&"upload"!==(null==(i=r.srcObj)?void 0:i.type),o="imgShadow"===this.config.inProcess&&!a;o||this.isHandleShadow&&(this.handleId.layerId===this.config.id||n)?((0,G.h4)({group:"copy",text:`${C.Z.global.t("NN0665")}`}),s.removeEventListener("dragleave",this.layerDragLeave),s.removeEventListener("drop",this.layerOnDrop)):this.dragUtils.onImageDragEnter(e,this.pageIndex,this.config)}},layerDragLeave(e){if(!e.target||!["IMG","image"].includes(e.target.tagName))return;const t=this.$refs.body;t.removeEventListener("dragleave",this.layerDragLeave),t.removeEventListener("drop",this.layerOnDrop),"image"===this.getLayerType&&this.dragUtils.onImageDragLeave(e,this.pageIndex)},layerOnDrop(e){var t;e.stopPropagation();const i=this.$refs.body;i.removeEventListener("dragleave",this.layerDragLeave),i.removeEventListener("drop",this.layerOnDrop);const s=e.dataTransfer;if(null==(t=e.dataTransfer)?void 0:t.getData("data"))this.currDraggedPhoto.srcObj.type&&"image"===this.getLayerType||this.dragUtils.itemOnDrop(e,this.pageIndex);else if(s&&0!==s.files.length){const e=s.files;this.setCurrSidebarPanel(D.iI.file),K.Z.uploadAsset("image",e,{addToPage:!0})}}})});const le=(0,P.Z)(ce,[["render",d],["__scopeId","data-v-3cb6219d"],["__file","NuLayer.vue"]]);var de=le},50658:function(e,t,i){i.r(t),i.d(t,{default:function(){return re}});var s=i(29651),r=i(819);const n=["viewBox"],a=["innerHTML"],o=["id","innerHTML"],h=["id"],c=["xlink:href"],l={key:1},d=["xlink:href","clip-path"],g=["filter","innerHTML"];function p(e,t,i,p,y,u){return(0,s.wg)(),(0,s.iD)("div",{class:"nu-shape",style:(0,r.j5)(e.styles)},[((0,s.wg)(),(0,s.iD)("svg",{viewBox:e.viewBoxFormatter,preserveAspectRatio:"none"},["E"===e.config.category?((0,s.wg)(),(0,s.iD)("defs",{key:0,innerHTML:e.svgFormatter},null,8,a)):(0,s.kq)("",!0),(0,s._)("defs",null,["C"===e.config.category?((0,s.wg)(),(0,s.iD)("filter",{key:0,id:e.className(),innerHTML:e.filterFormatter},null,8,o)):(0,s.kq)("",!0),"E"===e.config.category?((0,s.wg)(),(0,s.iD)("clipPath",{key:1,id:e.clipPathId()},[(0,s._)("use",{"xlink:href":e.svgId()},null,8,c)],8,h)):(0,s.kq)("",!0)]),"E"===e.config.category?((0,s.wg)(),(0,s.iD)("g",l,[(0,s._)("use",{"xlink:href":e.svgId(),"clip-path":"url(#"+e.clipPathId()+")",style:(0,r.j5)(e.styleTextContent[0])},null,12,d)])):((0,s.wg)(),(0,s.iD)("g",{key:2,filter:"C"===e.config.category?e.filterId():"none",innerHTML:e.svgFormatter},null,8,g))],8,n))],4)}var y=i(75231),u=i(15820),f=i(52632),m=i(28339),x=Object.defineProperty,I=Object.getOwnPropertySymbols,v=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,w=(e,t,i)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,b=(e,t)=>{for(var i in t||(t={}))v.call(t,i)&&w(e,i,t[i]);if(I)for(var i of I(t))S.call(t,i)&&w(e,i,t[i]);return e},L=(e,t,i)=>new Promise(((s,r)=>{var n=e=>{try{o(i.next(e))}catch(t){r(t)}},a=e=>{try{o(i.throw(e))}catch(t){r(t)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,a);o((i=i.apply(e,t)).next())}));const P="$fx",Z="$fy",$="$fextx",T="$fexty",C="$fcx",M="$fcy",D="$ofstx",_="$ofsty",E="$fsize",O="$fextsize",R="$vbwd",F="$vbht",j="rgb_",k="rgba_",z="alpha_",H="alpham_",N="m_",A=8,W=[new RegExp(`\\${P}0`,"g"),new RegExp(`\\${P}1`,"g")],B=[new RegExp(`\\${Z}0`,"g"),new RegExp(`\\${Z}1`,"g")],q=[new RegExp(`\\${$}0`,"g"),new RegExp(`\\${$}1`,"g")],Y=[new RegExp(`\\${T}0`,"g"),new RegExp(`\\${T}1`,"g")],U=[new RegExp(`\\${D}0`,"g"),new RegExp(`\\${D}1`,"g")],X=[new RegExp(`\\${_}0`,"g"),new RegExp(`\\${_}1`,"g")],K=new RegExp(`\\${E}`,"g"),G=new RegExp(`\\${O}`,"g"),V=new RegExp(`\\${R}`,"g"),Q=new RegExp(`\\${F}`,"g"),J=new RegExp(`\\${C}`,"g"),ee=new RegExp(`\\${M}`,"g");var te=(0,s.aZ)({emits:[],props:{config:{type:Object,required:!0},pageIndex:{type:Number,required:!0},layerIndex:{type:Number,required:!0},subLayerIndex:{type:Number},contentScaleRatio:{type:Number,default:1}},data(){return{filterTemplate:"",paramsReady:!1,styleTextContent:[],transTextContent:[]}},created(){return L(this,null,(function*(){yield this.checkAndFetchSvg()}))},watch:{"config.color":{handler:function(e){if(this.config.color&&this.config.color.length){const t=u.Z.styleFormatter(this.className(),this.config.styleArray,e,this.config.size,this.config.dasharray,this.config.linecap,this.config.filled);this.updateStyleNode(t)}},deep:!0},"config.pDiff":{handler:function(e){var t;if("C"===this.config.category){const i=u.Z.transFormatter(this.className(),null!=(t=this.config.transArray)?t:[],{cSize:this.config.cSize,pSize:this.config.pSize,pDiff:e});this.updateTransNode(i)}},deep:!0},"config.point":{handler:function(e){var t;if("D"===this.config.category){const i=u.Z.markerTransFormatter(this.className(),null!=(t=this.config.markerTransArray)?t:[],this.config.size,e,this.config.markerWidth);this.updateTransNode(i),Object.assign(this.config.styles,u.Z.updatedDimensions(this.config.point,this.config.size[0],this.config.styles))}},deep:!0},"config.size":{handler:function(e){var t;if("D"===this.config.category){const i=u.Z.markerTransFormatter(this.className(),null!=(t=this.config.markerTransArray)?t:[],e,this.config.point,this.config.markerWidth);this.updateTransNode(i),Object.assign(this.config.styles,u.Z.updatedDimensions(this.config.point,e[0],this.config.styles))}const i=u.Z.styleFormatter(this.className(),this.config.styleArray,this.config.color,e,this.config.dasharray,this.config.linecap,this.config.filled);this.updateStyleNode(i)},deep:!0},"config.dasharray":{handler:function(e){const t=u.Z.styleFormatter(this.className(),this.config.styleArray,this.config.color,this.config.size,e,this.config.linecap,this.config.filled);this.updateStyleNode(t)},deep:!0},"config.linecap":{handler:function(e){const t=u.Z.styleFormatter(this.className(),this.config.styleArray,this.config.color,this.config.size,this.config.dasharray,e,this.config.filled);this.updateStyleNode(t)}},"config.filled":{handler:function(e){const t=u.Z.styleFormatter(this.className(),this.config.styleArray,this.config.color,this.config.size,this.config.dasharray,this.config.linecap,e);this.updateStyleNode(t)}},"config.markerId":{handler:function(e){var t;if("D"===this.config.category){const e=u.Z.markerTransFormatter(this.className(),null!=(t=this.config.markerTransArray)?t:[],this.config.size,this.config.point,this.config.markerWidth);this.updateTransNode(e)}const i=u.Z.styleFormatter(this.className(),this.config.styleArray,this.config.color,this.config.size,this.config.dasharray,this.config.linecap,this.config.filled);this.updateStyleNode(i)},deep:!0},"config.vSize":{handler:function(e){"E"===this.config.category&&Object.assign(this.config.styles,{width:e[0],height:e[1],initWidth:e[0],initHeight:e[1]})},deep:!0},"config.svg":{handler:function(e){e||(this.paramsReady=!1,this.checkAndFetchSvg(!1))}}},computed:{viewBoxFormatter(){return this.paramsReady?"D"===this.config.category?u.Z.lineViewBoxFormatter(this.config.point,this.config.size[0]):`0 0 ${this.config.vSize[0]+this.config.pDiff[0]} ${this.config.vSize[1]+this.config.pDiff[1]}`:"0 0 0 0"},svgFormatter(){if(this.paramsReady){const e="D"===this.config.category?u.Z.pointPreprocess(this.config.point,this.config.markerWidth,this.config.trimWidth,this.config.size[0],this.config.linecap,this.config.trimOffset):this.config.point,t="E"===this.config.category?u.Z.svgParameters(this.config.shapeType,this.config.vSize,this.config.size):[];return u.Z.svgFormatter(this.config.svg,this.className(),this.styleTextContent,this.transTextContent,e,t,this.config.pDiff)}return""},filterFormatter(){let e=Math.ceil((400*this.config.ratio/(this.$store.getters.getPageScaleRatio*this.config.styles.scale)-1)/2);if(e<1?e=1:e>20&&(e=20),"C"===this.config.category){const t=Math.floor(this.config.cSize[0]+(this.config.pSize[0]+this.config.pDiff[0])/2)-e-A,i=Math.floor(this.config.cSize[1]+(this.config.pSize[1]+this.config.pDiff[1])/2)-e-A,s=2*e+1,r=s.toString(),n=(s+2*A).toString(),a=[Math.floor(this.config.cSize[0])-e,Math.floor(this.config.cSize[0]+this.config.pSize[0]+this.config.pDiff[0])-e],o=[Math.floor(this.config.cSize[1])-e,Math.floor(this.config.cSize[1]+this.config.pSize[1]+this.config.pDiff[1])-e],h=[a[0]-A,a[1]-A],c=[o[0]-A,o[1]-A];let l=this.filterTemplate;switch(this.config.scaleType){case 1:return l=l.replace(W[0],a[0].toString()),l=l.replace(W[1],a[1].toString()),l=l.replace(B[0],o[0].toString()),l=l.replace(B[1],o[1].toString()),l=l.replace(V,(this.config.vSize[0]+this.config.pDiff[0]).toString()),l=l.replace(Q,(this.config.vSize[1]+this.config.pDiff[1]).toString()),l=l.replace(K,r),l=l.replace(G,n),l=l.replace(J,t.toString()),l=l.replace(ee,i.toString()),l=l.replace(q[0],h[0].toString()),l=l.replace(q[1],h[1].toString()),l=l.replace(Y[0],c[0].toString()),l=l.replace(Y[1],c[1].toString()),l=l.replace(U[0],(h[0]-t).toString()),l=l.replace(U[1],(h[1]-t).toString()),l=l.replace(X[0],(c[0]-i).toString()),l=l.replace(X[1],(c[1]-i).toString()),l;case 2:return l=l.replace(W[0],a[0].toString()),l=l.replace(W[1],a[1].toString()),l=l.replace(Q,this.config.vSize[1]),l=l.replace(K,r),l=l.replace(G,n),l=l.replace(J,t.toString()),l=l.replace(q[0],h[0].toString()),l=l.replace(q[1],h[1].toString()),l=l.replace(U[0],(h[0]-t).toString()),l=l.replace(U[1],(h[1]-t).toString()),l;case 3:return l=l.replace(B[0],o[0].toString()),l=l.replace(B[1],o[1].toString()),l=l.replace(V,this.config.vSize[0]),l=l.replace(K,r),l=l.replace(G,n),l=l.replace(ee,i.toString()),l=l.replace(Y[0],c[0].toString()),l=l.replace(Y[1],c[1].toString()),l=l.replace(X[0],(c[0]-i).toString()),l=l.replace(X[1],(c[1]-i).toString()),l}}return""},styles(){if(this.paramsReady){const e=this.contentScaleRatio*(this.$isTouchDevice()?.01*this.$store.state.pageScaleRatio:1);return b(b({width:("D"===this.config.category?this.config.styles.initWidth:this.config.vSize[0]+this.config.pDiff[0])*e+"px",height:`${"D"===this.config.category?this.config.styles.initHeight:(this.config.vSize[1]+this.config.pDiff[1])*e}px`},this.config.wkf&&"/preview"===(0,m.yj)().path&&{"-webkit-filter":"opacity(1)"}),u.Z.isLine(this.config)?{pointerEvents:"none"}:{})}return b({width:"0px",height:"0px"},u.Z.isLine(this.config)?{pointerEvents:"none"}:{})}},methods:{className(){return this.config.className+this.pageIndex.toString()},filterId(){return"C"===this.config.category?`url(#${this.className()})`:"none"},svgId(){return`#${this.className()}SVG`},clipPathId(){return`${this.className()}C`},updateStyleNode(e){this.styleTextContent=e},updateTransNode(e){this.transTextContent=e},checkAndFetchSvg(e=!0){return L(this,null,(function*(){const t=e?this.config.svg:void 0;let i=null,s=!1;const r=this.config;if(!["D","E"].includes(r.category)&&this.config.designId)if(i=yield u.Z.fetchSvg(this.config),r.color&&i.color){if(r.color.length>i.color.length){const e=[...r.color].slice(0,i.color.length);y.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{color:e},this.subLayerIndex),s=!0}else if(r.color.length<i.color.length){const e=[...i.color].slice(r.color.length),t=[...r.color,...e];y.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{color:t},this.subLayerIndex),s=!0}}else!r.color&&i.color&&(y.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{color:[...i.color]},this.subLayerIndex),s=!0);switch(r.category){case"C":{if(!t&&this.config.designId){if(u.Z.isSvgImg(i))return void u.Z.svgImgHandler({pageIndex:this.pageIndex,layerIndex:this.layerIndex,subLayerIdx:this.subLayerIndex},this.config);i.color=this.config.color;const e=b(b({},!this.config.className&&{className:u.Z.classGenerator()}),i);y.ZP.updateLayerProps(this.pageIndex,this.layerIndex,e,this.subLayerIndex),y.ZP.updateLayerStyles(this.pageIndex,this.layerIndex,{initWidth:i.vSize[0],initHeight:i.vSize[1]},this.subLayerIndex)}const e=u.Z.transFormatter(this.className(),this.config.transArray,{cSize:this.config.cSize,pSize:this.config.pSize,pDiff:this.config.pDiff});this.updateTransNode(e),this.filterTemplate=this.getFilterTemplate();break}case"D":{t||(yield u.Z.addComputableInfo(this.config));const e=u.Z.markerTransFormatter(this.className(),this.config.markerTransArray,this.config.size,this.config.point,this.config.markerWidth);this.updateTransNode(e);break}case"E":t||u.Z.addComputableInfo(this.config);break;default:if(!t&&this.config.designId){if(u.Z.isSvgImg(i))return void u.Z.svgImgHandler({pageIndex:this.pageIndex,layerIndex:this.layerIndex,subLayerIdx:this.subLayerIndex},this.config);this.config.color&&this.config.color.length&&(i.color=this.config.color),delete i.styles;const e=b(b({},!this.config.className&&{className:u.Z.classGenerator()}),i);y.ZP.updateLayerProps(this.pageIndex,this.layerIndex,e,this.subLayerIndex),y.ZP.updateLayerStyles(this.pageIndex,this.layerIndex,{initWidth:i.vSize[0],initHeight:i.vSize[1]},this.subLayerIndex)}}s&&(f.Z.clearCurrStep(),f.Z.record());const n=u.Z.styleFormatter(this.className(),this.config.styleArray,this.config.color,this.config.size,this.config.dasharray,this.config.linecap,this.config.filled);this.updateStyleNode(n),this.paramsReady=!0}))},getFilterTemplate(){return"C"===this.config.category?this.getMergeTemplate():""},getRGBTemplate(e){let t="",i="",s="",r="";return 1===e?(t="0",i=M,s=R,r=O):(t=C,i="0",s=O,r=F),`\n      <feColorMatrix x="${t}" y="${i}" width="${s}" height="${r}" in="SourceGraphic"\n        type="matrix"\n        values="1 0 0 0 0\n                0 1 0 0 0\n                0 0 1 0 0\n                0 0 0 0 1" result="${j}${e}"/>`},getAlphaTemplate(e,t){let i="",s="",r="",n="",a="",o="",h="",c="",l="",d="";return 1===e?(i="0",s=`${Z}${t}`,r=R,n=E,a="0",o=`${T}${t}`,h=R,c=O,l="0",d=`${_}${t}`):(i=`${P}${t}`,s="0",r=E,n=F,a=`${$}${t}`,o="0",h=O,c=F,l=`${D}${t}`,d="0"),`\n      <feOffset in="${j}${e}" x="${a}" y="${o}" width="${h}" height="${c}" dx="${l}" dy="${d}" result="${j}${N}${e}${t}"/>\n      <feColorMatrix x="${i}" y="${s}" width="${r}" height="${n}" in="SourceGraphic"\n        type="matrix"\n        values="0 0 0 1 0\n                0 0 0 1 0\n                0 0 0 1 0\n                0 0 0 0 1" result="${z}${e}${t}"/>`},getMedianFilterTemplate(e,t){const i=z;let s=[];return s=1===e?["0 1 0 0 0 0 0 0 0","0 0 0 0 1 0 0 0 0","0 0 0 0 0 0 0 1 0"]:["0 0 0 1 0 0 0 0 0","0 0 0 0 1 0 0 0 0","0 0 0 0 0 1 0 0 0"],`\n      <feConvolveMatrix in="${i}${e}${t}"\n          kernelMatrix="${s[0]}" preserveAlpha="true" result="${i}p1${e}${t}"/>\n      <feConvolveMatrix in="${i}${e}${t}"\n          kernelMatrix="${s[1]}" preserveAlpha="true" result="${i}p2${e}${t}"/>\n      <feConvolveMatrix in="${i}${e}${t}"\n          kernelMatrix="${s[2]}" preserveAlpha="true" result="${i}p3${e}${t}"/>\n      <feBlend in="${i}p1${e}${t}" in2="${i}p2${e}${t}" mode="lighten" result="${i}a1${e}${t}"/>\n      <feBlend in="${i}p1${e}${t}" in2="${i}p2${e}${t}" mode="darken" result="${i}a2${e}${t}"/>\n      <feBlend in="${i}a2${e}${t}" in2="${i}p3${e}${t}" mode="lighten" result="${i}a3${e}${t}"/>\n      <feBlend in="${i}a3${e}${t}" in2="${i}a1${e}${t}" mode="darken" result="${i}${N}${e}${t}"/>`},getIntermediateTemplate(e,t){return`\n      ${this.getAlphaTemplate(e,t)}${this.getMedianFilterTemplate(e,t)}${this.getCompositeTemplate(e,t)}`},getCompositeTemplate(e,t){return`\n      <feColorMatrix\n        in="${z}${N}${e}${t}"\n        type="matrix"\n        values="0 0 0 0 0\n                0 0 0 0 0\n                0 0 0 0 0\n                1 0 0 0 0" result="${H}${e}${t}"/>\n      <feComposite in2="${H}${e}${t}" in="${j}${N}${e}${t}" operator="atop" result="${k}${e}${t}"/>`},getMergeTemplate(){let e="",t="",i="";switch(this.config.scaleType){case 1:e=`\n          ${this.getRGBTemplate(0)}\n          ${this.getIntermediateTemplate(0,0)}\n          ${this.getIntermediateTemplate(0,1)}\n          ${this.getRGBTemplate(1)}\n          ${this.getIntermediateTemplate(1,0)}\n          ${this.getIntermediateTemplate(1,1)}`,t=`\n          <feMergeNode in="${z}${N}00"/>\n          <feMergeNode in="${z}${N}01"/>\n          <feMergeNode in="${z}${N}10"/>\n          <feMergeNode in="${z}${N}11"/>`,i=`\n          <feMergeNode in="${k}00"/>\n          <feMergeNode in="${k}01"/>\n          <feMergeNode in="${k}10"/>\n          <feMergeNode in="${k}11"/>`;break;case 2:e=`\n          ${this.getRGBTemplate(0)}\n          ${this.getIntermediateTemplate(0,0)}\n          ${this.getIntermediateTemplate(0,1)}`,t=`\n          <feMergeNode in="${z}${N}00"/>\n          <feMergeNode in="${z}${N}01"/>`,i=`\n          <feMergeNode in="${k}00"/>\n          <feMergeNode in="${k}01"/>`;break;case 3:e=`\n          ${this.getRGBTemplate(1)}\n          ${this.getIntermediateTemplate(1,0)}\n          ${this.getIntermediateTemplate(1,1)}`,t=`\n          <feMergeNode in="${z}${N}10"/>\n          <feMergeNode in="${z}${N}11"/>`,i=`\n          <feMergeNode in="${k}10"/>\n          <feMergeNode in="${k}11"/>`;break}return`\n      ${e}\n      <feMerge result="m">${t}\n      </feMerge>\n      <feComposite in="SourceGraphic" in2="m" operator="out" result="rgbf"/>\n      <feMerge>\n        <feMergeNode in="rgbf"/>${i}\n      </feMerge>`}}}),ie=i(53372);const se=(0,ie.Z)(te,[["render",p],["__scopeId","data-v-db3bb500"],["__file","NuShape.vue"]]);var re=se},63810:function(e,t,i){i.r(t),i.d(t,{default:function(){return N}});var s=i(29651),r=i(819),n=i(41463);const a={class:"nu-sub-controller"},o=["layer-index"];function h(e,t,i,h,c,l){const d=(0,s.up)("nu-text-editor");return(0,s.wg)(),(0,s.iD)("div",a,[(0,s._)("div",{class:"nu-sub-controller__wrapper",style:(0,r.j5)(e.positionStyles())},[(0,s._)("div",{class:"nu-sub-controller__wrapper",style:(0,r.j5)(e.wrapperStyles)},[(0,s._)("div",{class:"nu-sub-controller__content",ref:"body","layer-index":`${e.layerIndex}`,style:(0,r.j5)(e.styles)},["text"===e.config.type&&e.config.active?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"text text__wrapper",style:(0,r.j5)(e.textWrapperStyle()),draggable:"false",onPointerdown:t[16]||(t[16]=(...t)=>e.onPointerdown&&e.onPointerdown(...t))},[(0,s.Wm)(d,{initText:e.textHtml(),id:`text-sub-${e.primaryLayerIndex}-${e.layerIndex}`,style:(0,r.j5)(e.textBodyStyle()),pageIndex:e.pageIndex,page:e.page,layerIndex:e.primaryLayerIndex,config:e.config,primaryLayer:e.primaryLayer,subLayerIndex:e.layerIndex,pageId:e.page.id,layerId:e.primaryLayer.id,subLayerId:e.config.id,onKeydown:[t[0]||(t[0]=(0,n.D2)((0,n.iM)((()=>{}),["stop"]),["arrow-left"])),t[1]||(t[1]=(0,n.D2)((0,n.iM)((()=>{}),["stop"]),["arrow-up"])),t[2]||(t[2]=(0,n.D2)((0,n.iM)((()=>{}),["stop"]),["arrow-right"])),t[3]||(t[3]=(0,n.D2)((0,n.iM)((()=>{}),["stop"]),["arrow-down"])),t[4]||(t[4]=(0,n.D2)((0,n.iM)((()=>{}),["ctrl","exact","stop","self"]),["c"])),t[5]||(t[5]=(0,n.D2)((0,n.iM)((()=>{}),["meta","exact","stop","self"]),["c"])),t[6]||(t[6]=(0,n.D2)((0,n.iM)((()=>{}),["ctrl","exact","stop","self"]),["v"])),t[7]||(t[7]=(0,n.D2)((0,n.iM)((()=>{}),["meta","exact","stop","self"]),["v"])),t[8]||(t[8]=(0,n.D2)((0,n.iM)((()=>{}),["ctrl","exact","stop","self"]),["x"])),t[9]||(t[9]=(0,n.D2)((0,n.iM)((()=>{}),["meta","exact","stop","self"]),["x"])),t[10]||(t[10]=(0,n.D2)((0,n.iM)((()=>{}),["ctrl","exact","stop","self"]),["a"])),t[11]||(t[11]=(0,n.D2)((0,n.iM)((()=>{}),["meta","exact","stop","self"]),["a"])),t[12]||(t[12]=(0,n.D2)((0,n.iM)((()=>{}),["ctrl","exact","stop","self"]),["z"])),t[13]||(t[13]=(0,n.D2)((0,n.iM)((()=>{}),["meta","exact","stop","self"]),["z"])),t[14]||(t[14]=(0,n.D2)((0,n.iM)((()=>{}),["ctrl","shift","exact","stop","self"]),["z"])),t[15]||(t[15]=(0,n.D2)((0,n.iM)((()=>{}),["meta","shift","exact","stop","self"]),["z"]))],onUpdate:e.handleTextChange,onCompositionend:e.handleTextCompositionEnd},null,8,["initText","id","style","pageIndex","page","layerIndex","config","primaryLayer","subLayerIndex","pageId","layerId","subLayerId","onUpdate","onCompositionend"])],36)):(0,s.kq)("",!0)],12,o)],4)],4)])}var c=i(43539),l=i(28253),d=i(6400),g=i(89995),p=i(71446),y=i(2531),u=i(62013),f=i(78871),m=i(70118),x=i(3162),I=i(75231),v=i(50543),S=i(32905),w=i(53556),b=i(52632),L=i(15789),P=i(23917),Z=i(89456),$=i(16290),T=i(38058),C=Object.defineProperty,M=Object.defineProperties,D=Object.getOwnPropertyDescriptors,_=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,R=(e,t,i)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,F=(e,t)=>{for(var i in t||(t={}))E.call(t,i)&&R(e,i,t[i]);if(_)for(var i of _(t))O.call(t,i)&&R(e,i,t[i]);return e},j=(e,t)=>M(e,D(t)),k=(0,s.aZ)({props:{config:{type:Object,required:!0},layerIndex:{type:Number,required:!0},pageIndex:{type:Number,required:!0},page:{type:Object,required:!0},primaryLayerIndex:{type:Number,required:!0},primaryLayer:{type:Object,required:!0},type:{type:String,required:!0},contentScaleRatio:{default:1,type:Number},primaryLayerZindex:{default:0,type:Number}},components:{NuTextEditor:c.Z},emits:["clickSubController"],data(){return{subLayerCtrlUtils:null,isControlling:!1,isComposing:!1,layerSizeBuff:-1,posDiff:{x:0,y:0},parentId:"",imgBuff:{},isPrimaryActive:!1}},mounted(){const e=this.$refs.body;if(e){const t=this.$props,i={};Object.defineProperties(i,{pageIndex:{get(){return t.pageIndex}},layerIndex:{get(){return t.primaryLayerIndex}},subLayerIdx:{get(){return t.layerIndex}}});const s={config:{active:!1},primaryLayer:{}};Object.defineProperties(s,{config:{get(){return t.config}},primaryLayer:{get(){return t.primaryLayer}}}),this.subLayerCtrlUtils=new L.Z({layerInfo:i,_config:s,body:e}),e.addEventListener("contextmenu",(e=>{e.preventDefault()}),!1),this.setLastSelectedLayerIndex(this.layerIndex),this.parentId=this.primaryLayer.id,this.type===d.F5.frame&&this.config.type===d.F5.image&&e.addEventListener(this.$isTouchDevice()?"pointerenter":"mouseenter",this.onFrameMouseEnter),this.config.type===d.F5.text&&I.ZP.updateSubLayerProps(this.pageIndex,this.primaryLayerIndex,this.layerIndex,{editing:!0})}},computed:j(F(F(F(F({},(0,T.rn)("text",["sel","props"])),(0,T.rn)("shadow",["processId","handleId","uploadId"])),(0,T.rn)(["isMoving","currDraggedPhoto"])),(0,T.Se)({scaleRatio:"getPageScaleRatio",currSelectedInfo:"getCurrSelectedInfo",getCurrFunctionPanelType:"getCurrFunctionPanelType",isProcessShadow:"shadow/isProcessing",isUploadImgShadow:"shadow/isUploading",isHandleShadow:"shadow/isHandling"})),{wrapperStyles(){const e=this.primaryLayer.styles.scale;return F(j(F({transformOrigin:"0px 0px",transform:`scale(${"frame"!==this.type||u.Z.isImageFrame(this.primaryLayer)?1:e})`},this.transformStyle),{outline:this.outlineStyles(),outlineOffset:`-${1/this.primaryLayer.styles.scale}px`}),this.sizeStyle())},styles(){var e;const{isFrameImg:t}=this.config,i="group"===this.type?(null==(e=this.config)?void 0:e.active)?this.getPrimaryLayerSubLayerNum:this.primaryLayerZindex:this.config.styles.zindex;return j(F({},this.sizeStyle()),{transform:`${"frame"!==this.type||t?"":`scale(${1/this.contentScaleRatio})`} ${this.enalble3dTransform?`translateZ(${i}px`:""})`})},isCurveText(){return this.checkIfCurve(this.config)},isFlipped(){return this.config.styles.horizontalFlip||this.config.styles.verticalFlip},isFlipping(){return this.config.isFlipping},isTextEditing(){var e;return!this.isControlling&&(null==(e=this.config)?void 0:e.active)},isDraggingCursor(){return this.config.isDraggingCursor},getPrimaryLayerSubLayerNum(){return this.primaryLayer.layers.length},enalble3dTransform(){return this.pageIndex===S.Z._3dEnabledPageIndex},transformStyle(){return{transformStyle:this.enalble3dTransform?"preserve-3d":"initial"}}}),watch:{isTextEditing(e){"text"===this.config.type&&I.ZP.updateSubLayerProps(this.pageIndex,this.primaryLayerIndex,this.layerIndex,{editing:e})},isComposing(e){this.layerSizeBuff=e?-1:this.config.styles.writingMode.includes("vertical")?this.config.styles.width:this.config.styles.height},"config.contentEditable"(e){"text"===this.config.type&&(this.config.active&&(e||$.Z.agent((e=>!e.isDestroyed&&e.commands.selectAll())),$.Z.agent((t=>{t.setEditable(e)}))),!this.$isTouchDevice()&&b.Z.updateHead(I.ZP.pageIndex,I.ZP.layerIndex,{contentEditable:e},this.layerIndex))}},unmounted(){"text"===this.config.type&&(this.primaryLayer&&this.primaryLayer.id===this.parentId&&I.ZP.updateSubLayerProps(this.pageIndex,this.primaryLayerIndex,this.layerIndex,{editing:!1,isTyping:!1}),I.ZP.updateSubLayerProps(this.pageIndex,this.primaryLayerIndex,this.layerIndex,{contentEditable:!1}),this.isControlling=!1),w.Z.closePopup()},methods:j(F({},(0,T.OI)({setLastSelectedLayerIndex:"SET_lastSelectedLayerIndex",setIsLayerDropdownsOpened:"SET_isLayerDropdownsOpened"})),{isDraggedPanelPhoto(){return""!==this.currDraggedPhoto.srcObj.type},textHtml(){return $.Z.toJSON(this.config.paragraphs)},textWrapperStyle(){const e=this.contentScaleRatio*this.scaleRatio*.01;return F(F({width:this.config.styles.width/this.config.styles.scale+"px",height:this.config.styles.height/this.config.styles.scale+"px",opacity:""+this.config.styles.opacity/100,transform:`scaleX(${this.config.styles.scale*e}) scaleY(${this.config.styles.scale*e})`,textAlign:this.config.styles.align},p.Z.convertVerticalStyle(this.config.styles.writingMode)),this.isDraggingCursor?{zIndex:100}:{})},textBodyStyle(){const e=(0,l.iX)(this.config.styles.textFill),t=(this.isCurveText||this.isFlipped||this.isFlipping||e)&&!this.config.contentEditable?1e-4:1;return{width:this.config.styles.width/this.config.styles.scale+"px",height:this.config.styles.height/this.config.styles.scale+"px",opacity:t}},onPointerdown(e){this.subLayerCtrlUtils.onPointerdown(e)},onMouseup(e){e.stopPropagation(),"text"===this.config.type&&(this.posDiff.x=this.primaryLayer.styles.x-this.posDiff.x,this.posDiff.y=this.primaryLayer.styles.y-this.posDiff.y,0!==this.posDiff.x||0!==this.posDiff.y?I.ZP.updateSubLayerProps(this.pageIndex,this.primaryLayerIndex,this.layerIndex,{contentEditable:!1}):this.config.contentEditable&&(I.ZP.updateLayerProps(this.pageIndex,this.primaryLayerIndex,{isTyping:!0},this.layerIndex),this.$isTouchDevice()?$.Z.focus({scrollIntoView:!1},"end"):$.Z.focus({scrollIntoView:!1}))),y.ZP.removePointerEvent("pointerup",this.onMouseup),this.isControlling=!1,this.onClickEvent(e)},positionStyles(){const{horizontalFlip:e,verticalFlip:t}=this.primaryLayer.styles,i=this.contentScaleRatio*this.scaleRatio*.01;let{x:s,y:r}=this.config.styles;if("frame"===this.type&&e){const e=this.primaryLayer.styles.width/2,t=this.config.styles.x+this.config.styles.width/2;s+=2*(e-t)}if("frame"===this.type&&t){const e=this.primaryLayer.styles.height/2,t=this.config.styles.y+this.config.styles.height/2;r+=2*(e-t)}return F({transform:`translate(${s*i}px, ${r*i}px)rotate(${this.config.styles.rotate}deg)scaleX(${e?-1:1})scaleY(${t?-1:1})`,width:this.config.styles.width*i+"px",height:this.config.styles.height*i+"px","pointer-events":"none"},this.transformStyle)},sizeStyle(){const{isFrameImg:e}=this.config,t=this.contentScaleRatio*this.scaleRatio*.01;let i,s;return"frame"!==this.type||e?(i=this.config.styles.width*t+"px",s=this.config.styles.height*t+"px"):(i=this.config.styles.initWidth*t+"px",s=this.config.styles.initHeight*t+"px"),{width:i,height:s}},outlineStyles(){var e;const t=this.config.locked?"#EB5757":"#7190CC",i="frame"===I.ZP.getCurrLayer.type&&"image"===this.config.type&&u.Z.checkIsRect(this.config.clipPath);return("frame"!==I.ZP.getCurrLayer.type||i)&&(null==(e=this.config)?void 0:e.active)?`${2.5/this.primaryLayer.styles.scale}px solid ${t}`:"none"},waitFontLoadingAndRecord(){const e=this.page.id,t=this.primaryLayer.id,i=this.config.id;Z.Z.waitFontLoadingAndRecord(this.config.paragraphs,(()=>{const{pageIndex:s,layerIndex:r,subLayerIdx:n}=I.ZP.getLayerInfoById(e,t,i);if(-1===r)return console.log("the layer to update size doesn't exist anymore.");Z.Z.updateTextLayerSizeByShape(s,r,n)}))},waitFontLoadingAndResize(){const e=this.page.id,t=this.primaryLayer.id,i=this.config.id;Z.Z.untilFontLoaded(this.config.paragraphs).then((()=>{setTimeout((()=>{const{pageIndex:s,layerIndex:r,subLayerIdx:n}=I.ZP.getLayerInfoById(e,t,i);if(-1===r)return console.log("the layer to update size doesn't exist anymore.");Z.Z.updateTextLayerSizeByShape(s,r,n)}),100)}))},checkIfCurve(e){return P.Z.isCurvedText(e.styles.textShape)},calcSize(e){this.checkIfCurve(e)?this.curveTextSizeRefresh(e):Z.Z.updateGroupLayerSize(this.pageIndex,this.primaryLayerIndex,this.layerIndex)},handleTextChange(e){var t,i;I.ZP.updateSubLayerProps(this.pageIndex,this.primaryLayerIndex,this.layerIndex,{paragraphs:e.paragraphs}),this.calcSize(this.config),e.toRecord?this.waitFontLoadingAndRecord():this.waitFontLoadingAndResize(),e.isSetContentRequired&&!(null==(i=null==(t=$.Z.editor)?void 0:t.view)?void 0:i.composing)&&this.$nextTick((()=>{$.Z.agent((t=>{t.chain().setContent($.Z.toJSON(e.paragraphs)).selectPrevious().run()}))}))},handleTextCompositionEnd(e){e&&this.waitFontLoadingAndRecord()},curveTextSizeRefresh(e){const{height:t}=e.styles,i=P.Z.getCurveTextHW(e);I.ZP.updateSubLayerStyles(this.pageIndex,this.primaryLayerIndex,this.layerIndex,P.Z.getCurveTextPropsByHW(e,i)),Z.Z.asSubLayerSizeRefresh(this.pageIndex,this.primaryLayerIndex,this.layerIndex,i.areaHeight,t),Z.Z.fixGroupCoordinates(this.pageIndex,this.primaryLayerIndex)},onClickEvent(e){this.isPrimaryActive&&(g.ZP.event.emit("closeColorPanel",!1),this.$emit("clickSubController",this.layerIndex,this.config.type,f.Z.exact([e.shiftKey,e.ctrlKey,e.metaKey])))},onFrameMouseEnter(e){if(this.config.type!==d.F5.image||this.type!==d.F5.frame)return;if(I.ZP.layerIndex!==this.layerIndex&&x.Z.isImgControl())return;if(this.primaryLayer.locked&&!this.isDraggedPanelPhoto())return;if(I.ZP.getCurrLayer.id===this.uploadId.layerId)return;e.stopPropagation();const t=I.ZP.getCurrLayer;if(t&&t.type===d.F5.image&&this.isMoving&&void 0===t.previewSrc){const{srcObj:e,previewSrc:i}=this.config,s=f.Z.deepCopy(this.primaryLayer.clips),r=s[this.layerIndex];Object.assign(this.imgBuff,{srcObj:F({},e),previewSrc:i,styles:{imgX:r.styles.imgX,imgY:r.styles.imgY,imgWidth:r.styles.imgWidth,imgHeight:r.styles.imgHeight,adjust:r.styles.adjust}}),u.Z.updateFrameLayerProps(this.pageIndex,this.primaryLayerIndex,this.layerIndex,F({srcObj:F({},t.srcObj)},t.previewSrc&&{previewSrc:t.previewSrc})),I.ZP.updateLayerStyles(I.ZP.pageIndex,I.ZP.layerIndex,{opacity:35}),I.ZP.updateLayerProps(I.ZP.pageIndex,I.ZP.layerIndex,{isHoveringFrame:!0});const{imgWidth:n,imgHeight:a,imgX:o,imgY:h}=v.Z.clipperHandler(I.ZP.getCurrLayer,r.clipPath,r.styles).styles;u.Z.updateFrameLayerStyles(this.pageIndex,this.primaryLayerIndex,this.layerIndex,{adjust:F({},t.styles.adjust),imgWidth:n,imgHeight:a,imgX:o,imgY:h});const c=this.$refs.body;c.addEventListener(this.$isTouchDevice()?"pointerleave":"mouseleave",this.onFrameMouseLeave),c.addEventListener(this.$isTouchDevice()?"pointerup":"mouseup",this.onFrameMouseUp)}},onFrameMouseLeave(e){if(this.isDraggedPanelPhoto())return;if(this.config.type!==d.F5.image||this.type!==d.F5.frame)return;e.stopPropagation();const t=I.ZP.getCurrLayer;t&&t.type===d.F5.image&&this.isMoving&&(I.ZP.updateLayerStyles(I.ZP.pageIndex,I.ZP.layerIndex,{opacity:100}),I.ZP.updateLayerProps(I.ZP.pageIndex,I.ZP.layerIndex,{isHoveringFrame:!1}),u.Z.updateFrameLayerProps(this.pageIndex,this.primaryLayerIndex,this.layerIndex,{srcObj:F({},this.imgBuff.srcObj)}),u.Z.updateFrameLayerStyles(this.pageIndex,this.primaryLayerIndex,this.layerIndex,F({},this.imgBuff.styles)));const i=this.$refs.body;i.removeEventListener(this.$isTouchDevice()?"pointerleave":"mouseleave",this.onFrameMouseLeave),i.removeEventListener(this.$isTouchDevice()?"pointerup":"mouseup",this.onFrameMouseUp)},onFrameMouseUp(e){if(this.isDraggedPanelPhoto())return;const t=I.ZP.getCurrLayer;if(t&&t.type===d.F5.image){I.ZP.deleteLayer(I.ZP.pageIndex,I.ZP.layerIndex);const e=this.primaryLayerIndex>I.ZP.layerIndex?this.primaryLayerIndex-1:this.primaryLayerIndex;m.Z.set(this.pageIndex,e,[this.primaryLayer]),u.Z.updateFrameLayerProps(this.pageIndex,e,this.layerIndex,{active:!0}),b.Z.record()}const i=this.$refs.body;i.removeEventListener(this.$isTouchDevice()?"pointerup":"mouseup",this.onFrameMouseUp),i.removeEventListener(this.$isTouchDevice()?"pointerleave":"mouseleave",this.onFrameMouseLeave)}})}),z=i(53372);const H=(0,z.Z)(k,[["render",h],["__scopeId","data-v-3a17aaf2"],["__file","NuSubController.vue"]]);var N=H},43888:function(e,t,i){i.r(t),i.d(t,{default:function(){return te}});var s=i(29651),r=i(819);const n=["data-sindex"],a={key:0};function o(e,t,i,o,h,c){const l=(0,s.up)("custom-element"),d=(0,s.up)("nu-curve-text");return(0,s.wg)(),(0,s.iD)("div",{class:"nu-text",draggable:"false",style:(0,r.j5)(e.textWrapperStyle())},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)([e.textBg,e.textFillBg],((e,t)=>((0,s.wg)(),(0,s.iD)(s.HY,null,[e?((0,s.wg)(),(0,s.j4)(l,{class:"nu-text__BG",config:e,key:`textSvgBg${t}`},null,8,["config"])):(0,s.kq)("",!0)],64)))),256)),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.duplicatedText,((t,i)=>((0,s.wg)(),(0,s.iD)("div",{class:"nu-text__body",key:"text"+(e.duplicatedText.length-i),style:(0,r.j5)(Object.assign(e.bodyStyles(),t.extraBodyStyle))},[e.isCurveText?((0,s.wg)(),(0,s.j4)(d,{key:0,config:e.config,layerIndex:e.layerIndex,pageIndex:e.pageIndex,page:e.page,subLayerIndex:e.subLayerIndex,primaryLayer:e.primaryLayer,contentScaleRatio:e.contentScaleRatio,extraSpanStyle:t.extraSpanStyle},null,8,["config","layerIndex","pageIndex","page","subLayerIndex","primaryLayer","contentScaleRatio","extraSpanStyle"])):((0,s.wg)(!0),(0,s.iD)(s.HY,{key:1},(0,s.Ko)(e.config.paragraphs,((i,o)=>((0,s.wg)(),(0,s.iD)("p",{class:"nu-text__p",key:`p${o}`,style:(0,r.j5)(e.pStyle(i.styles))},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.spans,((h,c)=>((0,s.wg)(),(0,s.iD)("span",{class:"nu-text__span",key:`span${c}`,"data-sindex":c,style:(0,r.j5)(Object.assign(e.spanStyle(c,o),t.extraSpanStyle))},[(0,s.Uk)((0,r.zw)(h.text),1),h.text||1!==i.spans.length?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("br",a))],12,n)))),128))],4)))),128))],4)))),128))],4)}function h(e,t,i,r,n,a){const o=(0,s.up)("custom-element",!0);return(0,s.wg)(),(0,s.j4)((0,s.LL)(e.config.tag),(0,s.dG)(e.config.attrs,{style:e.config.style}),{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.config.content,((e,t)=>((0,s.wg)(),(0,s.j4)(o,{config:e,key:t},null,8,["config"])))),128)),(0,s.WI)(e.$slots,"default")])),_:3},16,["style"])}var c=(0,s.aZ)({name:"CustomElement",props:{config:{type:Object,required:!0}}}),l=i(53372);const d=(0,l.Z)(c,[["render",h],["__file","CustomElement.vue"]]);var g=d;const p={class:"nu-curve-text__p"};function y(e,t,i,n,a,o){const h=(0,s.up)("svg-icon");return(0,s.wg)(),(0,s.iD)("p",p,["shape"===e.focus?((0,s.wg)(),(0,s.iD)("span",{key:0,class:"nu-curve-text__circle",style:(0,r.j5)(e.circleStyle())},[(0,s.Wm)(h,{iconName:"curve-center",style:(0,r.j5)(e.curveIconStyle)},null,8,["style"])],4)):(0,s.kq)("",!0),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.spans(),((t,i)=>((0,s.wg)(),(0,s.iD)("span",{class:(0,r.C_)(["nu-curve-text__span",`nu-curve-text__span-p${e.pageIndex}l${e.layerIndex}s${e.subLayerIndex?e.subLayerIndex:-1}`]),key:i,style:(0,r.j5)(Object.assign(e.spanStyle(t.styles,i),e.extraSpanStyle))},(0,r.zw)(t.text),7)))),128))])}var u=i(78871),f=i(75231),m=i(90272),x=i(23917),I=i(89456),v=i(16290),S=i(38058),w=Object.defineProperty,b=Object.defineProperties,L=Object.getOwnPropertyDescriptors,P=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable,T=(e,t,i)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,C=(e,t)=>{for(var i in t||(t={}))Z.call(t,i)&&T(e,i,t[i]);if(P)for(var i of P(t))$.call(t,i)&&T(e,i,t[i]);return e},M=(e,t)=>b(e,L(t)),D=(e,t,i)=>new Promise(((s,r)=>{var n=e=>{try{o(i.next(e))}catch(t){r(t)}},a=e=>{try{o(i.throw(e))}catch(t){r(t)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,a);o((i=i.apply(e,t)).next())})),_=(0,s.aZ)({emits:[],props:{config:{type:Object,required:!0},layerIndex:{type:Number,required:!0},pageIndex:{type:Number,required:!0},subLayerIndex:{type:Number},primaryLayer:{type:Object,default:()=>{}},extraSpanStyle:{type:Object}},data(){return{textWidth:[],textHeight:[],minHeight:0,isDestroyed:!1}},created(){return D(this,null,(function*(){yield this.computeDimensions(),I.Z.loadAllFonts(this.config)}))},unmounted(){this.isDestroyed=!0},mounted(){return D(this,null,(function*(){I.Z.untilFontLoaded(this.config.paragraphs,!0).then((()=>{setTimeout((()=>D(this,null,(function*(){yield this.resizeCallback(),u.Z.setDoneFlag(this.pageIndex,this.layerIndex,this.subLayerIndex)}))),100)}))}))},computed:M(C(C({},(0,S.rn)("text",["fontStore"])),(0,S.Se)({scaleRatio:"getPageScaleRatio"})),{focus(){var e;return this.config.active||(null==(e=this.primaryLayer)?void 0:e.active)?m.Z.focus:"none"},transforms(){const e=m.Z.getLayerFontSize(this.config.paragraphs);return x.Z.convertTextShape(this.textWidth,this.bend(),e)}}),watch:{"config.paragraphs":{handler(e){this.computeDimensions(),I.Z.untilFontLoaded(e).then((()=>{this.computeDimensions()}))},deep:!0}},methods:{bend(){const{textShape:e}=this.config.styles;return+e.bend},spans(){return x.Z.flattenSpans(this.config)},circleStyle(){const{minHeight:e,scaleRatio:t}=this,i=this.bend(),s=1/(.01*t)+"px",r={},n=m.Z.getLayerFontSize(this.config.paragraphs),a=x.Z.getRadiusByBend(i,n);return i>=0?r.top=e/2+"px":r.bottom=e/2+"px",0===i&&(r.borderRadius=0),M(C({},r),{borderWidth:s,height:2*a+"px",width:2*a+"px"})},curveIconStyle(){const{config:{styles:e},scaleRatio:t}=this,i=13/(.01*t);return{width:i/e.scale+"px",height:i/e.scale+"px"}},spanStyle(e,t){const i=e.size,{textHeight:s,minHeight:r}=this,n=this.bend(),a=this.transforms,o=(r-s[t])/2-i+"px",h=v.Z.textStylesRaw(e);return Object.assign(h,{textIndent:h["letter-spacing"]||"initial",transform:a[t]||"none",padding:`${i}px`},n>=0?{top:o}:{bottom:o})},computeDimensions(){return D(this,null,(function*(){const{textWidth:e,textHeight:t,minHeight:i}=yield x.Z.getTextHWsAsync(this.config);this.textWidth=e,this.textHeight=t,this.minHeight=i}))},resizeCallback(){return D(this,null,(function*(){if(!this.isDestroyed){if("undefined"===typeof this.subLayerIndex||-1===this.subLayerIndex)f.ZP.updateLayerStyles(this.pageIndex,this.layerIndex,yield x.Z.getCurveTextPropsAsync(this.config));else{const e=f.ZP.getLayer(this.pageIndex,this.layerIndex);if("group"!==e.type||"text"!==e.layers[this.subLayerIndex].type)return;f.ZP.updateSubLayerStyles(this.pageIndex,this.layerIndex,this.subLayerIndex,yield x.Z.getCurveTextPropsAsync(this.config)),I.Z.updateGroupLayerSize(this.pageIndex,this.layerIndex)}yield this.computeDimensions()}}))}}});const E=(0,l.Z)(_,[["render",y],["__file","NuCurveText.vue"]]);var O=E,R=i(28253),F=i(71446),j=i(70118),k=i(32905),z=i(32490),H=i(86914),N=i(60410),A=i.n(N),W=Object.defineProperty,B=Object.defineProperties,q=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,U=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable,K=(e,t,i)=>t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,G=(e,t)=>{for(var i in t||(t={}))U.call(t,i)&&K(e,i,t[i]);if(Y)for(var i of Y(t))X.call(t,i)&&K(e,i,t[i]);return e},V=(e,t)=>B(e,q(t)),Q=(e,t,i)=>new Promise(((s,r)=>{var n=e=>{try{o(i.next(e))}catch(t){r(t)}},a=e=>{try{o(i.throw(e))}catch(t){r(t)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,a);o((i=i.apply(e,t)).next())})),J=(0,s.aZ)({components:{NuCurveText:O,CustomElement:g},props:{config:{type:Object,required:!0},pageIndex:{type:Number,required:!0},page:{type:Object,required:!0},layerIndex:{type:Number,required:!0},subLayerIndex:{type:Number,default:-1},primaryLayer:{type:Object,default:()=>{}},contentScaleRatio:{default:1,type:Number},inPreview:{default:!1,type:Boolean}},data(){const e=this.config.styles.writingMode.includes("vertical")?this.config.styles.height:this.config.styles.width;return{isDestroyed:!1,initSize:{width:this.config.styles.width,height:this.config.styles.height,widthLimit:-1===this.config.widthLimit?-1:e,spanDataList:this.config.spanDataList},textBgVersion:0,textBg:{},textFillBg:{}}},created(){I.Z.loadAllFonts(this.config)},unmounted(){this.isDestroyed=!0},mounted(){this.resizeAfterFontLoaded()},computed:{isCurveText(){return x.Z.isCurvedText(this.config.styles.textShape)},isFlipped(){return this.config.styles.horizontalFlip||this.config.styles.verticalFlip},isFlipping(){return this.config.isFlipping},isLocked(){return this.config.locked},focus(){var e;return this.config.active||(null==(e=this.primaryLayer)?void 0:e.active)?m.Z.focus:"none"},aspectRatio(){return(0,N.round)(this.config.styles.width/this.config.styles.height,2)},duplicatedText(){const e={position:"absolute",width:"100%",height:"100%",opacity:1},t=m.Z.convertTextEffect(this.config).duplicatedTexts;return[...t?t.map((t=>(t.extraBodyStyle=Object.assign({},e,t.extraBodyStyle),t))):[],{}]}},watch:{"config.paragraphs"(e){f.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{isAutoResizeNeeded:!1},this.subLayerIndex),this.drawTextBg(),I.Z.untilFontLoaded(e).then((()=>Q(this,null,(function*(){this.drawTextBg()}))))},aspectRatio(){this.drawTextBg()},focus(){this.drawTextFill()},"config.styles.textShape"(){"none"!==this.config.styles.textBg.name&&this.drawTextBg()},"config.styles.textBg"(){this.drawTextBg()},"config.styles.textFill"(){this.drawTextFill()}},methods:{drawTextBg(){return new Promise((e=>{this.$nextTick((()=>Q(this,null,(function*(){const t=this.textBgVersion=this.textBgVersion+1,i=yield z.Z.drawTextBg(this.config);t===this.textBgVersion&&(this.textBg=i),e()}))))}))},drawTextFill(){return Q(this,null,(function*(){const e=this.contentScaleRatio*k.Z.getImageDpiRatio(this.page),t=H.Z.drawTextFill(this.config,e);(0,N.isEqual)(t,this.textFillBg)||(this.textFillBg=t)}))},isLayerAutoResizeNeeded(){return this.config.isAutoResizeNeeded},getOpacity(){const{active:e,contentEditable:t}=this.config,i=(0,R.iX)(this.config.styles.textFill);return!e||this.isLocked||this.inPreview?1:this.isCurveText||this.isFlipped||this.isFlipping||i?t?.2:1:0},textWrapperStyle(){return G({},F.Z.convertVerticalStyle(this.config.styles.writingMode))},bodyStyles(){const e=this.getOpacity(),t=this.config.styles.writingMode.includes("vertical"),i=(0,N.omit)(m.Z.convertTextEffect(this.config),["duplicatedTexts"]),s=(0,N.max)(this.config.paragraphs.flatMap((e=>e.spans.map((e=>e.styles.size))))),r=this.contentScaleRatio*k.Z.getImageDpiRatio(this.page),n=H.Z.convertTextEffect(this.config,r);return V(G(G({width:t?"100%":"",height:t?"":"100%",textAlign:this.config.styles.align,opacity:e},n),i),{padding:`${s}px`,[t?"right":"left"]:-1*s+"px",top:-1*s+"px"})},spanStyle(e,t){const i=this.config.paragraphs[t],s=i.spans[e];let r=v.Z.textStylesRaw(s.styles);return"none"!==this.config.styles.textFill.name&&(r=(0,N.omit)(r,["text-decoration-line","-webkit-text-decoration-line"])),Object.assign(r,e===i.spans.length-1&&s.text.match(/^ +$/)?{whiteSpace:"pre"}:{},z.Z.fixedWidthStyle(s.styles,i.styles,this.config))},pStyle(e){return A().omit(v.Z.textStylesRaw(e),["text-decoration-line","-webkit-text-decoration-line"])},resizeCallback(){return Q(this,null,(function*(){const e=u.Z.deepCopy(this.config);if(this.isDestroyed||x.Z.isCurvedText(e.styles.textShape))return;let t;this.isLayerAutoResizeNeeded()?(t=yield I.Z.autoResize(e,this.initSize),f.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{isAutoResizeNeeded:!1},this.subLayerIndex)):t=e.widthLimit;const i=yield I.Z.getTextHWAsync(e,t);if("undefined"===typeof this.subLayerIndex||-1===this.subLayerIndex){let s=e.styles.x,r=e.styles.y;-1===e.widthLimit&&(s=e.styles.x-(i.width-e.styles.width)/2,r=e.styles.y-(i.height-e.styles.height)/2),f.ZP.updateLayerStyles(this.pageIndex,this.layerIndex,{x:s,y:r,width:i.width,height:i.height}),f.ZP.updateLayerProps(this.pageIndex,this.layerIndex,{widthLimit:t,spanDataList:i.spanDataList})}else{const e=f.ZP.getLayer(this.pageIndex,this.layerIndex);if("group"!==e.type||"text"!==e.layers[this.subLayerIndex].type)return;f.ZP.updateSubLayerStyles(this.pageIndex,this.layerIndex,this.subLayerIndex,{width:i.width,height:i.height}),f.ZP.updateSubLayerProps(this.pageIndex,this.layerIndex,this.subLayerIndex,{widthLimit:t,spanDataList:i.spanDataList});const{width:s,height:r}=(0,j.O)(e.layers,e.styles.scale);f.ZP.updateLayerStyles(this.pageIndex,this.layerIndex,{width:s,height:r})}}))},resizeAfterFontLoaded(){return Q(this,null,(function*(){I.Z.untilFontLoaded(this.config.paragraphs,!0).then((()=>{setTimeout((()=>Q(this,null,(function*(){yield this.resizeCallback(),this.drawTextBg(),this.isCurveText||u.Z.setDoneFlag(this.pageIndex,this.layerIndex,this.subLayerIndex)}))),100)})),this.drawTextBg()}))}}});const ee=(0,l.Z)(J,[["render",o],["__scopeId","data-v-993fff96"],["__file","NuText.vue"]]);var te=ee},43539:function(e,t,i){i.d(t,{Z:function(){return w}});var s=i(29651);function r(e,t,i,r,n,a){const o=(0,s.up)("editor-content");return(0,s.wg)(),(0,s.j4)(o,{editor:e.editor},null,8,["editor"])}var n=i(75231),a=i(52632),o=i(16290),h=i(39685),c=i(60410),l=Object.defineProperty,d=Object.defineProperties,g=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,y=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,f=(e,t,i)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,m=(e,t)=>{for(var i in t||(t={}))y.call(t,i)&&f(e,i,t[i]);if(p)for(var i of p(t))u.call(t,i)&&f(e,i,t[i]);return e},x=(e,t)=>d(e,g(t)),I=(0,s.aZ)({components:{EditorContent:h.kg},props:{initText:{type:Object,required:!0},pageIndex:{type:Number,required:!0},layerIndex:{type:Number,required:!0},config:{type:Object,required:!0},primaryLayer:{type:Object},subLayerIndex:{type:Number,required:!0},pageId:{type:String,required:!0},layerId:{type:String,required:!0},subLayerId:{type:String,required:!0}},emits:["update","compositionend"],data(){return{editor:void 0,layerInfo:{}}},mounted(){this.layerInfo={currLayer:this.primaryLayer?this.primaryLayer:this.config,layerIndex:this.layerIndex,subLayerIdx:this.subLayerIndex};const e=this.config.contentEditable;o.Z.init(this.initText,e),this.editor=o.Z.editor,o.Z.on("update",(({editor:e})=>{let t=!1;const i=e.getJSON(),s=o.Z.getText(i),r=o.Z.prevText!==s;r&&(e.view.composing||(t=!0),requestAnimationFrame((()=>{const t=e.view.state.selection.ranges;if(t.length>0){const i=t[0].$to.pos;e.commands.setTextSelection({from:i,to:i})}}))),this.$emit("update",x(m({},o.Z.toIParagraph(i)),{toRecord:t})),(0,c.isEqual)(i,o.Z.prevJSON)||(this.updateLayerProps({isEdited:!0}),Object.prototype.hasOwnProperty.call(this.config,"loadFontEdited")&&this.updateLayerProps({loadFontEdited:!0})),o.Z.prevText=s,o.Z.prevJSON=i})),o.Z.onForceUpdate(((e,t)=>{this.$emit("update",x(m({},o.Z.toIParagraph(e.getJSON())),{toRecord:t}))})),o.Z.on("create",(({editor:e})=>{var t;(null==(t=this.config)?void 0:t.contentEditable)&&!this.$isTouchDevice()&&e.commands.focus();const i=e.view.dom;i&&i.addEventListener("compositionend",(()=>{let t=!1;const i=a.Z.getPrevPages(),{pageIndex:s,layerIndex:r,subLayerIdx:h}=n.ZP.getLayerInfoById(this.pageId,this.layerId,this.subLayerId,i);let c=i[s].layers[r];-1!==h&&(c=c.layers[h]),o.Z.toText(c)!==o.Z.getText(e)&&(t=!0),this.$emit("update",m({},o.Z.toIParagraph(e.getJSON()))),this.$emit("compositionend",t),o.Z.agent((e=>{e.chain().setContent(o.Z.toJSON(o.Z.toIParagraph(e.getJSON()).paragraphs)).selectPrevious().run()}))}))})),o.Z.on("focus",(()=>{})),o.Z.on("blur",(()=>{this.updateLayerProps({isTyping:!1}),this.$isTouchDevice()&&this.updateLayerProps({contentEditable:!1})}))},unmounted(){this.editor&&this.editor.destroy(),this.layerInfo=void 0},computed:{},methods:{updateLayerProps(e){if(this.layerInfo){const{currLayer:t,layerIndex:i,subLayerIdx:s}=this.layerInfo;switch(t.type){case"text":n.ZP.updateLayerProps(this.pageIndex,i,e);break;case"group":n.ZP.updateSubLayerProps(this.pageIndex,i,s,e)}}}}}),v=i(53372);const S=(0,v.Z)(I,[["render",r],["__file","NuTextEditor.vue"]]);var w=S},21977:function(e,t,i){i.r(t),i.d(t,{default:function(){return x}});var s=i(29651),r=i(819);function n(e,t,i,n,a,o){const h=(0,s.up)("nu-layer");return(0,s.wg)(),(0,s.iD)("div",{class:"nu-tmp",style:(0,r.j5)(e.styles())},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.config.layers,((t,i)=>((0,s.wg)(),(0,s.j4)(h,{key:`layer-${i}`,pageIndex:e.pageIndex,page:e.page,layerIndex:e.layerIndex,subLayerIndex:i,contentScaleRatio:e.contentScaleRatio,config:t,style:(0,r.j5)(e.subLayerStyles(t)),isSubLayer:!0,inTmp:!0,primaryScale:e.config.styles.scale,primaryLayer:e.config,inPreview:e.inPreview},null,8,["pageIndex","page","layerIndex","subLayerIndex","contentScaleRatio","config","style","primaryScale","primaryLayer","inPreview"])))),128))],4)}var a=i(75231),o=i(32905),h=i(74041),c=Object.defineProperty,l=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable,p=(e,t,i)=>t in e?c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,y=(e,t)=>{for(var i in t||(t={}))d.call(t,i)&&p(e,i,t[i]);if(l)for(var i of l(t))g.call(t,i)&&p(e,i,t[i]);return e},u=(0,s.aZ)({emits:[],props:{config:{type:Object,required:!0},pageIndex:{type:Number,required:!0},page:{type:Object,required:!0},layerIndex:{type:Number,required:!0},contentScaleRatio:{default:1,type:Number},inPreview:{default:!1,type:Boolean}},created(){for(const[e,t]of this.config.layers.entries())"text"===t.type&&a.ZP.updateSelectedLayerProps(this.pageIndex,e,{editing:!1});h.Z.updateTextPropsState()},computed:{transformStyle(){return{transformStyle:this.enalble3dTransform?"preserve-3d":"initial"}},enalble3dTransform(){return this.pageIndex===o.Z._3dEnabledPageIndex}},methods:{styles(){return y({},this.transformStyle)},subLayerStyles(e){const t=this.config.styles.scale;return"shape"===e.type&&"D"===e.category?{}:{outline:2/t+"px solid #7190CC"}}}}),f=i(53372);const m=(0,f.Z)(u,[["render",n],["__scopeId","data-v-62d76e2c"],["__file","NuTmp.vue"]]);var x=m},50680:function(e,t,i){i.r(t),i.d(t,{default:function(){return g}});var s=i(29651),r=i(819);const n=["disabled"],a={class:"btn__text"};function o(e,t,i,o,h,c){const l=(0,s.up)("svg-icon");return(0,s.wg)(),(0,s.iD)("button",{class:(0,r.C_)(["btn",`btn-${e.squared?"squared-":""}${e.buttonType}`]),style:(0,r.j5)(e.btnStyles),disabled:e.disabled},[e.hasIcon?((0,s.wg)(),(0,s.j4)(l,{key:0,class:"btn__icon",style:(0,r.j5)("row"===e.flexDir?`margin-right: ${e.iconMargin}px`:`margin-bottom: ${e.iconMargin}px`),iconName:e.iconName,iconColor:e.iconColor,iconWidth:e.iconWidth},null,8,["style","iconName","iconColor","iconWidth"])):(0,s.kq)("",!0),(0,s._)("span",a,[(0,s.WI)(e.$slots,"default",{},void 0,!0)])],14,n)}const h=(0,s.aZ)({emits:[],name:"Btn",components:{},props:{type:{type:String,default:"primary-mid"},iconName:{type:String,default:"menu"},iconColor:{type:String,default:"#fff"},iconWidth:{type:String,default:"15px"},iconMargin:{type:Number,default:0},hasIcon:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},squared:{type:Boolean,default:!1},flexDir:{type:String,default:"row"}},mounted(){this.squared&&(this.$el.style.padding=this.$el.style.paddingTop)},computed:{buttonType(){const e=this.type.split("-")[1];return this.disabled?`inactive-${e}`:this.type},btnStyles(){return{display:"flex","flex-direction":this.flexDir}}}});var c=h,l=i(53372);const d=(0,l.Z)(c,[["render",o],["__scopeId","data-v-4a87ef30"],["__file","Btn.vue"]]);var g=d},57763:function(e,t,i){i.r(t),i.d(t,{default:function(){return x}});var s=i(29651),r=i(41463),n=i(819);const a={class:"relative dropdown"},o={class:"dropdown__label"},h={key:0,class:"dropdown__options"},c=["onClick"],l={class:"dropdown__option"},d={key:1,class:"dropdown__options"};function g(e,t,i,g,p,y){const u=(0,s.up)("svg-icon"),f=(0,s.up)("property-bar"),m=(0,s.Q2)("click-outside");return(0,s.wg)(),(0,s.iD)("div",a,[(0,s.Wm)(f,{class:"pointer",onClick:(0,r.iM)(e.handleOpen,["prevent"])},{default:(0,s.w5)((()=>[(0,s._)("div",o,[(0,s.WI)(e.$slots,"default",{},(()=>[(0,s.Uk)((0,n.zw)(e.current||e.placeholder),1)]),!0)]),(0,s.WI)(e.$slots,"caret-down",{},(()=>[(0,s.Wm)(u,{iconName:"caret-down",iconWidth:"10px",iconColor:"gray-2"})]),!0)])),_:3},8,["onClick"]),e.showDropdown&&e.options.length?(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",h,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.options,(t=>((0,s.wg)(),(0,s.iD)("div",{key:"number"===typeof t?t:t.value,onClick:(0,r.iM)((()=>e.handleSelect(t)),["stop"])},[(0,s.WI)(e.$slots,"option",{data:t},(()=>[(0,s._)("div",l,(0,n.zw)("number"===typeof t?t:t.label),1)]),!0)],8,c)))),128))])),[[m,e.handleClose]]):(0,s.kq)("",!0),e.showDropdown&&e.isCustomOptions?(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",d,[(0,s.WI)(e.$slots,"custom",{},void 0,!0)])),[[m,e.handleClose]]):(0,s.kq)("",!0)])}var p=i(10298),y=i.n(p),u=(0,s.aZ)({props:{current:{type:String},placeholder:{type:String},options:{type:Array,default:()=>[]},closeAfterSelection:{type:Boolean,default:!0},isCustomOptions:{type:Boolean,default:!1}},directives:{clickOutside:y().directive},emits:["open","close","select"],data(){return{showDropdown:!1}},methods:{handleOpen(e){this.showDropdown=!0,this.$emit("open",e)},handleClose(e){this.showDropdown=!1,this.$emit("close",e)},handleSelect(e){this.closeAfterSelection&&(this.showDropdown=!1),this.$emit("select",e)}}}),f=i(53372);const m=(0,f.Z)(u,[["render",g],["__scopeId","data-v-5436fd4a"],["__file","Dropdown.vue"]]);var x=m},66760:function(e,t,i){i.r(t),i.d(t,{default:function(){return u}});var s=i(29651),r=i(41463),n=i(819);const a={class:"hint"},o={key:0,class:"hint__content"},h={class:"hint__body"},c={class:"no-wrap"};function l(e,t,i,l,d,g){const p=(0,s.up)("svg-icon");return(0,s.wg)(),(0,s.iD)("div",a,[(0,s.Wm)(r.uT,{name:"fade-up"},{default:(0,s.w5)((()=>[e.showHint?((0,s.wg)(),(0,s.iD)("div",o,[(0,s.Wm)(p,{class:"arrow-up",iconName:"arrow-up",iconHeight:"5px",iconColor:"gray-2"}),(0,s._)("div",h,[(0,s._)("span",c,(0,n.zw)(e.hint),1)])])):(0,s.kq)("",!0)])),_:1})])}var d=i(45320),g=(0,s.aZ)({emits:[],name:"Hint",data(){return{hintUtils:d.Z}},computed:{hint(){return this.hintUtils.currHint},showHint(){return this.hintUtils.showHint}}}),p=i(53372);const y=(0,p.Z)(g,[["render",l],["__scopeId","data-v-39e8a624"],["__file","Hint.vue"]]);var u=y},15563:function(e,t,i){i.r(t),i.d(t,{default:function(){return d}});var s=i(29651),r=i(819);const n={key:1};function a(e,t,i,a,o,h){const c=(0,s.up)("svg-icon"),l=(0,s.Q2)("hint");return(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",{class:(0,r.C_)(`nubtn ${e.theme} ${e.sizeClass} ${e.status} ${e.$isTouchDevice()?"mobile":"desktop"}`),onClick:t[0]||(t[0]=(...t)=>e.click&&e.click(...t))},[e.theme.includes("icon")?((0,s.wg)(),(0,s.j4)(c,{key:0,iconName:e.iconName,iconWidth:e.iconSize,iconColor:e.iconColor},null,8,["iconName","iconWidth","iconColor"])):(0,s.kq)("",!0),e.theme.includes("icon")&&"icon_text"!==e.theme?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("span",n,[(0,s.WI)(e.$slots,"default",{},void 0,!0)]))],2)),[[l,e.hint]])}const o=(0,s.aZ)({name:"Nubtn",emits:["click","update:active"],props:{theme:{type:String,default:"primary"},size:{type:String,default:"sm"},active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},icon:{type:[String,Array]},hint:{type:String,default:""}},computed:{status(){return this.disabled?"disabled":this.active?"active":"default"},sizeClass(){return this.size.replace("-"," ")},iconName(){return Array.isArray(this.icon)?this.icon[0]:this.icon},iconSize(){return"24px"},iconColor(){return Array.isArray(this.icon)&&this.icon[1]?this.icon[1]:"icon_text"===this.theme?"white":"disabled"===this.status?"gray-4":"gray-2"}},methods:{click(e){"disabled"!==this.status&&(this.$emit("update:active",!this.active),this.$emit("click",e))}}});var h=o,c=i(53372);const l=(0,c.Z)(h,[["render",a],["__scopeId","data-v-082b7972"],["__file","Nubtn.vue"]]);var d=l},49042:function(e,t,i){i.r(t),i.d(t,{default:function(){return g}});var s=i(29651),r=i(819);const n={class:"spinner popup-window"},a=["src"];function o(e,t,o,h,c,l){return(0,s.wg)(),(0,s.iD)("div",n,[(0,s._)("div",null,[(0,s._)("img",{src:i(84601)},null,8,a),(0,s._)("span",null,(0,r.zw)(e.loadingText)+"...",1)])])}var h=i(23931),c=(0,s.aZ)({emits:[],props:{textContent:{type:String}},computed:{loadingText(){return this.textContent||h.Z.global.t("NN0454")}}}),l=i(53372);const d=(0,l.Z)(c,[["render",o],["__scopeId","data-v-8e84628e"],["__file","Spinner.vue"]]);var g=d},84601:function(e,t,i){e.exports=i.p+"img/rocket-loading.7b2994c8.gif"}}]);
//# sourceMappingURL=global-component.82e5e5cc.js.map