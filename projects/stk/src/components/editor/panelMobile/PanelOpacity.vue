<template lang="pug">
div(class="panel-opacity")
  mobile-slider(:title="`${$t('NN0030')}`"
    :borderTouchArea="true"
    :value="opacity"
    :min="0"
    :max="100"
    @update="updateLayerOpacity")
</template>

<script lang="ts">
import { defineComponent } from 'vue'
import MobileSlider from '@/components/editor/mobile/MobileSlider.vue'
import layerUtils from '@nu/vivi-lib/utils/layerUtils'
import pageUtils from '@nu/vivi-lib/utils/pageUtils'
import { mapGetters, mapMutations } from 'vuex'
export default defineComponent({
  emits: [],
  components: {
    MobileSlider
  },
  computed: {
    ...mapGetters({
      currSidebarPanel: 'getCurrFunctionPanelType',
      currSelectedInfo: 'getCurrSelectedInfo',
      currSubSelectedInfo: 'getCurrSubSelectedInfo',
      isShowPagePreview: 'page/getIsShowPagePreview',
      inBgRemoveMode: 'bgRemove/getInBgRemoveMode',
      InBgRemoveFirstStep: 'bgRemove/inFirstStep',
      InBgRemoveLastStep: 'bgRemove/inLastStep',
      inBgSettingMode: 'mobileEditor/getInBgSettingMode'
    }),
    opacity(): number {
      return this.inBgSettingMode ? this.backgroundOpacity : layerUtils.getCurrOpacity
    },
    backgroundOpacity(): number {
      const { styles: { opacity } } = pageUtils.getPage(pageUtils.currFocusPageIndex).backgroundImage.config
      return opacity
    }
  },
  methods: {
    ...mapMutations({
      setBgOpacity: 'SET_backgroundOpacity'
    }),
    updateLayerOpacity(val: number) {
      this.inBgSettingMode ? this.setBgOpacity({
        pageIndex: pageUtils.currFocusPageIndex,
        // opacity: `${opacity}`
        opacity: val
      }) : layerUtils.updateLayerOpacity(val)
    }
  }
})
</script>

<style lang="scss" scoped>
.panel-opacity {
  padding-top: 3px;
  width: 100%;
}
</style>
